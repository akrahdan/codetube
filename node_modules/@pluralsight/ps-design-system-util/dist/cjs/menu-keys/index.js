"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useMenuRef = exports.handleMenuKeyUpEvents = exports.handleMenuKeyDownEvents = exports.searchListItem = void 0;
var react_1 = __importDefault(require("react"));
var use_combined_refs_1 = require("../use-combined-refs");
exports.searchListItem = function (el, down) {
    if (down === void 0) { down = true; }
    if (!el)
        return;
    var isDisabled = el.hasAttribute('[data-disabled]');
    var isListItem = el.tagName === 'LI';
    if (isListItem && !isDisabled)
        return el;
    var nextEl = down ? el.nextElementSibling : el.previousElementSibling;
    return exports.searchListItem(nextEl, down);
};
var rightArrow = function (evt) {
    var target = evt.target;
    var subMenu = target.querySelector('* > ul');
    if (!subMenu)
        return;
    var firstElementChild = subMenu.firstElementChild;
    var firstChild = exports.searchListItem(firstElementChild);
    if (!firstChild)
        return;
    firstChild.focus();
};
var leftArrow = function (evt) {
    var _a;
    var target = evt.target;
    var atMenuRoot = target.parentNode === evt.currentTarget;
    if (atMenuRoot)
        return;
    target.blur();
    var parent = (_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.parentElement;
    if (!parent)
        return;
    parent.focus();
};
var downArrow = function (evt) {
    var _a;
    var target = evt.target;
    var nextEl = target.nextElementSibling;
    var nextSibling = exports.searchListItem(nextEl);
    var firstChildEl = (_a = target.parentNode) === null || _a === void 0 ? void 0 : _a.firstElementChild;
    var firstChild = exports.searchListItem(firstChildEl);
    if (nextSibling)
        nextSibling.focus();
    else if (firstChild)
        firstChild.focus();
};
var upArrow = function (evt) {
    var _a;
    var target = evt.target;
    var prevEl = target.previousElementSibling;
    var prevSibling = exports.searchListItem(prevEl, false);
    var lastEl = (_a = target.parentNode) === null || _a === void 0 ? void 0 : _a.lastElementChild;
    var lastChild = exports.searchListItem(lastEl, false);
    if (prevSibling)
        prevSibling.focus();
    else if (lastChild)
        lastChild.focus();
};
var home = function (evt) {
    var _a;
    var target = evt.target;
    var firstChildEl = (_a = target.parentNode) === null || _a === void 0 ? void 0 : _a.firstElementChild;
    var firstChild = exports.searchListItem(firstChildEl);
    if (firstChild)
        firstChild.focus();
};
var end = function (evt) {
    var _a;
    var target = evt.target;
    var lastChildEl = (_a = target.parentNode) === null || _a === void 0 ? void 0 : _a.lastElementChild;
    var lastChild = exports.searchListItem(lastChildEl, false);
    if (lastChild)
        lastChild.focus();
};
var startsWith = function (el, key) {
    if (el && typeof el.innerText === 'string') {
        return (el.innerText.startsWith(key) || el.innerText.startsWith(key.toUpperCase()));
    }
    return false;
};
var character = function (evt) {
    var _a;
    var target = evt.target;
    var char = evt.key.length === 1 ? evt.key : false;
    if (!char)
        return;
    var nextSiblingEl = target.nextElementSibling;
    var firstParentChild = (_a = target.parentNode) === null || _a === void 0 ? void 0 : _a.firstElementChild;
    var sibling = exports.searchListItem(nextSiblingEl) || exports.searchListItem(firstParentChild);
    var siblings = [];
    while (sibling) {
        if (sibling === target)
            break;
        var nextSiblingsSiblingEl = sibling.nextElementSibling;
        siblings.push(sibling);
        sibling =
            exports.searchListItem(nextSiblingsSiblingEl) || exports.searchListItem(firstParentChild);
    }
    for (var _i = 0, siblings_1 = siblings; _i < siblings_1.length; _i++) {
        var el = siblings_1[_i];
        if (startsWith(el, char)) {
            el.focus();
            break;
        }
    }
};
exports.handleMenuKeyDownEvents = function (synthetic) {
    var evt = synthetic.nativeEvent;
    evt.key === 'ArrowDown'
        ? downArrow(evt)
        : evt.key === 'ArrowUp'
            ? upArrow(evt)
            : evt.key === 'Home'
                ? home(evt)
                : evt.key === 'End'
                    ? end(evt)
                    : character(evt);
    evt.preventDefault();
};
exports.handleMenuKeyUpEvents = function (synthetic) {
    var evt = synthetic.nativeEvent;
    evt.key === 'ArrowRight' && rightArrow(evt);
    evt.key === 'ArrowLeft' && leftArrow(evt);
    evt.preventDefault();
};
exports.useMenuRef = function (focus) {
    if (focus === void 0) { focus = false; }
    var outer = react_1.default.createRef();
    var inner = react_1.default.useCallback(function (node) {
        if (node && focus) {
            var firstMenuItem = exports.searchListItem(node.firstElementChild);
            firstMenuItem && firstMenuItem.focus();
        }
    }, [focus]);
    return use_combined_refs_1.useCombinedRefs(outer, inner);
};
//# sourceMappingURL=index.js.map