"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var exenv_1 = require("exenv");
var react_1 = __importDefault(require("react"));
var ps_design_system_util_1 = require("@pluralsight/ps-design-system-util");
function useOnInnerFocus(ref, _a) {
    var onEnter = _a.onEnter, onLeave = _a.onLeave;
    var refContainsActiveElement = react_1.default.useCallback(function () {
        if (!exenv_1.canUseDOM || !ref.current)
            return false;
        return ref.current.contains(document.activeElement);
    }, [ref]);
    var _b = react_1.default.useState(refContainsActiveElement), activeElInRef = _b[0], setActiveElInRef = _b[1];
    var prevActiveElInRef = ps_design_system_util_1.usePrevious(activeElInRef);
    var handleFocus = react_1.default.useCallback(function () {
        var nextActive = refContainsActiveElement();
        setActiveElInRef(nextActive);
    }, [refContainsActiveElement, setActiveElInRef]);
    react_1.default.useEffect(function () {
        if (!exists(activeElInRef) || !exists(prevActiveElInRef))
            return;
        if (prevActiveElInRef === activeElInRef)
            return;
        var entering = !prevActiveElInRef && activeElInRef;
        var leaving = prevActiveElInRef && !activeElInRef;
        if (entering)
            onEnter();
        else if (leaving)
            onLeave();
    }, [activeElInRef, prevActiveElInRef, onEnter, onLeave]);
    react_1.default.useEffect(function () {
        if (!exenv_1.canUseEventListeners)
            return;
        document.addEventListener('focus', handleFocus, true);
        return function () {
            document.removeEventListener('focus', handleFocus, true);
        };
    }, [handleFocus]);
}
exports.default = useOnInnerFocus;
var exists = function (val) { return typeof val !== 'undefined'; };
//# sourceMappingURL=use-on-inner-focus.js.map