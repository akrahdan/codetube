import _styled from "@emotion/styled/base";

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

import { Box } from '@codecademy/gamut';
import { themed } from '@codecademy/gamut-styles';
import { useTheme } from '@emotion/react';
import cx from 'classnames';
import React, { useCallback, useEffect, useState } from 'react';
import { AppHeader, AppHeaderMobile } from '..';
import { isAppHeaderItemWithHref } from '../AppHeader/AppHeaderElements/types';
import { anonDefaultHeaderItems, anonDefaultMobileHeaderItems, anonLandingHeaderItems, anonLandingMobileHeaderItems, anonLoginHeaderItems, anonLoginMobileHeaderItems, anonSignupHeaderItems, anonSignupMobileHeaderItems, freeHeaderItems, freeMobileHeaderItems, loadingHeaderItems, loadingMobileHeaderItems, proHeaderItems, proMobileHeaderItems } from './GlobalHeaderVariants';
import styles from './styles.module.scss';

var getAppHeaderItems = function getAppHeaderItems(props) {
  var _props$renderSearch, _props$renderSearch2, _props$renderSearch3, _props$renderSearch4, _props$renderNotifica, _props$renderSearch5, _props$renderNotifica2;

  switch (props.type) {
    case 'anon':
      switch (props.variant) {
        case 'landing':
          return anonLandingHeaderItems();

        case 'login':
          return anonLoginHeaderItems((_props$renderSearch = props.renderSearch) === null || _props$renderSearch === void 0 ? void 0 : _props$renderSearch.desktop);

        case 'signup':
          return anonSignupHeaderItems((_props$renderSearch2 = props.renderSearch) === null || _props$renderSearch2 === void 0 ? void 0 : _props$renderSearch2.desktop);

        default:
          return anonDefaultHeaderItems((_props$renderSearch3 = props.renderSearch) === null || _props$renderSearch3 === void 0 ? void 0 : _props$renderSearch3.desktop);
      }

    case 'free':
      return freeHeaderItems(props.user, (_props$renderSearch4 = props.renderSearch) === null || _props$renderSearch4 === void 0 ? void 0 : _props$renderSearch4.desktop, (_props$renderNotifica = props.renderNotifications) === null || _props$renderNotifica === void 0 ? void 0 : _props$renderNotifica.desktop);

    case 'pro':
      return proHeaderItems(props.user, (_props$renderSearch5 = props.renderSearch) === null || _props$renderSearch5 === void 0 ? void 0 : _props$renderSearch5.desktop, (_props$renderNotifica2 = props.renderNotifications) === null || _props$renderNotifica2 === void 0 ? void 0 : _props$renderNotifica2.desktop);

    case 'loading':
      return loadingHeaderItems;
  }
};

var getMobileAppHeaderItems = function getMobileAppHeaderItems(props) {
  var _props$renderNotifica3, _props$renderNotifica4;

  switch (props.type) {
    case 'anon':
      switch (props.variant) {
        case 'landing':
          return anonLandingMobileHeaderItems();

        case 'login':
          return anonLoginMobileHeaderItems();

        case 'signup':
          return anonSignupMobileHeaderItems();

        default:
          return anonDefaultMobileHeaderItems();
      }

    case 'free':
      return freeMobileHeaderItems(props.user, (_props$renderNotifica3 = props.renderNotifications) === null || _props$renderNotifica3 === void 0 ? void 0 : _props$renderNotifica3.mobile);

    case 'pro':
      return proMobileHeaderItems(props.user, (_props$renderNotifica4 = props.renderNotifications) === null || _props$renderNotifica4 === void 0 ? void 0 : _props$renderNotifica4.mobile);

    case 'loading':
      return loadingMobileHeaderItems;
  }
};

var StyledBox = /*#__PURE__*/_styled(Box, {
  target: "em91zwm0",
  label: "StyledBox"
})("z-index:", themed('elements.headerZ'), ";" + (process.env.NODE_ENV === "production" ? "" : "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HbG9iYWxIZWFkZXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXVHNkIiLCJmaWxlIjoiLi4vLi4vc3JjL0dsb2JhbEhlYWRlci9pbmRleC50c3giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCb3ggfSBmcm9tICdAY29kZWNhZGVteS9nYW11dCc7XG5pbXBvcnQgeyB0aGVtZWQgfSBmcm9tICdAY29kZWNhZGVteS9nYW11dC1zdHlsZXMnO1xuaW1wb3J0IHsgdXNlVGhlbWUgfSBmcm9tICdAZW1vdGlvbi9yZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ0BlbW90aW9uL3N0eWxlZCc7XG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IEFwcEhlYWRlciwgQXBwSGVhZGVyTW9iaWxlIH0gZnJvbSAnLi4nO1xuaW1wb3J0IHtcbiAgQXBwSGVhZGVySXRlbSxcbiAgaXNBcHBIZWFkZXJJdGVtV2l0aEhyZWYsXG59IGZyb20gJy4uL0FwcEhlYWRlci9BcHBIZWFkZXJFbGVtZW50cy90eXBlcyc7XG5pbXBvcnQge1xuICBGb3JtYXR0ZWRBcHBIZWFkZXJJdGVtcyxcbiAgRm9ybWF0dGVkTW9iaWxlQXBwSGVhZGVySXRlbXMsXG59IGZyb20gJy4uL0FwcEhlYWRlci90eXBlcyc7XG5pbXBvcnQge1xuICBhbm9uRGVmYXVsdEhlYWRlckl0ZW1zLFxuICBhbm9uRGVmYXVsdE1vYmlsZUhlYWRlckl0ZW1zLFxuICBhbm9uTGFuZGluZ0hlYWRlckl0ZW1zLFxuICBhbm9uTGFuZGluZ01vYmlsZUhlYWRlckl0ZW1zLFxuICBhbm9uTG9naW5IZWFkZXJJdGVtcyxcbiAgYW5vbkxvZ2luTW9iaWxlSGVhZGVySXRlbXMsXG4gIGFub25TaWdudXBIZWFkZXJJdGVtcyxcbiAgYW5vblNpZ251cE1vYmlsZUhlYWRlckl0ZW1zLFxuICBmcmVlSGVhZGVySXRlbXMsXG4gIGZyZWVNb2JpbGVIZWFkZXJJdGVtcyxcbiAgbG9hZGluZ0hlYWRlckl0ZW1zLFxuICBsb2FkaW5nTW9iaWxlSGVhZGVySXRlbXMsXG4gIHByb0hlYWRlckl0ZW1zLFxuICBwcm9Nb2JpbGVIZWFkZXJJdGVtcyxcbn0gZnJvbSAnLi9HbG9iYWxIZWFkZXJWYXJpYW50cyc7XG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vc3R5bGVzLm1vZHVsZS5zY3NzJztcbmltcG9ydCB7IEFub25IZWFkZXIsIEZyZWVIZWFkZXIsIExvYWRpbmdIZWFkZXIsIFByb0hlYWRlciB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgdHlwZSBHbG9iYWxIZWFkZXJQcm9wcyA9XG4gIHwgQW5vbkhlYWRlclxuICB8IEZyZWVIZWFkZXJcbiAgfCBQcm9IZWFkZXJcbiAgfCBMb2FkaW5nSGVhZGVyO1xuXG5jb25zdCBnZXRBcHBIZWFkZXJJdGVtcyA9IChcbiAgcHJvcHM6IEdsb2JhbEhlYWRlclByb3BzXG4pOiBGb3JtYXR0ZWRBcHBIZWFkZXJJdGVtcyA9PiB7XG4gIHN3aXRjaCAocHJvcHMudHlwZSkge1xuICAgIGNhc2UgJ2Fub24nOlxuICAgICAgc3dpdGNoIChwcm9wcy52YXJpYW50KSB7XG4gICAgICAgIGNhc2UgJ2xhbmRpbmcnOlxuICAgICAgICAgIHJldHVybiBhbm9uTGFuZGluZ0hlYWRlckl0ZW1zKCk7XG4gICAgICAgIGNhc2UgJ2xvZ2luJzpcbiAgICAgICAgICByZXR1cm4gYW5vbkxvZ2luSGVhZGVySXRlbXMocHJvcHMucmVuZGVyU2VhcmNoPy5kZXNrdG9wKTtcbiAgICAgICAgY2FzZSAnc2lnbnVwJzpcbiAgICAgICAgICByZXR1cm4gYW5vblNpZ251cEhlYWRlckl0ZW1zKHByb3BzLnJlbmRlclNlYXJjaD8uZGVza3RvcCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGFub25EZWZhdWx0SGVhZGVySXRlbXMocHJvcHMucmVuZGVyU2VhcmNoPy5kZXNrdG9wKTtcbiAgICAgIH1cbiAgICBjYXNlICdmcmVlJzpcbiAgICAgIHJldHVybiBmcmVlSGVhZGVySXRlbXMoXG4gICAgICAgIHByb3BzLnVzZXIsXG4gICAgICAgIHByb3BzLnJlbmRlclNlYXJjaD8uZGVza3RvcCxcbiAgICAgICAgcHJvcHMucmVuZGVyTm90aWZpY2F0aW9ucz8uZGVza3RvcFxuICAgICAgKTtcbiAgICBjYXNlICdwcm8nOlxuICAgICAgcmV0dXJuIHByb0hlYWRlckl0ZW1zKFxuICAgICAgICBwcm9wcy51c2VyLFxuICAgICAgICBwcm9wcy5yZW5kZXJTZWFyY2g/LmRlc2t0b3AsXG4gICAgICAgIHByb3BzLnJlbmRlck5vdGlmaWNhdGlvbnM/LmRlc2t0b3BcbiAgICAgICk7XG4gICAgY2FzZSAnbG9hZGluZyc6XG4gICAgICByZXR1cm4gbG9hZGluZ0hlYWRlckl0ZW1zO1xuICB9XG59O1xuXG5jb25zdCBnZXRNb2JpbGVBcHBIZWFkZXJJdGVtcyA9IChcbiAgcHJvcHM6IEdsb2JhbEhlYWRlclByb3BzXG4pOiBGb3JtYXR0ZWRNb2JpbGVBcHBIZWFkZXJJdGVtcyA9PiB7XG4gIHN3aXRjaCAocHJvcHMudHlwZSkge1xuICAgIGNhc2UgJ2Fub24nOlxuICAgICAgc3dpdGNoIChwcm9wcy52YXJpYW50KSB7XG4gICAgICAgIGNhc2UgJ2xhbmRpbmcnOlxuICAgICAgICAgIHJldHVybiBhbm9uTGFuZGluZ01vYmlsZUhlYWRlckl0ZW1zKCk7XG4gICAgICAgIGNhc2UgJ2xvZ2luJzpcbiAgICAgICAgICByZXR1cm4gYW5vbkxvZ2luTW9iaWxlSGVhZGVySXRlbXMoKTtcbiAgICAgICAgY2FzZSAnc2lnbnVwJzpcbiAgICAgICAgICByZXR1cm4gYW5vblNpZ251cE1vYmlsZUhlYWRlckl0ZW1zKCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGFub25EZWZhdWx0TW9iaWxlSGVhZGVySXRlbXMoKTtcbiAgICAgIH1cbiAgICBjYXNlICdmcmVlJzpcbiAgICAgIHJldHVybiBmcmVlTW9iaWxlSGVhZGVySXRlbXMoXG4gICAgICAgIHByb3BzLnVzZXIsXG4gICAgICAgIHByb3BzLnJlbmRlck5vdGlmaWNhdGlvbnM/Lm1vYmlsZVxuICAgICAgKTtcbiAgICBjYXNlICdwcm8nOlxuICAgICAgcmV0dXJuIHByb01vYmlsZUhlYWRlckl0ZW1zKFxuICAgICAgICBwcm9wcy51c2VyLFxuICAgICAgICBwcm9wcy5yZW5kZXJOb3RpZmljYXRpb25zPy5tb2JpbGVcbiAgICAgICk7XG4gICAgY2FzZSAnbG9hZGluZyc6XG4gICAgICByZXR1cm4gbG9hZGluZ01vYmlsZUhlYWRlckl0ZW1zO1xuICB9XG59O1xuXG5jb25zdCBTdHlsZWRCb3ggPSBzdHlsZWQoQm94KWBcbiAgei1pbmRleDogJHt0aGVtZWQoJ2VsZW1lbnRzLmhlYWRlclonKX07XG5gO1xuXG5leHBvcnQgY29uc3QgR2xvYmFsSGVhZGVyOiBSZWFjdC5GQzxHbG9iYWxIZWFkZXJQcm9wcz4gPSAocHJvcHMpID0+IHtcbiAgY29uc3QgeyBhY3Rpb24sIG9uTGlua0FjdGlvbiwgcmVuZGVyU2VhcmNoLCBjaGlsZHJlbiB9ID0gcHJvcHM7XG5cbiAgY29uc3QgW2lzSW5IZWFkZXJSZWdpb24sIHNldElzSW5IZWFkZXJSZWdpb25dID0gdXNlU3RhdGUodHJ1ZSk7XG5cbiAgLy8gaXQgaXMgbm90IHJlY29tbWVuZGVkIHRvIHJlcGxpY2F0ZSB0aGlzIGxvZ2ljIGluIG90aGVyIGNvbXBvbmVudHMgdW5sZXNzIGFic29sdXRlbHkgbmVjZXNzYXJ5LCBhcyBpdCBpc1xuICAvLyBhIHdvcmthcm91bmQgZm9yIHN0eWxlIHJlaHlkcmF0aW9uIGlzc3VlcyB3aGVuIHVzaW5nIHJlYWN0LXVzZS91c2VXaW5kb3dTY3JvbGwuIFRoZSByZWFzb25pbmcgYmVoaW5kIHRoaXNcbiAgLy8gd29ya2Fyb3VuZCBpcyBkaXNjdXNzZWQgaGVyZTogaHR0cHM6Ly9naXRodWIuY29tL0NvZGVjYWRlbXkvY2xpZW50LW1vZHVsZXMvcHVsbC8xODIyI2Rpc2N1c3Npb25fcjY1MDEyNTQwNlxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGNoZWNrU2Nyb2xsID0gKCkgPT4gc2V0SXNJbkhlYWRlclJlZ2lvbih3aW5kb3c/LnBhZ2VZT2Zmc2V0ID09PSAwKTtcbiAgICBjaGVja1Njcm9sbCgpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGNoZWNrU2Nyb2xsKTtcbiAgICByZXR1cm4gKCkgPT4gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgY2hlY2tTY3JvbGwpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuXG4gIGNvbnN0IGNvbWJpbmVkQWN0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgKGV2ZW50OiBSZWFjdC5Nb3VzZUV2ZW50LCBpdGVtOiBBcHBIZWFkZXJJdGVtKSA9PiB7XG4gICAgICBhY3Rpb24oZXZlbnQsIGl0ZW0pO1xuICAgICAgaWYgKGlzQXBwSGVhZGVySXRlbVdpdGhIcmVmKGl0ZW0pKSBvbkxpbmtBY3Rpb24/LihldmVudCwgaXRlbSk7XG4gICAgfSxcbiAgICBbYWN0aW9uLCBvbkxpbmtBY3Rpb25dXG4gICk7XG5cbiAgY29uc3QgaGVhZGVyQ2xhc3NlcyA9IGN4KFxuICAgIHN0eWxlcy5zdGlja3lIZWFkZXIsXG4gICAgaXNJbkhlYWRlclJlZ2lvbiAmJiBzdHlsZXMudHJhbnNpdGlvbkZhZGVPdXRcbiAgKTtcblxuICByZXR1cm4gKFxuICAgIDxTdHlsZWRCb3ggYXM9XCJoZWFkZXJcIiBwb3NpdGlvbj1cInN0aWNreVwiIHRvcD17MH0+XG4gICAgICA8Qm94XG4gICAgICAgIGRpc3BsYXk9e3sgXzogJ25vbmUnLCBtZDogJ2Jsb2NrJyB9fVxuICAgICAgICBoZWlnaHQ9e3RoZW1lLmVsZW1lbnRzLmhlYWRlckhlaWdodH1cbiAgICAgICAgY2xhc3NOYW1lPXtoZWFkZXJDbGFzc2VzfVxuICAgICAgPlxuICAgICAgICA8QXBwSGVhZGVyXG4gICAgICAgICAgYWN0aW9uPXtjb21iaW5lZEFjdGlvbn1cbiAgICAgICAgICBpdGVtcz17Z2V0QXBwSGVhZGVySXRlbXMocHJvcHMpfVxuICAgICAgICAgIHJlZGlyZWN0UGFyYW09e1xuICAgICAgICAgICAgcHJvcHMudHlwZSA9PT0gJ2Fub24nID8gcHJvcHMucmVkaXJlY3RQYXJhbSA6IHVuZGVmaW5lZFxuICAgICAgICAgIH1cbiAgICAgICAgLz5cbiAgICAgIDwvQm94PlxuICAgICAgPEJveFxuICAgICAgICBkaXNwbGF5PXt7IF86ICdibG9jaycsIG1kOiAnbm9uZScgfX1cbiAgICAgICAgaGVpZ2h0PXt0aGVtZS5lbGVtZW50cy5oZWFkZXJIZWlnaHR9XG4gICAgICAgIGNsYXNzTmFtZT17aGVhZGVyQ2xhc3Nlc31cbiAgICAgID5cbiAgICAgICAgPEFwcEhlYWRlck1vYmlsZVxuICAgICAgICAgIGFjdGlvbj17Y29tYmluZWRBY3Rpb259XG4gICAgICAgICAgaXRlbXM9e2dldE1vYmlsZUFwcEhlYWRlckl0ZW1zKHByb3BzKX1cbiAgICAgICAgICByZW5kZXJTZWFyY2g9e3JlbmRlclNlYXJjaD8ubW9iaWxlfVxuICAgICAgICAgIHJlZGlyZWN0UGFyYW09e1xuICAgICAgICAgICAgcHJvcHMudHlwZSA9PT0gJ2Fub24nID8gcHJvcHMucmVkaXJlY3RQYXJhbSA6IHVuZGVmaW5lZFxuICAgICAgICAgIH1cbiAgICAgICAgLz5cbiAgICAgIDwvQm94PlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvU3R5bGVkQm94PlxuICApO1xufTtcbiJdfQ== */"));

export var GlobalHeader = function GlobalHeader(props) {
  var action = props.action,
      onLinkAction = props.onLinkAction,
      renderSearch = props.renderSearch,
      children = props.children;

  var _useState = useState(true),
      _useState2 = _slicedToArray(_useState, 2),
      isInHeaderRegion = _useState2[0],
      setIsInHeaderRegion = _useState2[1]; // it is not recommended to replicate this logic in other components unless absolutely necessary, as it is
  // a workaround for style rehydration issues when using react-use/useWindowScroll. The reasoning behind this
  // workaround is discussed here: https://github.com/Codecademy/client-modules/pull/1822#discussion_r650125406


  useEffect(function () {
    var checkScroll = function checkScroll() {
      var _window;

      return setIsInHeaderRegion(((_window = window) === null || _window === void 0 ? void 0 : _window.pageYOffset) === 0);
    };

    checkScroll();
    document.addEventListener('scroll', checkScroll);
    return function () {
      return document.removeEventListener('scroll', checkScroll);
    };
  }, []);
  var theme = useTheme();
  var combinedAction = useCallback(function (event, item) {
    action(event, item);
    if (isAppHeaderItemWithHref(item)) onLinkAction === null || onLinkAction === void 0 ? void 0 : onLinkAction(event, item);
  }, [action, onLinkAction]);
  var headerClasses = cx(styles.stickyHeader, isInHeaderRegion && styles.transitionFadeOut);
  return /*#__PURE__*/React.createElement(StyledBox, {
    as: "header",
    position: "sticky",
    top: 0
  }, /*#__PURE__*/React.createElement(Box, {
    display: {
      _: 'none',
      md: 'block'
    },
    height: theme.elements.headerHeight,
    className: headerClasses
  }, /*#__PURE__*/React.createElement(AppHeader, {
    action: combinedAction,
    items: getAppHeaderItems(props),
    redirectParam: props.type === 'anon' ? props.redirectParam : undefined
  })), /*#__PURE__*/React.createElement(Box, {
    display: {
      _: 'block',
      md: 'none'
    },
    height: theme.elements.headerHeight,
    className: headerClasses
  }, /*#__PURE__*/React.createElement(AppHeaderMobile, {
    action: combinedAction,
    items: getMobileAppHeaderItems(props),
    renderSearch: renderSearch === null || renderSearch === void 0 ? void 0 : renderSearch.mobile,
    redirectParam: props.type === 'anon' ? props.redirectParam : undefined
  })), children);
};