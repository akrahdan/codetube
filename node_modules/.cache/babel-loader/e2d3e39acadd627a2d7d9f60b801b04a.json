{"ast":null,"code":"import _objectSpread from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import{withRouter}from\"react-router-dom\";import{updateVideoViews}from\"services/courses\";import{store}from'store';import{play as _play,pause as _pause,setVolume as _setVolume,setTime as _setTime,ready as _ready,seekEnd as _seekEnd,seekStart as _seekStart,setBufferedTime as _setBufferedTime,setMediaType as _setMediaType,setOverlay as _setOverlay,setBuffering as _setBuffering,setFullscreen as _setFullscreen,setLoading as _setLoading,setAutoplay as _setAutoplay,setPlaying as _setPlaying,setCurrentResolution as _setCurrentResolution,setPreferredResolutions as _setPreferredResolutions,setSupportedResolutions as _setSupportedResolutions,setClipProgress as _setClipProgress,setCurrentUrl,setClipId as _setClipId,setSubtitle as _setSubtitle,setCurrentLecture as _setCurrentLecture}from\"state/player/playerSlice\";import css from\"./video.module.css\";import{DefaultResolutions}from\"../constants\";// import withAdobeHeartbeat from './with-adobe-heartbeat'\nimport{FullscreenState,HLS_SDK_URL,HLS_SDK_URL_SAFARI,MediaTypes}from\"../constants\";import{getSDK}from\"../utilities/get-sdk\";import{throttle}from\"../utilities/throttle\";// import { sendPlaySuccessEvent } from '../../analytics/player-events'\nimport{jsx as _jsx}from\"react/jsx-runtime\";var HLS_EXTENSIONS=/\\.(m3u8)($|\\?)/i;var initialState={isPlaying:false,reportedVolume:null,reportedPlaybackRate:1,isBuffering:false,canPlay:false,ready:true};var mapState=function mapState(state,ownProps){return{playing:state.player.playing,playbackRate:state.player.playbackSpeed,volume:state.player.volume,buffering:state.player.buffering,views:state.player.views,route:ownProps.history,currentLecture:state.player.currentLecture,loading:state.player.loading,course:state.player.course,clipId:state.player.clipId,muted:state.player.muted,time:state.player.time,currentUrl:state.player.currentUrl,mediaType:state.player.mediaType,overlay:state.player.overlay,currentResolution:state.player.currentResolution,supportedResolutions:state.player.supportedResolutions,preferredResolutions:state.player.preferredResolutions};};var mapDispatch=function mapDispatch(dispatch){return{setVolume:function setVolume(payload){return dispatch(_setVolume(payload));},setDuration:function setDuration(payload){return dispatch(_setVolume(payload));},setTime:function setTime(payload){return dispatch(_setTime(payload));},setBufferedTime:function setBufferedTime(payload){return dispatch(_setBufferedTime(payload));},ready:function ready(payload){return dispatch(_ready(payload));},seekEnd:function seekEnd(payload){return dispatch(_seekEnd());},setNextUrl:function setNextUrl(payload){return dispatch(setCurrentUrl(payload));},seekStart:function seekStart(payload){return dispatch(_seekStart());},play:function play(payload){return dispatch(_play(payload));},pause:function pause(payload){return dispatch(_pause(payload));},setCurrentLecture:function setCurrentLecture(payload){return dispatch(_setCurrentLecture(payload));},setClipId:function setClipId(payload){return dispatch(_setClipId(payload));},setSubtitle:function setSubtitle(payload){return dispatch(_setSubtitle(payload));},setBuffering:function setBuffering(payload){return dispatch(_setBuffering(payload));},setOverlay:function setOverlay(payload){return dispatch(_setOverlay(payload));},setFullscreen:function setFullscreen(payload){return dispatch(_setFullscreen(payload));},setLoading:function setLoading(payload){return dispatch(_setLoading(payload));},setPlaying:function setPlaying(payload){return dispatch(_setPlaying(payload));},setClipProgress:function setClipProgress(payload){return dispatch(_setClipProgress(payload));},setAutoplay:function setAutoplay(payload){return dispatch(_setAutoplay(payload));},setMediaType:function setMediaType(payload){return dispatch(_setMediaType(payload));},setCurrentResolution:function setCurrentResolution(payload){return dispatch(_setCurrentResolution(payload));},setPreferredResolutions:function setPreferredResolutions(payload){return dispatch(_setPreferredResolutions(payload));},setSupportedResolutions:function setSupportedResolutions(payload){return dispatch(_setSupportedResolutions(payload));}};};var connector=connect(mapState,mapDispatch);export var Video=/*#__PURE__*/function(_Component){_inherits(Video,_Component);var _super=_createSuper(Video);function Video(props){var _this;_classCallCheck(this,Video);_this=_super.call(this,props);_this.newReadyPromise=function(){return new Promise(function(resolve){_this.ready=function(){_this.setState({ready:true},function(){resolve();});};});};_this.isSafari=function(){return navigator.vendor.match(/apple/i);};_this.isHlsSource=function(source){return HLS_EXTENSIONS.test(source);};_this.destroyHls=function(){_this.setState({hlsPlaying:false});_this.hls&&_this.hls.destroy();};_this.startHls=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(source){var _this$props,setSupportedResolutions,setMediaType,setCurrentResolution,preferredResolutions,currentResolution,time,sdkUrl,Hls,videoElement;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,setSupportedResolutions=_this$props.setSupportedResolutions,setMediaType=_this$props.setMediaType,setCurrentResolution=_this$props.setCurrentResolution,preferredResolutions=_this$props.preferredResolutions,currentResolution=_this$props.currentResolution,time=_this$props.time;sdkUrl=_this.isSafari()?HLS_SDK_URL_SAFARI:HLS_SDK_URL;//https://github.com/video-dev/hls.js/issues/1543\n_context.next=4;return getSDK(sdkUrl,\"Hls\");case 4:Hls=_context.sent;if(Hls.isSupported()){_context.next=7;break;}return _context.abrupt(\"return\",setMediaType&&setMediaType(MediaTypes.MP4));case 7:_this.Hls=Hls;_this.hls=new Hls({autoStartLoad:false});_this.hls.loadSource(source);videoElement=document.getElementById(\"video-element\");_this.hls.attachMedia(videoElement);_this.hls.on(Hls.Events.MANIFEST_PARSED,function(event,data){_this.hls.startLoad(time||0);var autoLevel={height:\"Auto\",index:-1};var supportedResolutions=data.levels.map(function(r){return{width:r.width,height:r.height,index:data.levels.indexOf(r)};});setSupportedResolutions&&setSupportedResolutions(supportedResolutions.concat(autoLevel));var preferredResolution=preferredResolutions.hls?preferredResolutions.hls:null;var newResolution=preferredResolution&&supportedResolutions.find(function(r){return preferredResolution.width===r.width&&preferredResolution.height===r.height;});if(!newResolution){setCurrentResolution&&setCurrentResolution(autoLevel);return;}_this.hls&&(_this.hls.currentLevel=newResolution.index);var resolutionShouldChange=newResolution!==currentResolution;resolutionShouldChange&&setCurrentResolution&&setCurrentResolution(newResolution);});_this.hls.on(Hls.Events.ERROR,_this.handleHlsError.bind(_assertThisInitialized(_this)));_this.hls.on(Hls.Events.MEDIA_ATTACHED,function(event,data){_this.setState({hlsPlaying:true});});case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.onHlsLevelChange=function(_ref2){var height=_ref2.height,index=_ref2.index;var _this$props2=_this.props,currentResolution=_this$props2.currentResolution,setCurrentResolution=_this$props2.setCurrentResolution;if(height===currentResolution.height){return;}_this.hls&&(_this.hls.currentLevel=index);setCurrentResolution&&setCurrentResolution({height:height,index:index});};_this.requestNewUrls=function(){var setLoading=_this.props.setLoading;setLoading&&setLoading(true);};_this.onMediaTypeChange=function(newMediaType){var _this$props3=_this.props,setSupportedResolutions=_this$props3.setSupportedResolutions,setCurrentResolution=_this$props3.setCurrentResolution,preferredResolutions=_this$props3.preferredResolutions;console.log(\"Mediatype: \",newMediaType);if(newMediaType!==MediaTypes.HLS){setSupportedResolutions&&setSupportedResolutions(DefaultResolutions[newMediaType]);var resolution=preferredResolutions&&preferredResolutions[newMediaType];setCurrentResolution&&setCurrentResolution(resolution);}if(newMediaType===MediaTypes.WEBM||newMediaType===MediaTypes.MP4){_this.requestNewUrls();}};_this.iosEndFullscreen=function(){_this.props.setFullscreen(FullscreenState.NORMAL);};_this.setVolume=function(percent){var onReady=_this.state.onReady;onReady.then(function(){var player=_this.element.current;player&&percent===0?player.muted=true:player.muted=false;// player.volume is read only on mobile iOS\nplayer&&isFinite(percent)&&(player.volume=percent);});};_this.setPlaybackRate=function(rate){var onReady=_this.state.onReady;onReady.then(function(){var player=_this.element.current;player&&(player.playbackRate=rate);});};_this.onCaptionUpdate=function(e){};_this.toggleCaptions=function(language){var onReady=_this.state.onReady;onReady.then(function(){var player=_this.element.current;player&&_toConsumableArray(player.textTracks).forEach(function(track){if(track.mode===\"showing\"&&track.language!==language.code)track.mode=\"disabled\";if(track.language===language.code){track.oncuechange=_this.onCaptionUpdate;track.mode=\"hidden\";}else{track.oncuechange=null;}});});};_this.seekTo=function(amount){var onReady=_this.state.onReady;onReady.then(function(){var player=_this.element.current;player&&(player.currentTime=amount);});};_this.onRateChange=function(rate){var player=_this.element.current;player&&_this.setState({reportedPlaybackRate:player.playbackRate});};_this.onVolumeChange=function(rate){var player=_this.element.current;player&&_this.setState({reportedVolume:player.volume});};_this.onPlay=function(){var setPlaying=_this.props.setPlaying;// const { isStagingEnv, urls, currentUrlIndex, userId } = this.props\n_this.setState({isPlaying:true});// const currentUrl = urls[currentUrlIndex || 0]\n// // sendPlaySuccessEvent(currentUrl, isStagingEnv, userId)\nsetPlaying&&setPlaying(true);_this.updateProgress();};_this.onPause=function(){var setPlaying=_this.props.setPlaying;_this.setState({isPlaying:false});setPlaying&&setPlaying(false);};_this.onCanPlay=function(){var _this$props4=_this.props,setBuffering=_this$props4.setBuffering,buffering=_this$props4.buffering,loading=_this$props4.loading,setLoading=_this$props4.setLoading;_this.setState({canPlay:true});if(loading)setLoading&&setLoading(false);if(buffering){setBuffering&&setBuffering(false);//adobeHeartbeat && adobeHeartbeat.trackBufferComplete()\n}};_this.onLoadedData=function(){var _this$props5=_this.props,setBuffering=_this$props5.setBuffering,buffering=_this$props5.buffering,setOverlay=_this$props5.setOverlay;var onReady=_this.state.onReady;if(!buffering){_this.setState({isBuffering:true});setBuffering&&setBuffering(true);}setOverlay&&setOverlay(null);onReady.then(function(){var player=_this.element.current;//adobeHeartbeat && adobeHeartbeat.initHeartbeat(player.duration)\n});};_this.onEnded=function(e){var _this$props6=_this.props,pause=_this$props6.pause,clipId=_this$props6.clipId,time=_this$props6.time,currentLecture=_this$props6.currentLecture,views=_this$props6.views,course=_this$props6.course,route=_this$props6.route,setCurrentLecture=_this$props6.setCurrentLecture,setNextUrl=_this$props6.setNextUrl,setClipId=_this$props6.setClipId,setSubtitle=_this$props6.setSubtitle,history=_this$props6.history;// end && end()\npause&&pause(false);console.log('History',history);// adobeHeartbeat && adobeHeartbeat.trackComplete()\nif(views&&views.length){var _course$sections;var view=views.find(function(view){return view.lecture==(currentLecture===null||currentLecture===void 0?void 0:currentLecture.id);});view&&store.dispatch(updateVideoViews.initiate({id:view.id,lecture:currentLecture===null||currentLecture===void 0?void 0:currentLecture.id,complete:true,progress:time}));var lectures=course&&((_course$sections=course.sections)===null||_course$sections===void 0?void 0:_course$sections.flatMap(function(sec){return sec.lectures;}));if(lectures&&lectures.length){var currentUrlIndex=lectures===null||lectures===void 0?void 0:lectures.findIndex(function(lec){return lec.id==(currentLecture===null||currentLecture===void 0?void 0:currentLecture.id);});if(currentUrlIndex<lectures.length-1){var nextLectureIndex=currentUrlIndex+1;var lecture=lectures[nextLectureIndex];history===null||history===void 0?void 0:history.push({search:\"?\"+new URLSearchParams({clipid:lecture===null||lecture===void 0?void 0:lecture.video.key})});lecture&&setNextUrl(lecture.video_url);lecture&&setCurrentLecture(lecture);lecture&&setSubtitle(lecture===null||lecture===void 0?void 0:lecture.title);lecture&&setClipId(lecture===null||lecture===void 0?void 0:lecture.video.key);}else{var _lecture=lectures[0];history===null||history===void 0?void 0:history.push({search:\"?\"+new URLSearchParams({clipid:_lecture===null||_lecture===void 0?void 0:_lecture.video.key})});_lecture&&setNextUrl(_lecture.video_url);_lecture&&setCurrentLecture(_lecture);_lecture&&setSubtitle(_lecture===null||_lecture===void 0?void 0:_lecture.title);_lecture&&setClipId(_lecture===null||_lecture===void 0?void 0:_lecture.video.key);}}}};_this.updateTracks=function(videoElement){// const { closedCaptioningLanguage, closedCaptioningEnabled, setClosedCaptioningCueList } = this.props\n// const tracks = videoElement && videoElement.textTracks\n// tracks &&\n//   Object.values(tracks).forEach((track) => {\n//     const isActive = closedCaptioningEnabled && track.language === closedCaptioningLanguage.code\n//     if (isActive) {\n//       track.mode = 'hidden'\n//       videoElement.textTracks[0].mode = 'hidden' // Firefox\n//       track.oncuechange = (e) => {\n//         e.currentTarget.activeCues && setClosedCaptioningCueList(e.currentTarget.activeCues)\n//       }\n//     } else {\n//       track.mode = 'disabled'\n//     }\n//   })\n};_this.onLoadedMetadata=function(){var _this$props7=_this.props,ready=_this$props7.ready,registerPlayer=_this$props7.registerPlayer;_this.ready();var duration=_this.getDuration();ready&&ready(duration);var videoElement=document.getElementById(\"video-element\");registerPlayer&&registerPlayer(videoElement);// this.updateTracks(videoElement)\n};_this.getSrc=function(_ref3){var currentUrl=_ref3.currentUrl;// return currentUrlIndex !== null && urls && urls.length > 0 ? urls[currentUrlIndex].url : null\nvar source=currentUrl;return source;};_this.onSeeking=function(){// const { adobeHeartbeat } = this.props\n// adobeHeartbeat && adobeHeartbeat.trackSeekStart()\n};_this.onSeeked=function(){// const { adobeHeartbeat } = this.props\n// adobeHeartbeat && adobeHeartbeat.trackSeekComplete()\n};_this.updateProgress=function(){var _this$props8=_this.props,clipId=_this$props8.clipId,setTime=_this$props8.setTime,playing=_this$props8.playing;if(!playing)return;var reportedTime=_this.getPlayedSeconds();setTime&&setTime(reportedTime);reportedTime>0&&_this.throttledSetClipProgress({clipId:clipId,videoSecondsWatched:reportedTime});_this.progressTimeout=setTimeout(_this.updateProgress,50);};_this.onProgress=function(){var setBufferedTime=_this.props.setBufferedTime;var bufferedTime=_this.getSecondsLoaded();setBufferedTime&&setBufferedTime(bufferedTime);};_this.onWaiting=function(){var setBuffering=_this.props.setBuffering;//adobeHeartbeat && adobeHeartbeat.trackBufferStart()\nsetBuffering&&setBuffering(true);};_this.state=_objectSpread(_objectSpread({},initialState),{},{clipId:props.clipId,onReady:_this.newReadyPromise(),hlsPlaying:false,videoSrc:null});_this.element=/*#__PURE__*/React.createRef();return _this;}_createClass(Video,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props9=this.props,playing=_this$props9.playing,volume=_this$props9.volume,muted=_this$props9.muted,playbackRate=_this$props9.playbackRate,time=_this$props9.time,mediaType=_this$props9.mediaType,currentResolution=_this$props9.currentResolution,setClipProgress=_this$props9.setClipProgress;this.throttledSetClipProgress=throttle(setClipProgress,1000);var src=this.getSrc(this.props);if(muted||volume!==null){volume&&this.setVolume(muted?0:volume);}if(playbackRate){this.setPlaybackRate(playbackRate);}if(time){this.seekTo(time);}if(src){this.maybeStartHls(src,mediaType);}this.onMediaTypeChange(mediaType);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.destroyHls();clearTimeout(this.progressTimeout);}},{key:\"maybeStartHls\",value:function maybeStartHls(source,mediaType){var setMediaType=this.props.setMediaType;var hlsPlaying=this.state.hlsPlaying;var isHlsSource=this.isHlsSource(source);var shouldPlayHls=mediaType===MediaTypes.HLS&&isHlsSource;if(hlsPlaying)this.destroyHls();if(shouldPlayHls){this.startHls(source);}if(mediaType===MediaTypes.HLS&&!shouldPlayHls){setMediaType&&setMediaType(MediaTypes.MP4);}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var _this$props10=this.props,clipId=_this$props10.clipId,mediaType=_this$props10.mediaType,currentResolution=_this$props10.currentResolution;var _this$state=this.state,reportedPlaybackRate=_this$state.reportedPlaybackRate,reportedVolume=_this$state.reportedVolume,ready=_this$state.ready,isPlaying=_this$state.isPlaying,hlsPlaying=_this$state.hlsPlaying;var newSource=this.getSrc(nextProps);// Handle URL change\nvar sourceDidChange=clipId!==nextProps.clipId||mediaType!==nextProps.mediaType||this.getSrc(this.props)!==newSource;var resolutionDidChange=nextProps.currentResolution!==currentResolution;var mediaTypeDidChange=mediaType&&mediaType!==nextProps.mediaType;if(mediaTypeDidChange)this.onMediaTypeChange(nextProps.mediaType);if(sourceDidChange&&newSource){this.maybeStartHls(newSource,mediaType);}if(sourceDidChange&&ready){this.setState({onReady:this.newReadyPromise(),ready:false,reportedVolume:null,reportedPlaybackRate:null,isPlaying:null},function(){});}if(!ready){return;}// Handle playing change\nif(nextProps.playing&&!isPlaying){this.play(true);}if(!nextProps.playing&&isPlaying){this.pause(true);}// Handle volume change\nif(nextProps.volume!==null||nextProps.muted){if(!nextProps.muted){if(nextProps.volume!==reportedVolume){this.setVolume(nextProps.volume);}}if(nextProps.muted&&reportedVolume!==0){this.setVolume(0);}}if(nextProps.playbackRate!==reportedPlaybackRate){this.setPlaybackRate(nextProps.playbackRate);}// Handle time change\nvar timeDelta=Math.abs(nextProps.time-this.getPlayedSeconds());if(timeDelta>=1){this.seekTo(nextProps.time);}if(resolutionDidChange&&hlsPlaying)this.onHlsLevelChange(nextProps.currentResolution);}},{key:\"connectIosFullscreenExit\",value:function connectIosFullscreenExit(){var _this2=this;var onReady=this.state.onReady;onReady.then(function(){var player=_this2.element.current;if(player.webkitExitFullscreen){player.addEventListener(\"webkitendfullscreen\",_this2.iosEndFullscreen,false);}});}//#region Player API\n},{key:\"play\",value:function play(){var _this3=this;var onReady=this.state.onReady;onReady.then(function(){//   const { adobeHeartbeat, clipId, title } = this.props\nvar player=_this3.element.current;if(player){var promise=player.play();// adobeHeartbeat && adobeHeartbeat.trackPlay()\nif(promise){promise.catch(function(e){var pause=_this3.props.pause;pause&&pause(false);});}}});}},{key:\"pause\",value:function pause(){var _this4=this;var onReady=this.state.onReady;onReady.then(function(){var player=_this4.element.current;player&&player.pause();});}},{key:\"getDuration\",value:function getDuration(){var player=this.element.current;return player?player.duration:0;}},{key:\"getPlayedSeconds\",value:function getPlayedSeconds(){var player=this.element.current;return player?player.currentTime:0;}},{key:\"getSecondsLoaded\",value:function getSecondsLoaded(){var player=this.element.current;if(!player){return 0;}var bufferedLength=player.buffered.length;if(bufferedLength===0)return 0;var maxBuffered=0,currentBuffered;for(var i=0;i<bufferedLength;i++){currentBuffered=player.buffered.end(i);maxBuffered=currentBuffered>maxBuffered?currentBuffered:maxBuffered;}return maxBuffered;}//#endregion\n},{key:\"renderTrack\",value:function renderTrack(language){}},{key:\"handleHlsError\",value:function handleHlsError(event,data){// const { onVideoError } = this.props\n// if (data.fatal) {\n//   switch (data.type) {\n//     case this.Hls.ErrorTypes.MEDIA_ERROR:\n//       this.hls.recoverMediaError()\n//       break\n//     default:\n//       this.destroyHls()\n//       onVideoError && onVideoError(mapHlsError(data), 'handleHlsError')\n//       break\n//   }\n// }\n}},{key:\"render\",value:function render(){// const { onVideoError, versionId, closedCaptioningLanguage, mediaType } = this.props\nvar _this$props11=this.props,playbackRate=_this$props11.playbackRate,mediaType=_this$props11.mediaType,supportedResolutions=_this$props11.supportedResolutions,buffering=_this$props11.buffering,loading=_this$props11.loading;var source=this.getSrc(this.props);//let source = \"https://archive.org/download/ElephantsDream/ed_1024_512kb.mp4\";\nif(!source){return/*#__PURE__*/_jsx(\"div\",{className:css.video});}if(mediaType===MediaTypes.HLS)source=undefined;return/*#__PURE__*/_jsx(\"video\",{id:\"video-element\",className:css.video,ref:this.element,src:source,preload:\"auto\",playsInline:true,autoPlay:true,controls:false,loop:false,onLoadedMetadata:this.onLoadedMetadata,onLoadedData:this.onLoadedData,onCanPlay:this.onCanPlay,onPlay:this.onPlay,onSeeking:this.onSeeking,onSeeked:this.onSeeked,onPause:this.onPause,onEnded:this.onEnded,onVolumeChange:this.onVolumeChange,onRateChange:this.onRateChange,onWaiting:this.onWaiting,onProgress:this.onProgress// onError={(e) => {\n//   const { current: player } = this.element\n//   onVideoError && onVideoError(mapGenericVideoError(player.error), 'videoElement.onError')\n// }}\n},source);}}]);return Video;}(Component);export default connector(withRouter(Video));","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/video/video.tsx"],"names":["React","Component","connect","withRouter","updateVideoViews","store","play","pause","setVolume","setTime","ready","seekEnd","seekStart","setBufferedTime","setMediaType","setOverlay","setBuffering","setFullscreen","setLoading","setAutoplay","setPlaying","setCurrentResolution","setPreferredResolutions","setSupportedResolutions","setClipProgress","setCurrentUrl","setClipId","setSubtitle","setCurrentLecture","css","DefaultResolutions","FullscreenState","HLS_SDK_URL","HLS_SDK_URL_SAFARI","MediaTypes","getSDK","throttle","HLS_EXTENSIONS","initialState","isPlaying","reportedVolume","reportedPlaybackRate","isBuffering","canPlay","mapState","state","ownProps","playing","player","playbackRate","playbackSpeed","volume","buffering","views","route","history","currentLecture","loading","course","clipId","muted","time","currentUrl","mediaType","overlay","currentResolution","supportedResolutions","preferredResolutions","mapDispatch","dispatch","payload","setDuration","setNextUrl","connector","Video","props","newReadyPromise","Promise","resolve","setState","isSafari","navigator","vendor","match","isHlsSource","source","test","destroyHls","hlsPlaying","hls","destroy","startHls","sdkUrl","Hls","isSupported","MP4","autoStartLoad","loadSource","videoElement","document","getElementById","attachMedia","on","Events","MANIFEST_PARSED","event","data","startLoad","autoLevel","height","index","levels","map","r","width","indexOf","concat","preferredResolution","newResolution","find","currentLevel","resolutionShouldChange","ERROR","handleHlsError","bind","MEDIA_ATTACHED","onHlsLevelChange","requestNewUrls","onMediaTypeChange","newMediaType","console","log","HLS","resolution","WEBM","iosEndFullscreen","NORMAL","percent","onReady","then","element","current","isFinite","setPlaybackRate","rate","onCaptionUpdate","e","toggleCaptions","language","textTracks","forEach","track","mode","code","oncuechange","seekTo","amount","currentTime","onRateChange","onVolumeChange","onPlay","updateProgress","onPause","onCanPlay","onLoadedData","onEnded","length","view","lecture","id","initiate","complete","progress","lectures","sections","flatMap","sec","currentUrlIndex","findIndex","lec","nextLectureIndex","push","search","URLSearchParams","clipid","video","key","video_url","title","updateTracks","onLoadedMetadata","registerPlayer","duration","getDuration","getSrc","onSeeking","onSeeked","reportedTime","getPlayedSeconds","throttledSetClipProgress","videoSecondsWatched","progressTimeout","setTimeout","onProgress","bufferedTime","getSecondsLoaded","onWaiting","videoSrc","createRef","src","maybeStartHls","clearTimeout","shouldPlayHls","nextProps","newSource","sourceDidChange","resolutionDidChange","mediaTypeDidChange","timeDelta","Math","abs","webkitExitFullscreen","addEventListener","promise","catch","bufferedLength","buffered","maxBuffered","currentBuffered","i","end","undefined"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { RouteComponentProps, withRouter } from \"react-router-dom\";\nimport { updateVideoViews } from \"services/courses\";\nimport { AppDispatch, RootState, store } from 'store';\nimport {\n  play,\n  pause,\n  setVolume,\n  setDuration,\n  setTime,\n  ready,\n  seekEnd,\n  seekStart,\n  registerPlayer,\n  setBufferedTime,\n  setMediaType,\n  setOverlay,\n  setBuffering,\n  setFullscreen,\n  setLoading,\n  setAutoplay,\n  setPlaying,\n  setCurrentResolution,\n  setPreferredResolutions,\n  setSupportedResolutions,\n  setClipProgress,\n  setCurrentUrl,\n  setClipId,\n  setSubtitle,\n  setCurrentLecture\n} from \"state/player/playerSlice\";\nimport css from \"./video.module.css\";\n\nimport { DefaultResolutions } from \"../constants\";\n\n// import withAdobeHeartbeat from './with-adobe-heartbeat'\n\nimport {\n  FullscreenState,\n  HLS_SDK_URL,\n  HLS_SDK_URL_SAFARI,\n  MediaTypes,\n} from \"../constants\";\nimport { getSDK } from \"../utilities/get-sdk\";\nimport { throttle } from \"../utilities/throttle\";\n// import { sendPlaySuccessEvent } from '../../analytics/player-events'\nimport { mapHlsError, mapGenericVideoError } from \"../utilities/video-error\";\nimport { Truncate } from \"@codecademy/gamut\";\nimport { connected } from \"process\";\n\nconst HLS_EXTENSIONS = /\\.(m3u8)($|\\?)/i;\nconst initialState = {\n  isPlaying: false,\n  reportedVolume: null,\n  reportedPlaybackRate: 1,\n  isBuffering: false,\n  canPlay: false,\n  ready: true,\n};\n\nconst mapState = (state: RootState, ownProps: RouteComponentProps<{ id: string }>) => ({\n  playing: state.player.playing,\n  playbackRate: state.player.playbackSpeed,\n  volume: state.player.volume,\n  buffering: state.player.buffering,\n  views: state.player.views,\n  route: ownProps.history,\n  currentLecture: state.player.currentLecture,\n  loading: state.player.loading,\n  course: state.player.course,\n  clipId: state.player.clipId,\n  muted: state.player.muted,\n  time: state.player.time,\n  currentUrl: state.player.currentUrl,\n  mediaType: state.player.mediaType,\n  overlay: state.player.overlay,\n  currentResolution: state.player.currentResolution,\n  supportedResolutions: state.player.supportedResolutions,\n  preferredResolutions: state.player.preferredResolutions,\n});\n\nconst mapDispatch = (dispatch: AppDispatch) => ({\n  setVolume: (payload) => dispatch(setVolume(payload)),\n  setDuration: (payload) => dispatch(setVolume(payload)),\n  setTime: (payload) => dispatch(setTime(payload)),\n  setBufferedTime: (payload) => dispatch(setBufferedTime(payload)),\n  ready: (payload) => dispatch(ready(payload)),\n  seekEnd: (payload) => dispatch(seekEnd()),\n  setNextUrl: (payload) => dispatch(setCurrentUrl(payload)),\n  seekStart: (payload) => dispatch(seekStart()),\n  play: (payload) => dispatch(play(payload)),\n  pause: (payload) => dispatch(pause(payload)),\n  setCurrentLecture: (payload) => dispatch(setCurrentLecture(payload)),\n  setClipId: (payload) => dispatch(setClipId(payload)),\n  setSubtitle: (payload) => dispatch(setSubtitle(payload)),\n  setBuffering: (payload) => dispatch(setBuffering(payload)),\n  setOverlay: (payload) => dispatch(setOverlay(payload)),\n  setFullscreen: (payload) => dispatch(setFullscreen(payload)),\n  setLoading: (payload) => dispatch(setLoading(payload)),\n  setPlaying: (payload) => dispatch(setPlaying(payload)),\n  setClipProgress: (payload) => dispatch(setClipProgress(payload)),\n  setAutoplay: (payload) => dispatch(setAutoplay(payload)),\n  setMediaType: (payload) => dispatch(setMediaType(payload)),\n  setCurrentResolution: (payload) => dispatch(setCurrentResolution(payload)),\n  setPreferredResolutions: (payload) =>\n    dispatch(setPreferredResolutions(payload)),\n  setSupportedResolutions: (payload) =>\n    dispatch(setSupportedResolutions(payload)),\n});\n\n\nconst connector = connect(mapState, mapDispatch);\ntype VideoProps = ConnectedProps<typeof connector> & RouteComponentProps;\n\nexport class Video extends Component<VideoProps, any> {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ...initialState,\n      clipId: props.clipId,\n      onReady: this.newReadyPromise(),\n      hlsPlaying: false,\n      videoSrc: null,\n    };\n\n    this.element = React.createRef();\n  }\n\n  newReadyPromise = () => {\n    return new Promise((resolve) => {\n      this.ready = () => {\n        this.setState({ ready: true }, () => {\n          resolve();\n        });\n      };\n    });\n  };\n\n  isSafari = () => navigator.vendor.match(/apple/i);\n\n  componentDidMount() {\n    const {\n      playing,\n      volume,\n      muted,\n      playbackRate,\n      time,\n     \n      mediaType,\n      currentResolution,\n   \n      setClipProgress,\n    } = this.props;\n    this.throttledSetClipProgress = throttle(setClipProgress, 1000);\n    const src = this.getSrc(this.props);\n\n    if (muted || volume !== null) {\n      volume && this.setVolume(muted ? 0 : volume);\n    }\n\n    if (playbackRate) {\n      this.setPlaybackRate(playbackRate);\n    }\n\n    if (time) {\n      this.seekTo(time);\n    }\n\n    \n\n    if (src) {\n      this.maybeStartHls(src, mediaType);\n    }\n    this.onMediaTypeChange(mediaType);\n  }\n\n  componentWillUnmount() {\n    this.destroyHls();\n    clearTimeout(this.progressTimeout);\n  }\n\n  maybeStartHls(source, mediaType) {\n    const { setMediaType } = this.props;\n    const { hlsPlaying } = this.state;\n    const isHlsSource = this.isHlsSource(source);\n    const shouldPlayHls = mediaType === MediaTypes.HLS && isHlsSource;\n\n    if (hlsPlaying) this.destroyHls();\n\n    if (shouldPlayHls) {\n      this.startHls(source);\n    }\n\n    if (mediaType === MediaTypes.HLS && !shouldPlayHls) {\n      setMediaType && setMediaType(MediaTypes.MP4);\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const {\n     \n      clipId,\n     \n      mediaType,\n      currentResolution,\n \n    } = this.props;\n    const {\n      reportedPlaybackRate,\n      reportedVolume,\n      ready,\n      isPlaying,\n      hlsPlaying,\n    } = this.state;\n\n    const newSource = this.getSrc(nextProps);\n\n    // Handle URL change\n    const sourceDidChange = clipId !== nextProps.clipId ||\n      mediaType !== nextProps.mediaType ||\n      this.getSrc(this.props) !== newSource;\n\n  \n\n    const resolutionDidChange =\n      nextProps.currentResolution !== currentResolution;\n\n    const mediaTypeDidChange = mediaType && mediaType !== nextProps.mediaType;\n\n    if (mediaTypeDidChange) this.onMediaTypeChange(nextProps.mediaType);\n\n    if (sourceDidChange && newSource) {\n     \n      this.maybeStartHls(newSource, mediaType);\n    }\n\n    if (sourceDidChange && ready) {\n      this.setState(\n        {\n          onReady: this.newReadyPromise(),\n          ready: false,\n          reportedVolume: null,\n          reportedPlaybackRate: null,\n          isPlaying: null,\n        },\n        () => {\n        \n        }\n      );\n    }\n\n    if (!ready) {\n      return;\n    }\n\n    // Handle playing change\n    if (nextProps.playing && !isPlaying) {\n      this.play(true);\n    }\n    if (!nextProps.playing && isPlaying) {\n      this.pause(true);\n    }\n\n    // Handle volume change\n    if (nextProps.volume !== null || nextProps.muted) {\n      if (!nextProps.muted) {\n        if (nextProps.volume !== reportedVolume) {\n          this.setVolume(nextProps.volume);\n        }\n      }\n\n      if (nextProps.muted && reportedVolume !== 0) {\n        this.setVolume(0);\n      }\n    }\n\n    if (nextProps.playbackRate !== reportedPlaybackRate) {\n      this.setPlaybackRate(nextProps.playbackRate);\n    }\n\n    // Handle time change\n    const timeDelta = Math.abs(nextProps.time - this.getPlayedSeconds());\n\n    if (timeDelta >= 1) {\n      this.seekTo(nextProps.time);\n    }\n\n    \n\n    if (resolutionDidChange && hlsPlaying)\n      this.onHlsLevelChange(nextProps.currentResolution);\n  }\n\n  isHlsSource = (source) => HLS_EXTENSIONS.test(source);\n\n  destroyHls = () => {\n    this.setState({ hlsPlaying: false });\n    this.hls && this.hls.destroy();\n  };\n\n  startHls = async (source) => {\n    const {\n      setSupportedResolutions,\n      setMediaType,\n      setCurrentResolution,\n      preferredResolutions,\n      currentResolution,\n      time,\n    } = this.props;\n    const sdkUrl = this.isSafari() ? HLS_SDK_URL_SAFARI : HLS_SDK_URL; //https://github.com/video-dev/hls.js/issues/1543\n    const Hls = await getSDK(sdkUrl, \"Hls\");\n    if (!Hls.isSupported()) return setMediaType && setMediaType(MediaTypes.MP4);\n    this.Hls = Hls;\n\n    this.hls = new Hls({ autoStartLoad: false });\n    this.hls.loadSource(source);\n\n    const videoElement = document.getElementById(\"video-element\");\n    this.hls.attachMedia(videoElement);\n\n    this.hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {\n      this.hls.startLoad(time || 0);\n      const autoLevel = { height: \"Auto\", index: -1 };\n      const supportedResolutions = data.levels.map((r) => ({\n        width: r.width,\n        height: r.height,\n        index: data.levels.indexOf(r),\n      }));\n      setSupportedResolutions &&\n        setSupportedResolutions(supportedResolutions.concat(autoLevel));\n\n      const preferredResolution = preferredResolutions.hls\n        ? preferredResolutions.hls\n        : null;\n      const newResolution =\n        preferredResolution &&\n        supportedResolutions.find(\n          (r) =>\n            preferredResolution.width === r.width &&\n            preferredResolution.height === r.height\n        );\n\n      if (!newResolution) {\n        setCurrentResolution && setCurrentResolution(autoLevel);\n        return;\n      }\n\n      this.hls && (this.hls.currentLevel = newResolution.index);\n      const resolutionShouldChange = newResolution !== currentResolution;\n      resolutionShouldChange &&\n        setCurrentResolution &&\n        setCurrentResolution(newResolution);\n    });\n    this.hls.on(Hls.Events.ERROR, this.handleHlsError.bind(this));\n    this.hls.on(Hls.Events.MEDIA_ATTACHED, (event, data) => {\n      this.setState({ hlsPlaying: true });\n    });\n  };\n\n  onHlsLevelChange = ({ height, index }) => {\n    const { currentResolution, setCurrentResolution } = this.props;\n\n    if (height === currentResolution.height) {\n      return;\n    }\n    this.hls && (this.hls.currentLevel = index);\n    setCurrentResolution && setCurrentResolution({ height, index });\n  };\n\n  requestNewUrls = () => {\n    const { setLoading } = this.props;\n    setLoading && setLoading(true);\n  };\n\n  onMediaTypeChange = (newMediaType) => {\n    const {\n      setSupportedResolutions,\n      setCurrentResolution,\n      preferredResolutions,\n    } = this.props;\n    console.log(\"Mediatype: \", newMediaType);\n    if (newMediaType !== MediaTypes.HLS) {\n      setSupportedResolutions &&\n        setSupportedResolutions(DefaultResolutions[newMediaType]);\n\n      const resolution =\n        preferredResolutions && preferredResolutions[newMediaType];\n      setCurrentResolution && setCurrentResolution(resolution);\n    }\n\n    if (newMediaType === MediaTypes.WEBM || newMediaType === MediaTypes.MP4) {\n      this.requestNewUrls();\n    }\n  };\n\n  iosEndFullscreen = () => {\n    this.props.setFullscreen(FullscreenState.NORMAL);\n  };\n\n  connectIosFullscreenExit() {\n    const { onReady } = this.state;\n    onReady.then(() => {\n      const { current: player } = this.element;\n      if (player.webkitExitFullscreen) {\n        player.addEventListener(\n          \"webkitendfullscreen\",\n          this.iosEndFullscreen,\n          false\n        );\n      }\n    });\n  }\n\n  //#region Player API\n  play() {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      //   const { adobeHeartbeat, clipId, title } = this.props\n      const { current: player } = this.element;\n\n      if (player) {\n        const promise = player.play();\n\n        // adobeHeartbeat && adobeHeartbeat.trackPlay()\n\n        if (promise) {\n          promise.catch((e) => {\n            const { pause } = this.props;\n            pause && pause(false);\n\n           \n          });\n        }\n      }\n    });\n  }\n\n  pause() {\n    const { onReady } = this.state;\n   \n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && player.pause();\n\n    });\n  }\n\n  setVolume = (percent) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n      player && percent === 0 ? (player.muted = true) : (player.muted = false); // player.volume is read only on mobile iOS\n      player && isFinite(percent) && (player.volume = percent);\n    });\n  };\n\n  setPlaybackRate = (rate) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && (player.playbackRate = rate);\n    });\n  };\n\n  onCaptionUpdate = (e) => {\n    \n  };\n\n  toggleCaptions = (language) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player &&\n        [...player.textTracks].forEach((track) => {\n          if (track.mode === \"showing\" && track.language !== language.code)\n            track.mode = \"disabled\";\n\n          if (track.language === language.code) {\n            track.oncuechange = this.onCaptionUpdate;\n            track.mode = \"hidden\";\n          } else {\n            track.oncuechange = null;\n          }\n        });\n    });\n  };\n\n  seekTo = (amount) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && (player.currentTime = amount);\n    });\n  };\n\n  getDuration() {\n    const { current: player } = this.element;\n\n    return player ? player.duration : 0;\n  }\n\n  getPlayedSeconds() {\n    const { current: player } = this.element;\n\n    return player ? player.currentTime : 0;\n  }\n\n  getSecondsLoaded() {\n    const { current: player } = this.element;\n\n    if (!player) {\n      return 0;\n    }\n\n    const bufferedLength = player.buffered.length;\n\n    if (bufferedLength === 0) return 0;\n\n    let maxBuffered = 0,\n      currentBuffered;\n    for (let i = 0; i < bufferedLength; i++) {\n      currentBuffered = player.buffered.end(i);\n      maxBuffered =\n        currentBuffered > maxBuffered ? currentBuffered : maxBuffered;\n    }\n\n    return maxBuffered;\n  }\n  //#endregion\n\n  onRateChange = (rate) => {\n    const { current: player } = this.element;\n\n    player && this.setState({ reportedPlaybackRate: player.playbackRate });\n  };\n\n  onVolumeChange = (rate) => {\n    const { current: player } = this.element;\n\n    player && this.setState({ reportedVolume: player.volume });\n  };\n\n  onPlay = () => {\n    const { setPlaying } = this.props;\n    // const { isStagingEnv, urls, currentUrlIndex, userId } = this.props\n    this.setState({ isPlaying: true });\n    // const currentUrl = urls[currentUrlIndex || 0]\n    // // sendPlaySuccessEvent(currentUrl, isStagingEnv, userId)\n    setPlaying && setPlaying(true);\n    this.updateProgress();\n  };\n\n  onPause = () => {\n    const { setPlaying } = this.props;\n    this.setState({ isPlaying: false });\n    setPlaying && setPlaying(false);\n  };\n\n  onCanPlay = () => {\n    const { setBuffering, buffering, loading, setLoading } =\n      this.props;\n\n    this.setState({ canPlay: true });\n    if (loading) setLoading && setLoading(false);\n\n    if (buffering) {\n      setBuffering && setBuffering(false);\n      //adobeHeartbeat && adobeHeartbeat.trackBufferComplete()\n    }\n  };\n\n  onLoadedData = () => {\n    const { setBuffering, buffering, setOverlay } = this.props;\n    const { onReady } = this.state;\n\n    if (!buffering) {\n      this.setState({ isBuffering: true });\n      setBuffering && setBuffering(true);\n    }\n\n    setOverlay && setOverlay(null);\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n      //adobeHeartbeat && adobeHeartbeat.initHeartbeat(player.duration)\n    });\n  };\n\n  onEnded = (e) => {\n    const {\n     \n      pause,\n     \n      clipId,\n      time,\n      currentLecture,\n      views,\n      course,\n      route,\n      setCurrentLecture,\n      setNextUrl,\n      setClipId,\n      setSubtitle,\n      history\n    } = this.props;\n\n    // end && end()\n\n    pause && pause(false);\n    console.log('History', history)\n    // adobeHeartbeat && adobeHeartbeat.trackComplete()\n    if (views && views.length) {\n      const view = views.find((view) => view.lecture == currentLecture?.id);\n      view && store.dispatch(updateVideoViews.initiate({\n        id: view.id,\n        lecture: currentLecture?.id,\n        complete: true,\n        progress: time,\n      }));\n      const lectures = course && course.sections?.flatMap(sec => sec.lectures)\n      \n      if (lectures && lectures.length) {\n        const currentUrlIndex = lectures?.findIndex(lec => lec.id == currentLecture?.id)\n        if(currentUrlIndex < (lectures.length - 1)) {\n          const nextLectureIndex = currentUrlIndex + 1\n          const lecture = lectures[nextLectureIndex]\n          \n          history?.push({\n            search: \"?\" + new URLSearchParams({ clipid: lecture?.video.key })\n          });\n          lecture && setNextUrl(lecture.video_url)\n          lecture && setCurrentLecture(lecture)\n          lecture && setSubtitle(lecture?.title)\n          lecture && setClipId(lecture?.video.key)\n          \n        } else {\n          const lecture = lectures[0]\n          history?.push({\n            search: \"?\" + new URLSearchParams({ clipid: lecture?.video.key })\n          });\n          lecture && setNextUrl(lecture.video_url)\n          lecture && setCurrentLecture(lecture)\n          lecture && setSubtitle(lecture?.title)\n          lecture && setClipId(lecture?.video.key)\n        }\n        \n      }\n    }\n\n \n  };\n\n  renderTrack(language) {\n \n  }\n\n  updateTracks = (videoElement) => {\n    // const { closedCaptioningLanguage, closedCaptioningEnabled, setClosedCaptioningCueList } = this.props\n    // const tracks = videoElement && videoElement.textTracks\n    // tracks &&\n    //   Object.values(tracks).forEach((track) => {\n    //     const isActive = closedCaptioningEnabled && track.language === closedCaptioningLanguage.code\n    //     if (isActive) {\n    //       track.mode = 'hidden'\n    //       videoElement.textTracks[0].mode = 'hidden' // Firefox\n    //       track.oncuechange = (e) => {\n    //         e.currentTarget.activeCues && setClosedCaptioningCueList(e.currentTarget.activeCues)\n    //       }\n    //     } else {\n    //       track.mode = 'disabled'\n    //     }\n    //   })\n  };\n\n  onLoadedMetadata = () => {\n    const { ready, registerPlayer } = this.props;\n    this.ready();\n\n    const duration = this.getDuration();\n    ready && ready(duration);\n\n    const videoElement = document.getElementById(\"video-element\");\n    registerPlayer && registerPlayer(videoElement);\n    // this.updateTracks(videoElement)\n  };\n\n  getSrc = ({  currentUrl } : VideoProps) => {\n    // return currentUrlIndex !== null && urls && urls.length > 0 ? urls[currentUrlIndex].url : null\n    let source = currentUrl;\n    return source;\n  };\n\n  onSeeking = () => {\n    // const { adobeHeartbeat } = this.props\n    // adobeHeartbeat && adobeHeartbeat.trackSeekStart()\n  };\n\n  onSeeked = () => {\n    // const { adobeHeartbeat } = this.props\n    // adobeHeartbeat && adobeHeartbeat.trackSeekComplete()\n  };\n\n  updateProgress = () => {\n    const { clipId, setTime, playing } = this.props;\n\n    if (!playing) return;\n\n    const reportedTime = this.getPlayedSeconds();\n    setTime && setTime(reportedTime);\n    reportedTime > 0 &&\n      this.throttledSetClipProgress({\n        clipId,\n        videoSecondsWatched: reportedTime,\n      });\n\n    this.progressTimeout = setTimeout(this.updateProgress, 50);\n  };\n\n  onProgress = () => {\n    const { setBufferedTime } = this.props;\n    const bufferedTime = this.getSecondsLoaded();\n\n    setBufferedTime && setBufferedTime(bufferedTime);\n  };\n\n  handleHlsError(event, data) {\n    // const { onVideoError } = this.props\n    // if (data.fatal) {\n    //   switch (data.type) {\n    //     case this.Hls.ErrorTypes.MEDIA_ERROR:\n    //       this.hls.recoverMediaError()\n    //       break\n    //     default:\n    //       this.destroyHls()\n    //       onVideoError && onVideoError(mapHlsError(data), 'handleHlsError')\n    //       break\n    //   }\n    // }\n  }\n\n  onWaiting = () => {\n    const {  setBuffering } = this.props;\n    //adobeHeartbeat && adobeHeartbeat.trackBufferStart()\n    setBuffering && setBuffering(true);\n  };\n\n  render() {\n    // const { onVideoError, versionId, closedCaptioningLanguage, mediaType } = this.props\n    const {\n      playbackRate,\n      mediaType,\n      supportedResolutions,\n      buffering,\n      loading,\n    } = this.props;\n\n    let source = this.getSrc(this.props);\n    //let source = \"https://archive.org/download/ElephantsDream/ed_1024_512kb.mp4\";\n\n    if (!source) {\n      return <div className={css.video} />;\n    }\n\n    if (mediaType === MediaTypes.HLS) source = undefined;\n\n    return (\n      <video\n        id=\"video-element\"\n        key={source}\n        className={css.video}\n        ref={this.element}\n        src={source}\n        preload=\"auto\"\n        playsInline\n        autoPlay\n        controls={false}\n        loop={false}\n        onLoadedMetadata={this.onLoadedMetadata}\n        onLoadedData={this.onLoadedData}\n        onCanPlay={this.onCanPlay}\n        onPlay={this.onPlay}\n        onSeeking={this.onSeeking}\n        onSeeked={this.onSeeked}\n        onPause={this.onPause}\n        onEnded={this.onEnded}\n        onVolumeChange={this.onVolumeChange}\n        onRateChange={this.onRateChange}\n        onWaiting={this.onWaiting}\n        onProgress={this.onProgress}\n        // onError={(e) => {\n        //   const { current: player } = this.element\n        //   onVideoError && onVideoError(mapGenericVideoError(player.error), 'videoElement.onError')\n        // }}\n      >\n        {/* {closedCaptioningLanguage && versionId && this.renderTrack(closedCaptioningLanguage)} */}\n      </video>\n    );\n  }\n}\n\n\nexport default connector(withRouter((Video)));\n\n\n"]},"metadata":{},"sourceType":"module"}