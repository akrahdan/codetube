{"ast":null,"code":"import _defineProperty from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import classNames from'classnames';import React,{Component,createRef}from'react';// import { connect } from 'unistore/react';\nimport{connect}from'react-redux';import{setPlaybackSpeed as _setPlaybackSpeed,setActiveMenu as _setActiveMenu}from'state/player/playerSlice';// import * as actions from '../../actions'\nimport css from'./playback-speed-selector.module.scss';import{InteractionModes,Menus,PlaybackSpeedStops as stops}from'../constants';import{valuesIn}from'lodash';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";export var PlaybackSpeedSelector=/*#__PURE__*/function(_Component){_inherits(PlaybackSpeedSelector,_Component);var _super=_createSuper(PlaybackSpeedSelector);function PlaybackSpeedSelector(props){var _this;_classCallCheck(this,PlaybackSpeedSelector);_this=_super.call(this,props);_this.setLocalPlaybackSpeed=function(i){return function(){return _this.setState({localPlaybackSpeed:i});};};_this.handleKeyDown=function(e){var keyCode=e.keyCode;var currentSpeed=_this.state.localPlaybackSpeed;// Right\nif(keyCode===39){e.preventDefault&&e.preventDefault();var currentIndex=_this.stopRefs[currentSpeed].index;var nextStopIndex=currentIndex<stops.length-1?currentIndex+1:0;var nextStop=stops[nextStopIndex];var nextStopRef=_this.stopRefs[nextStop];nextStopRef.ref.current.focus();_this.setPlaybackSpeed(nextStopRef.speed);}// Left\nif(keyCode===37){e.preventDefault&&e.preventDefault();var _currentIndex=_this.stopRefs[currentSpeed].index;var prevStopIndex=_currentIndex>0?_currentIndex-1:stops.length-1;var prevStop=stops[prevStopIndex];var prevStopRef=_this.stopRefs[prevStop];prevStopRef.ref.current.focus();_this.setPlaybackSpeed(prevStopRef.speed);}};_this.setPlaybackSpeed=function(i,onSpeedChanged){return function(){_this.setState({localPlaybackSpeed:i});_this.props.setPlaybackSpeed(i);onSpeedChanged&&onSpeedChanged();};};_this.closeMenu=function(){if(_this.isKeyboardMode){_this.props.setActiveMenu(Menus.NONE);_this.focusPreviousButton();}};_this.getSliderItems=function(playbackSpeed){return stops.reduce(function(items,i){var className=css.equalTo;if(i<playbackSpeed){className=css.lessThan;}else if(i>playbackSpeed){className=css.greaterThan;}return items.concat(/*#__PURE__*/_jsx(\"li\",{className:className,speed:i,onMouseOver:_this.setLocalPlaybackSpeed(i),onFocus:_this.setLocalPlaybackSpeed(i),onClick:_this.setPlaybackSpeed(i,_this.closeMenu),onTouchStart:_this.setPlaybackSpeed(i,_this.closeMenu),children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:css.button,\"aria-label\":\"\".concat(i),tabIndex:\"0\",id:\"playback-speed-option-\".concat(i),ref:_this.stopRefs[i].ref,children:[\"speed \",i,\"x\"]})},i));},[]);};_this.state={localPlaybackSpeed:props.playbackSpeed||1};_this.menuRef=/*#__PURE__*/createRef();_this.trapTabs=_this.trapTabs.bind(_assertThisInitialized(_this));_this.stopRefs={};stops.forEach(function(stop,i){_this.stopRefs[stop]={ref:/*#__PURE__*/createRef(),index:i,speed:stop};});return _this;}_createClass(PlaybackSpeedSelector,[{key:\"isKeyboardMode\",get:function get(){return this.props.interactionMode===InteractionModes.KEYBOARD;}},{key:\"trapTabs\",value:function trapTabs(e){if(e.which===27)this.closeMenu();if(e.which===9){var currentFocus=document.activeElement;var focusableChildren=Array.from(this.menuRef.current.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), object, embed, *[tabindex], *[contenteditable]'));var focusableCount=focusableChildren.length;var focusedIndex=focusableChildren.indexOf(currentFocus);if(e.shiftKey){if(focusedIndex===0){e.preventDefault();focusableChildren[focusableCount-1].focus();}}else{if(focusedIndex===focusableCount-1){e.preventDefault();focusableChildren[0].focus();}}}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(_ref){var prevActiveMenu=_ref.activeMenu;var _this$props=this.props,playbackSpeed=_this$props.playbackSpeed,activeMenu=_this$props.activeMenu;var menuChanged=activeMenu!==prevActiveMenu;var playbackSpeedMenuOpened=menuChanged&&activeMenu===Menus.PLAYBACK_SPEED;if(playbackSpeedMenuOpened){this.focusOnButtonByPlaybackSpeed(playbackSpeed);}}},{key:\"focusOnButtonByPlaybackSpeed\",value:function focusOnButtonByPlaybackSpeed(playbackSpeed){var button=this.container.querySelector(\"[speed=\\\"\".concat(playbackSpeed,\"\\\"] button\"));button&&button.focus();}},{key:\"focusPreviousButton\",value:function focusPreviousButton(){var prevSibling=this.container.previousElementSibling;var button=prevSibling&&prevSibling.querySelector('button');button&&button.focus();}},{key:\"render\",value:function render(){var _this2=this;var _this$props2=this.props,activeMenu=_this$props2.activeMenu,className=_this$props2.className,setActiveMenu=_this$props2.setActiveMenu;var localPlaybackSpeed=this.state.localPlaybackSpeed;return/*#__PURE__*/_jsxs(\"div\",{id:\"eplayer-speed-selector\",className:classNames(css.container,className,_defineProperty({},css.hidden,activeMenu!==Menus.PLAYBACK_SPEED)),\"aria-hidden\":activeMenu!==Menus.PLAYBACK_SPEED,ref:function ref(_ref2){return _this2.container=_ref2;},children:[/*#__PURE__*/_jsx(\"div\",{className:css.title,\"aria-label\":\"current speed: \".concat(localPlaybackSpeed),children:/*#__PURE__*/_jsxs(\"div\",{className:css['title__content'],\"data-widest\":\"Speed: 2.0x\",children:[\"Speed: \",localPlaybackSpeed.toFixed(1),\"x\"]})}),/*#__PURE__*/_jsx(\"div\",{ref:this.menuRef,tabIndex:\"-1\",onKeyDown:function onKeyDown(e){_this2.trapTabs(e);_this2.handleKeyDown(e);},children:/*#__PURE__*/_jsx(\"ol\",{className:css.slider,onClick:this.handleChange,\"aria-label\":\"set playback speed\",children:this.getSliderItems(localPlaybackSpeed)})})]});}}]);return PlaybackSpeedSelector;}(Component);export default connect(function(state){return{playbackSpeed:state.player.playbackSpeed,activeMenu:state.player.activeMenu};},function(dispatch){return{setPlaybackSpeed:function setPlaybackSpeed(payload){return dispatch(_setPlaybackSpeed(payload));},setActiveMenu:function setActiveMenu(payload){return dispatch(_setActiveMenu(payload));}};})(PlaybackSpeedSelector);// export default connect(\n//   (state) => ({\n//     interactionMode: state.interactionMode,\n//     activeMenu: state.activeMenu,\n//     playbackSpeed: state.playbackSpeed,\n//   }),\n//   (store) => ({\n//     setActiveMenu: actions.setActiveMenu,\n//     setPlaybackSpeed: actions.setPlaybackSpeed,\n//   })\n// )(PlaybackSpeedSelector)","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/playback-speed-selector/playback-speed-selector.js"],"names":["classNames","React","Component","createRef","connect","setPlaybackSpeed","setActiveMenu","css","InteractionModes","Menus","PlaybackSpeedStops","stops","valuesIn","PlaybackSpeedSelector","props","setLocalPlaybackSpeed","i","setState","localPlaybackSpeed","handleKeyDown","e","keyCode","currentSpeed","state","preventDefault","currentIndex","stopRefs","index","nextStopIndex","length","nextStop","nextStopRef","ref","current","focus","speed","prevStopIndex","prevStop","prevStopRef","onSpeedChanged","closeMenu","isKeyboardMode","NONE","focusPreviousButton","getSliderItems","playbackSpeed","reduce","items","className","equalTo","lessThan","greaterThan","concat","button","menuRef","trapTabs","bind","forEach","stop","interactionMode","KEYBOARD","which","currentFocus","document","activeElement","focusableChildren","Array","from","querySelectorAll","focusableCount","focusedIndex","indexOf","shiftKey","prevActiveMenu","activeMenu","menuChanged","playbackSpeedMenuOpened","PLAYBACK_SPEED","focusOnButtonByPlaybackSpeed","container","querySelector","prevSibling","previousElementSibling","hidden","title","toFixed","slider","handleChange","player","dispatch","payload"],"mappings":"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","sourcesContent":["import classNames from 'classnames'\r\nimport React, { Component, createRef } from 'react'\r\n// import { connect } from 'unistore/react';\r\nimport { connect} from 'react-redux';\r\nimport { setPlaybackSpeed, setActiveMenu } from 'state/player/playerSlice';\r\n\r\n// import * as actions from '../../actions'\r\nimport css from './playback-speed-selector.module.scss'\r\n\r\nimport { InteractionModes, Menus, PlaybackSpeedStops as stops } from '../constants'\r\nimport { valuesIn } from 'lodash';\r\n\r\nexport class PlaybackSpeedSelector extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = { localPlaybackSpeed: props.playbackSpeed || 1 }\r\n    this.menuRef = createRef()\r\n    this.trapTabs = this.trapTabs.bind(this)\r\n    this.stopRefs = {}\r\n    stops.forEach((stop, i) => {\r\n      this.stopRefs[stop] = {\r\n        ref: createRef(),\r\n        index: i,\r\n        speed: stop,\r\n      }\r\n    })\r\n  }\r\n\r\n  get isKeyboardMode() {\r\n    return this.props.interactionMode === InteractionModes.KEYBOARD\r\n  }\r\n\r\n  trapTabs(e) {\r\n    if (e.which === 27) this.closeMenu()\r\n    if (e.which === 9) {\r\n      const currentFocus = document.activeElement\r\n      const focusableChildren = Array.from(\r\n        this.menuRef.current.querySelectorAll(\r\n          'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), object, embed, *[tabindex], *[contenteditable]'\r\n        )\r\n      )\r\n      const focusableCount = focusableChildren.length\r\n\r\n      const focusedIndex = focusableChildren.indexOf(currentFocus)\r\n      if (e.shiftKey) {\r\n        if (focusedIndex === 0) {\r\n          e.preventDefault()\r\n          focusableChildren[focusableCount - 1].focus()\r\n        }\r\n      } else {\r\n        if (focusedIndex === focusableCount - 1) {\r\n          e.preventDefault()\r\n          focusableChildren[0].focus()\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate({ activeMenu: prevActiveMenu }) {\r\n    const { playbackSpeed, activeMenu } = this.props\r\n\r\n    const menuChanged = activeMenu !== prevActiveMenu\r\n    const playbackSpeedMenuOpened = menuChanged && activeMenu === Menus.PLAYBACK_SPEED\r\n\r\n    if (playbackSpeedMenuOpened) {\r\n      this.focusOnButtonByPlaybackSpeed(playbackSpeed)\r\n    }\r\n  }\r\n\r\n  focusOnButtonByPlaybackSpeed(playbackSpeed) {\r\n    const button = this.container.querySelector(`[speed=\"${playbackSpeed}\"] button`)\r\n    button && button.focus()\r\n  }\r\n\r\n  setLocalPlaybackSpeed = (i) => {\r\n    return () => this.setState({ localPlaybackSpeed: i })\r\n  }\r\n\r\n  handleKeyDown = (e) => {\r\n    const { keyCode } = e\r\n    const currentSpeed = this.state.localPlaybackSpeed\r\n\r\n    // Right\r\n    if (keyCode === 39) {\r\n      e.preventDefault && e.preventDefault()\r\n      const currentIndex = this.stopRefs[currentSpeed].index\r\n      const nextStopIndex = currentIndex < stops.length - 1 ? currentIndex + 1 : 0\r\n      const nextStop = stops[nextStopIndex]\r\n      const nextStopRef = this.stopRefs[nextStop]\r\n      nextStopRef.ref.current.focus()\r\n      this.setPlaybackSpeed(nextStopRef.speed)\r\n    }\r\n\r\n    // Left\r\n    if (keyCode === 37) {\r\n      e.preventDefault && e.preventDefault()\r\n      const currentIndex = this.stopRefs[currentSpeed].index\r\n      const prevStopIndex = currentIndex > 0 ? currentIndex - 1 : stops.length - 1\r\n      const prevStop = stops[prevStopIndex]\r\n      const prevStopRef = this.stopRefs[prevStop]\r\n      prevStopRef.ref.current.focus()\r\n      this.setPlaybackSpeed(prevStopRef.speed)\r\n    }\r\n  }\r\n\r\n  setPlaybackSpeed = (i, onSpeedChanged) => {\r\n    return () => {\r\n      this.setState({ localPlaybackSpeed: i })\r\n      this.props.setPlaybackSpeed(i)\r\n      onSpeedChanged && onSpeedChanged()\r\n    }\r\n  }\r\n\r\n  closeMenu = () => {\r\n    if (this.isKeyboardMode) {\r\n      this.props.setActiveMenu(Menus.NONE)\r\n      this.focusPreviousButton()\r\n    }\r\n  }\r\n\r\n  focusPreviousButton() {\r\n    const prevSibling = this.container.previousElementSibling\r\n    const button = prevSibling && prevSibling.querySelector('button')\r\n\r\n    button && button.focus()\r\n  }\r\n\r\n  render() {\r\n    const { activeMenu, className, setActiveMenu } = this.props\r\n    const { localPlaybackSpeed } = this.state\r\n\r\n    return (\r\n      <div\r\n        id=\"eplayer-speed-selector\"\r\n        className={classNames(css.container, className, {\r\n          [css.hidden]: activeMenu !== Menus.PLAYBACK_SPEED,\r\n        })}\r\n        aria-hidden={activeMenu !== Menus.PLAYBACK_SPEED}\r\n        ref={(ref) => (this.container = ref)}\r\n      >\r\n        <div className={css.title} aria-label={`current speed: ${localPlaybackSpeed}`}>\r\n          <div className={css['title__content']} data-widest=\"Speed: 2.0x\">\r\n            Speed: {localPlaybackSpeed.toFixed(1)}x\r\n          </div>\r\n        </div>\r\n        <div\r\n          ref={this.menuRef}\r\n          tabIndex=\"-1\"\r\n          onKeyDown={(e) => {\r\n            this.trapTabs(e)\r\n            this.handleKeyDown(e)\r\n          }}\r\n        >\r\n          <ol className={css.slider} onClick={this.handleChange} aria-label=\"set playback speed\">\r\n            {this.getSliderItems(localPlaybackSpeed)}\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  getSliderItems = (playbackSpeed) => {\r\n    return stops.reduce((items, i) => {\r\n      let className = css.equalTo\r\n      if (i < playbackSpeed) {\r\n        className = css.lessThan\r\n      } else if (i > playbackSpeed) {\r\n        className = css.greaterThan\r\n      }\r\n\r\n      return items.concat(\r\n        <li\r\n          className={className}\r\n          key={i}\r\n          speed={i}\r\n          onMouseOver={this.setLocalPlaybackSpeed(i)}\r\n          onFocus={this.setLocalPlaybackSpeed(i)}\r\n          onClick={this.setPlaybackSpeed(i, this.closeMenu)}\r\n          onTouchStart={this.setPlaybackSpeed(i, this.closeMenu)}\r\n        >\r\n          <button\r\n            type=\"button\"\r\n            className={css.button}\r\n            aria-label={`${i}`}\r\n            tabIndex=\"0\"\r\n            id={`playback-speed-option-${i}`}\r\n            ref={this.stopRefs[i].ref}\r\n          >\r\n            speed {i}x\r\n          </button>\r\n        </li>\r\n      )\r\n    }, [])\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  (state) => ({\r\n    playbackSpeed: state.player.playbackSpeed,\r\n    activeMenu: state.player.activeMenu,\r\n  }),\r\n  (dispatch) => ({\r\n    setPlaybackSpeed: payload => dispatch(setPlaybackSpeed(payload)),\r\n    setActiveMenu: payload => dispatch(setActiveMenu(payload)),\r\n  })\r\n)(PlaybackSpeedSelector);\r\n// export default connect(\r\n//   (state) => ({\r\n//     interactionMode: state.interactionMode,\r\n//     activeMenu: state.activeMenu,\r\n//     playbackSpeed: state.playbackSpeed,\r\n//   }),\r\n//   (store) => ({\r\n//     setActiveMenu: actions.setActiveMenu,\r\n//     setPlaybackSpeed: actions.setPlaybackSpeed,\r\n//   })\r\n// )(PlaybackSpeedSelector)\r\n"]},"metadata":{},"sourceType":"module"}