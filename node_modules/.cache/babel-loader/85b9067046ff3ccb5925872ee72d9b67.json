{"ast":null,"code":"import _regeneratorRuntime from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState}from\"react\";import cx from'classnames';import moment from'moment';import*as client from'filestack-js';import{selectResources}from\"state/course/courseSplice\";import{useCreateResourceMutation}from\"services/courses\";import{useAppSelector}from\"store/hooks\";import{selectLocationPayload}from\"state/location/selectors\";import{UploadProgress}from\"./UploadProgress\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var filestack=client.Filestack(process.env.REACT_APP_FILESTACK_APP_KEY,{});export var Resources=function Resources(_ref){var selectResource=_ref.selectResource,toggle=_ref.toggle,onSuccess=_ref.onSuccess;var _useState=useState('downloadable'),_useState2=_slicedToArray(_useState,2),active=_useState2[0],setActive=_useState2[1];var _useCreateResourceMut=useCreateResourceMutation(),_useCreateResourceMut2=_slicedToArray(_useCreateResourceMut,1),createResource=_useCreateResourceMut2[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),uploading=_useState4[0],setUploading=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),mediaResources=_useState8[0],setMediaResources=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];var _useState11=useState('Progress'),_useState12=_slicedToArray(_useState11,2),status=_useState12[0],setStatus=_useState12[1];var resources=useAppSelector(selectResources);var locationPayload=useAppSelector(selectLocationPayload);var onProgress=function onProgress(eve){console.log(eve.totalPercent);setProgress(eve.totalPercent);};var onUpload=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(files,onProgress){var mediaResponse,returnedResources;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:mediaResponse=Array.from(files).map(function(item){return item;});setStatus('Progress');setMediaResources(mediaResponse);setUploading(true);filestack.multiupload(files,{onProgress:onProgress}).then(function(results){results.forEach(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res,index){var media,successes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(res.status==\"Failed\")){_context.next=5;break;}console.log(res);setError(\"File failed to upload\");setStatus('Failed');return _context.abrupt(\"return\");case 5:media={name:res.name,filetype:res.type,key:res.handle,size:res.size,course:locationPayload.id};_context.prev=6;_context.next=9;return createResource(media).unwrap();case 9:returnedResources=_context.sent;if(index==results.length-1){successes=results.map(function(value){var resource=returnedResources.find(function(item){return item.key==value.handle;});if(resource&&resource.id){return resource.id;}});console.log(\"onSuccess: \",successes);onSuccess(successes);setStatus('Success');setUploading(false);}_context.next=18;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](6);setError(_context.t0);setStatus('Failed');console.log(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[6,13]]);}));return function(_x3,_x4){return _ref3.apply(this,arguments);};}());}).catch(function(err){setStatus('Failed');console.log(err);setError(err);});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function onUpload(_x,_x2){return _ref2.apply(this,arguments);};}();var validateFileType=function validateFileType(fileItem){var fileType=fileItem.filetype;// image/png image/jpeg\nvar rootType=fileType.split(\"/\")[0];switch(rootType){case\"image\":return'File';default:return'Video';}};return/*#__PURE__*/_jsx(\"div\",{className:\"pl10 pr10 pb10\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"supplementary-asset-creator\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"nav-container\",children:/*#__PURE__*/_jsxs(\"ul\",{\"data-purpose\":\"supplementary-asset-creator\",role:\"tablist\",className:\"nav nav-tabs\",children:[/*#__PURE__*/_jsx(\"li\",{role:\"presentation\",className:cx({'active':active=='downloadable'}),children:/*#__PURE__*/_jsx(\"a\",{onClick:function onClick(){return setActive('downloadable');},id:\"supplementary-asset-creator-tab-1\",role:\"tab\",\"aria-controls\":\"supplementary-asset-creator-pane-1\",\"aria-selected\":\"true\",children:\"Downloadable File\"})}),/*#__PURE__*/_jsx(\"li\",{role:\"presentation\",className:cx({'active':active=='library'}),children:/*#__PURE__*/_jsx(\"a\",{onClick:function onClick(){return setActive('library');},id:\"supplementary-asset-creator-tab-2\",role:\"tab\",\"aria-controls\":\"supplementary-asset-creator-pane-2\",\"aria-selected\":\"false\",tabIndex:-1,children:\"Add from library\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-content\",children:[/*#__PURE__*/_jsx(\"div\",{\"data-purpose\":\"file-uploader-tab\",id:\"supplementary-asset-creator-pane-1\",\"aria-labelledby\":\"supplementary-asset-creator-tab-1\",role:\"tabpanel\",\"aria-hidden\":\"false\",className:cx(\"tab-pane fade\",{'active in':active=='downloadable'}),children:/*#__PURE__*/_jsx(\"div\",{children:uploading?/*#__PURE__*/_jsx(UploadProgress,{error:error,status:status,progress:progress,mediaResources:mediaResources,toggleUpload:function toggleUpload(){return setUploading(!uploading);}}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-uploader--file-selector--SGCns\",\"data-purpose\":\"asset-uploader-input\",children:[/*#__PURE__*/_jsx(\"input\",{name:\"asset\",type:\"file\",multiple:true,onChange:function onChange(event){return onUpload(event.target.files,onProgress);},id:\"file-upload-10--23\",className:\"sr-only\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file-upload-10--23\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-control file-uploader--fake-file-input--1_ohV\",children:\"No file selected\"}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-btn\",children:/*#__PURE__*/_jsx(\"div\",{\"data-type\":\"button\",className:\"btn btn-default\",children:\"Select File\"})})]})})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"mt10 mb10\",\"data-purpose\":\"safely-set-inner-html:asset-uploader:note\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Note\"}),\": A resource is for any type of document that can be used to help students in the lecture. This file is going to be seen as a lecture extra. Make sure everything is legible and the file size is less than 1 GiB.\"]})})]})})}),/*#__PURE__*/_jsx(\"div\",{\"data-purpose\":\"library-tab\",id:\"supplementary-asset-creator-pane-2\",\"aria-labelledby\":\"supplementary-asset-creator-tab-2\",role:\"tabpanel\",\"aria-hidden\":\"true\",className:cx(\"tab-pane fade\",{'active in':active=='library'}),children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"form\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"asset-library--search-box--2e_tN form-group form-group-sm\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Search files by name\",\"data-purpose\":\"search-box\",type:\"text\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-btn\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-sm btn-secondary\",children:/*#__PURE__*/_jsx(\"span\",{className:\"cfi cfi-search\"})})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"fx\",\"data-purpose\":\"asset-table\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"v5-table-flat v5-table-flat--compress asset-table--asset-table--1FB3C data-table--sorting-table--Fr9kd\",children:[/*#__PURE__*/_jsxs(\"caption\",{className:\"sr-only\",children:[\"Library \",/*#__PURE__*/_jsx(\"br\",{}),\" Sort descending by Date\"]}),/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{role:\"columnheader\",\"aria-sort\":\"none\",scope:\"col\",className:\"header\",children:[/*#__PURE__*/_jsx(\"span\",{\"data-purpose\":\"header-title\",className:\"sortable-header--header--2afzt\",children:\"Filename\"}),/*#__PURE__*/_jsxs(\"button\",{\"data-purpose\":\"sortable-header-button\",type:\"button\",className:\"btn btn-xs btn-tertiary\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"cfi-small cfi cfi-sort\"}),/*#__PURE__*/_jsx(\"span\",{className:\"sr-only\",children:\"Sort ascending by Filename\"})]})]}),/*#__PURE__*/_jsx(\"th\",{role:\"columnheader\",\"aria-sort\":\"none\",scope:\"col\",className:\"header\",children:/*#__PURE__*/_jsx(\"span\",{\"data-purpose\":\"header-title\",className:\"sortable-header--header--2afzt\",children:\"Type\"})}),/*#__PURE__*/_jsx(\"th\",{role:\"columnheader\",\"aria-sort\":\"none\",scope:\"col\",className:\"header\",children:/*#__PURE__*/_jsx(\"span\",{\"data-purpose\":\"header-title\",className:\"sortable-header--header--2afzt\",children:\"Status\"})}),/*#__PURE__*/_jsxs(\"th\",{role:\"columnheader\",\"aria-sort\":\"descending\",scope:\"col\",className:\"header active\",children:[/*#__PURE__*/_jsx(\"span\",{\"data-purpose\":\"header-title\",className:\"sortable-header--header--2afzt\",children:\"Date\"}),/*#__PURE__*/_jsxs(\"button\",{\"data-purpose\":\"sortable-header-button\",type:\"button\",className:\"btn btn-xs btn-tertiary\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"cfi-small cfi cfi-sort-desc\"}),/*#__PURE__*/_jsx(\"span\",{className:\"sr-only\",children:\"Sort ascending by Date\"})]})]}),/*#__PURE__*/_jsx(\"th\",{role:\"columnheader\",\"aria-sort\":\"none\",scope:\"col\",className:\"header\",children:/*#__PURE__*/_jsx(\"span\",{\"data-purpose\":\"header-title\",className:\"sortable-header--header--2afzt\"})})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:resources&&resources.map(function(resource,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"asset-table--asset-row--36BEz\",children:[/*#__PURE__*/_jsx(\"td\",{\"data-valign\":\"center\",children:/*#__PURE__*/_jsx(\"div\",{children:resource.name})}),/*#__PURE__*/_jsx(\"td\",{\"data-responsive-text\":\"Type\",\"data-valign\":\"center\",children:/*#__PURE__*/_jsx(\"div\",{children:validateFileType(resource)})}),/*#__PURE__*/_jsx(\"td\",{\"data-responsive-text\":\"Status\",\"data-valign\":\"center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-success asset-table--asset-status--11R9h\",children:\"Success\"})}),/*#__PURE__*/_jsx(\"td\",{\"data-responsive-text\":\"Date\",\"data-valign\":\"center\",children:/*#__PURE__*/_jsx(\"div\",{children:moment(resource.timestamp).format(\"MM/DD/YYYY\")})}),/*#__PURE__*/_jsx(\"td\",{\"data-valign\":\"center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"asset-table--action-buttons--3agUO\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){selectResource(resource);toggle();},type:\"button\",className:\"btn btn-xs btn-tertiary\",children:\"Select\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-xs btn-tertiary\",children:/*#__PURE__*/_jsx(\"span\",{className:\"cfi cfi-trash\"})})]})})]},index);})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"pagination-container hidden\",\"data-purpose\":\"pagination-container\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"pager\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"disabled previous\",children:/*#__PURE__*/_jsx(\"a\",{href:\"/instructor/course/4199184/manage/curriculum\",tabIndex:-1,style:{pointerEvents:\"none\"},children:/*#__PURE__*/_jsx(\"span\",{className:\"cfi cfi-previous\"})})}),/*#__PURE__*/_jsx(\"li\",{className:\"disabled next\",children:/*#__PURE__*/_jsx(\"a\",{href:\"/instructor/course/4199184/manage/curriculum?p=2\",tabIndex:-1,style:{pointerEvents:\"none\"},children:/*#__PURE__*/_jsx(\"span\",{className:\"cfi cfi-next\"})})})]})})]})})]})]})});};","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/Instructor/Courses/Curriculum/Section/Lecture/Resources.tsx"],"names":["useState","cx","moment","client","selectResources","useCreateResourceMutation","useAppSelector","selectLocationPayload","UploadProgress","filestack","Filestack","process","env","REACT_APP_FILESTACK_APP_KEY","Resources","selectResource","toggle","onSuccess","active","setActive","createResource","uploading","setUploading","progress","setProgress","mediaResources","setMediaResources","error","setError","status","setStatus","resources","locationPayload","onProgress","eve","console","log","totalPercent","onUpload","files","mediaResponse","Array","from","map","item","multiupload","then","results","forEach","res","index","media","name","filetype","type","key","handle","size","course","id","unwrap","returnedResources","length","successes","value","resource","find","catch","err","validateFileType","fileItem","fileType","rootType","split","event","target","timestamp","format","pointerEvents"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport cx from 'classnames';\nimport moment from 'moment'\nimport * as client from 'filestack-js';\nimport { selectResources } from \"state/course/courseSplice\";\nimport { useCreateResourceMutation, useCreateSectionMutation } from \"services/courses\";\nimport { useAppSelector } from \"store/hooks\";\nimport { InputFile } from \"filestack-js\";\nimport { MediaResponse } from \"services/courses\";\nimport { selectLocationPayload } from \"state/location/selectors\";\nimport { UploadProgress } from \"./UploadProgress\";\n\ninterface MediaResource {\n  type: string\n  name: string;\n  size: number;\n  handle: string;\n  url: string;\n}\nconst filestack = client.Filestack(process.env.REACT_APP_FILESTACK_APP_KEY, {})\nexport const Resources = ({ selectResource, toggle, onSuccess }) => {\n  const [active, setActive] = useState('downloadable')\n  const [createResource] = useCreateResourceMutation()\n  const [uploading, setUploading] = useState(false)\n  const [progress, setProgress] = useState(0)\n  const [mediaResources, setMediaResources] = useState([])\n  const [error, setError] = useState(null)\n  const [status, setStatus] = useState('Progress')\n  const resources = useAppSelector(selectResources)\n  const locationPayload = useAppSelector(selectLocationPayload);\n  const onProgress = eve => {\n    console.log(eve.totalPercent)\n    setProgress(eve.totalPercent)\n\n  }\n\n  const onUpload = async (files, onProgress) => {\n\n    const mediaResponse = Array.from(files).map(item => {\n      return item;\n    })\n    setStatus('Progress')\n    setMediaResources(mediaResponse)\n    setUploading(true)\n    let returnedResources: MediaResponse[];\n    filestack.multiupload(files, { onProgress })\n      .then(results => {\n        results.forEach(async (res, index) => {\n          if(res.status == \"Failed\") {\n            console.log(res)\n            setError(\"File failed to upload\")\n            setStatus('Failed')\n            return\n          }\n          \n          const media = {\n            name: res.name,\n            filetype: res.type,\n            key: res.handle,\n            size: res.size,\n            course: locationPayload.id\n          }\n          try {\n            returnedResources = await createResource(media).unwrap()\n            if (index == (results.length - 1)) {\n              let successes = results.map(value => {\n                let resource = returnedResources.find(item => item.key == value.handle)\n                if (resource && resource.id) {\n                  return resource.id;\n                }\n              })\n              console.log(\"onSuccess: \", successes)\n              onSuccess(successes)\n              setStatus('Success')\n              setUploading(false)\n            }\n          } catch (err) {\n            setError(err)\n            setStatus('Failed')\n            console.log(err)\n          }\n        })\n      }).catch(err => {\n        setStatus('Failed')\n        console.log(err)\n        setError(err)\n      })\n\n\n\n  }\n  const validateFileType = (fileItem) => {\n    var fileType = fileItem.filetype; // image/png image/jpeg\n    var rootType = fileType.split(\"/\")[0];\n    switch (rootType) {\n      case \"image\":\n        return 'File';\n      default:\n        return 'Video';\n    }\n  }\n  return (\n    <div className=\"pl10 pr10 pb10\">\n      <div id=\"supplementary-asset-creator\">\n        <div className=\"nav-container\">\n          <ul\n            data-purpose=\"supplementary-asset-creator\"\n            role=\"tablist\"\n            className=\"nav nav-tabs\"\n          >\n            <li role=\"presentation\" className={cx({\n              'active': active == 'downloadable'\n            })}>\n              <a\n                onClick={() => setActive('downloadable')}\n                id=\"supplementary-asset-creator-tab-1\"\n                role=\"tab\"\n                aria-controls=\"supplementary-asset-creator-pane-1\"\n                aria-selected=\"true\"\n\n              >\n                Downloadable File\n              </a>\n            </li>\n            <li role=\"presentation\" className={cx({\n              'active': active == 'library'\n            })}>\n              <a\n                onClick={() => setActive('library')}\n                id=\"supplementary-asset-creator-tab-2\"\n                role=\"tab\"\n                aria-controls=\"supplementary-asset-creator-pane-2\"\n                aria-selected=\"false\"\n\n                tabIndex={-1}\n              >\n                Add from library\n              </a>\n            </li>\n\n          </ul>\n        </div>\n        <div className=\"tab-content\">\n          <div\n            data-purpose=\"file-uploader-tab\"\n            id=\"supplementary-asset-creator-pane-1\"\n            aria-labelledby=\"supplementary-asset-creator-tab-1\"\n            role=\"tabpanel\"\n            aria-hidden=\"false\"\n            className={cx(\"tab-pane fade\", {\n              'active in': active == 'downloadable'\n            })}\n          >\n            <div>\n              {uploading ? <UploadProgress error={error} status={status} progress={progress} mediaResources={mediaResources} toggleUpload={() => setUploading(!uploading)} /> : (<div>\n                <div\n                  className=\"file-uploader--file-selector--SGCns\"\n                  data-purpose=\"asset-uploader-input\"\n                >\n                  <input\n                    name=\"asset\"\n                    type=\"file\"\n                    multiple\n                    onChange={event => onUpload(event.target.files, onProgress)}\n                    id=\"file-upload-10--23\"\n                    className=\"sr-only\"\n                  />\n                  <label htmlFor=\"file-upload-10--23\">\n                    <span className=\"input-group\">\n                      <div className=\"form-control file-uploader--fake-file-input--1_ohV\">\n                        No file selected\n                      </div>\n                      <span className=\"input-group-btn\">\n                        <div data-type=\"button\" className=\"btn btn-default\">\n                          Select File\n                        </div>\n                      </span>\n                    </span>\n                  </label>\n                </div>\n                <div>\n                  <div\n                    className=\"mt10 mb10\"\n                    data-purpose=\"safely-set-inner-html:asset-uploader:note\"\n                  >\n                    <b>Note</b>: A resource is for any type of document that\n                    can be used to help students in the lecture. This file is\n                    going to be seen as a lecture extra. Make sure everything\n                    is legible and the file size is less than 1 GiB.\n                  </div>\n                </div>\n              </div>)}\n            </div>\n          </div>\n          <div\n            data-purpose=\"library-tab\"\n            id=\"supplementary-asset-creator-pane-2\"\n            aria-labelledby=\"supplementary-asset-creator-tab-2\"\n            role=\"tabpanel\"\n            aria-hidden=\"true\"\n            className={cx(\"tab-pane fade\", {\n              'active in': active == 'library'\n            })}\n          >\n            <div>\n              <form >\n                <div className=\"asset-library--search-box--2e_tN form-group form-group-sm\">\n                  <span className=\"input-group\">\n                    <input\n                      placeholder=\"Search files by name\"\n                      data-purpose=\"search-box\"\n                      type=\"text\"\n                      className=\"form-control\"\n                    />\n                    <span className=\"input-group-btn\">\n                      <button\n                        type=\"button\"\n                        className=\"btn btn-sm btn-secondary\"\n                      >\n                        <span className=\"cfi cfi-search\" />\n                      </button>\n                    </span>\n                  </span>\n                </div>\n              </form>\n              <div className=\"fx\" data-purpose=\"asset-table\">\n                <table className=\"v5-table-flat v5-table-flat--compress asset-table--asset-table--1FB3C data-table--sorting-table--Fr9kd\">\n                  <caption className=\"sr-only\">\n                    Library <br /> Sort descending by Date\n                  </caption>\n                  <thead>\n                    <tr>\n                      <th\n                        role=\"columnheader\"\n                        aria-sort=\"none\"\n                        scope=\"col\"\n                        className=\"header\"\n                      >\n                        <span\n                          data-purpose=\"header-title\"\n                          className=\"sortable-header--header--2afzt\"\n                        >\n                          Filename\n                        </span>\n                        <button\n                          data-purpose=\"sortable-header-button\"\n                          type=\"button\"\n                          className=\"btn btn-xs btn-tertiary\"\n                        >\n                          <span className=\"cfi-small cfi cfi-sort\" />\n                          <span className=\"sr-only\">\n                            Sort ascending by Filename\n                          </span>\n                        </button>\n                      </th>\n                      <th\n                        role=\"columnheader\"\n                        aria-sort=\"none\"\n                        scope=\"col\"\n                        className=\"header\"\n                      >\n                        <span\n                          data-purpose=\"header-title\"\n                          className=\"sortable-header--header--2afzt\"\n                        >\n                          Type\n                        </span>\n                      </th>\n                      <th\n                        role=\"columnheader\"\n                        aria-sort=\"none\"\n                        scope=\"col\"\n                        className=\"header\"\n                      >\n                        <span\n                          data-purpose=\"header-title\"\n                          className=\"sortable-header--header--2afzt\"\n                        >\n                          Status\n                        </span>\n                      </th>\n                      <th\n                        role=\"columnheader\"\n                        aria-sort=\"descending\"\n                        scope=\"col\"\n                        className=\"header active\"\n                      >\n                        <span\n                          data-purpose=\"header-title\"\n                          className=\"sortable-header--header--2afzt\"\n                        >\n                          Date\n                        </span>\n                        <button\n                          data-purpose=\"sortable-header-button\"\n                          type=\"button\"\n                          className=\"btn btn-xs btn-tertiary\"\n                        >\n                          <span className=\"cfi-small cfi cfi-sort-desc\" />\n                          <span className=\"sr-only\">\n                            Sort ascending by Date\n                          </span>\n                        </button>\n                      </th>\n                      <th\n                        role=\"columnheader\"\n                        aria-sort=\"none\"\n                        scope=\"col\"\n                        className=\"header\"\n                      >\n                        <span\n                          data-purpose=\"header-title\"\n                          className=\"sortable-header--header--2afzt\"\n                        />\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {resources && resources.map((resource, index) => (\n                      <tr key={index} className=\"asset-table--asset-row--36BEz\">\n                        <td data-valign=\"center\">\n                          <div>{resource.name}</div>\n                        </td>\n                        <td data-responsive-text=\"Type\" data-valign=\"center\">\n                          <div>{validateFileType(resource)}</div>\n                        </td>\n                        <td data-responsive-text=\"Status\" data-valign=\"center\">\n                          <div className=\"text-success asset-table--asset-status--11R9h\">\n                            Success\n                          </div>\n                        </td>\n                        <td data-responsive-text=\"Date\" data-valign=\"center\">\n                          <div>{moment(resource.timestamp).format(\"MM/DD/YYYY\")}</div>\n                        </td>\n                        <td data-valign=\"center\">\n                          <div className=\"asset-table--action-buttons--3agUO\">\n                            <button\n                              onClick={() => {\n                                selectResource(resource)\n                                toggle()\n                              }\n\n                              }\n                              type=\"button\"\n                              className=\"btn btn-xs btn-tertiary\"\n                            >\n                              Select\n                            </button>\n                            <button\n\n                              type=\"button\"\n                              className=\"btn btn-xs btn-tertiary\"\n                            >\n                              <span className=\"cfi cfi-trash\" />\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n\n                  </tbody>\n                </table>\n              </div>\n              <div\n                className=\"pagination-container hidden\"\n                data-purpose=\"pagination-container\"\n              >\n                <ul className=\"pager\">\n                  <li className=\"disabled previous\">\n                    <a\n                      href=\"/instructor/course/4199184/manage/curriculum\"\n                      tabIndex={-1}\n                      style={{ pointerEvents: \"none\" }}\n                    >\n                      <span className=\"cfi cfi-previous\" />\n                    </a>\n                  </li>\n                  <li className=\"disabled next\">\n                    <a\n                      href=\"/instructor/course/4199184/manage/curriculum?p=2\"\n                      tabIndex={-1}\n                      style={{ pointerEvents: \"none\" }}\n                    >\n                      <span className=\"cfi cfi-next\" />\n                    </a>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n\n        </div>\n      </div>\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}