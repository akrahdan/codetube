{"ast":null,"code":"'use strict';\n\nvar she = require('./she');\n\nvar lowercase = require('./lowercase');\n\nvar attributes = require('./attributes');\n\nvar elements = require('./elements');\n\nfunction sanitizer(buffer, options) {\n  var last;\n  var context;\n  var o = options || {};\n  reset();\n  return {\n    start: start,\n    end: end,\n    chars: chars\n  };\n\n  function out(value) {\n    buffer.push(value);\n  }\n\n  function start(tag, attrs, unary) {\n    var low = lowercase(tag);\n\n    if (context.ignoring) {\n      ignore(low);\n      return;\n    }\n\n    if ((o.allowedTags || []).indexOf(low) === -1) {\n      ignore(low);\n      return;\n    }\n\n    if (o.filter && !o.filter({\n      tag: low,\n      attrs: attrs\n    })) {\n      ignore(low);\n      return;\n    }\n\n    out('<');\n    out(low);\n    Object.keys(attrs).forEach(parse);\n    out(unary ? '/>' : '>');\n\n    function parse(key) {\n      var value = attrs[key];\n      var classesOk = (o.allowedClasses || {})[low] || [];\n      var attrsOk = (o.allowedAttributes || {})[low] || [];\n      attrsOk = attrsOk.concat((o.allowedAttributes || {})['*'] || []);\n      var valid;\n      var lkey = lowercase(key);\n\n      if (lkey === 'class' && attrsOk.indexOf(lkey) === -1) {\n        if (value) {\n          value = value.split(' ').filter(isValidClass).join(' ').trim();\n        }\n\n        valid = value && value.length;\n      } else {\n        valid = attrsOk.indexOf(lkey) !== -1 && (attributes.uris[lkey] !== true || testUrl(value));\n      }\n\n      if (valid) {\n        out(' ');\n        out(key);\n\n        if (typeof value === 'string') {\n          out('=\"');\n          out(she.encode(value));\n          out('\"');\n        }\n      }\n\n      function isValidClass(className) {\n        return classesOk && classesOk.indexOf(className) !== -1;\n      }\n    }\n  }\n\n  function end(tag) {\n    var low = lowercase(tag);\n    var allowed = (o.allowedTags || []).indexOf(low) !== -1;\n\n    if (allowed) {\n      if (context.ignoring === false) {\n        out('</');\n        out(low);\n        out('>');\n      } else {\n        unignore(low);\n      }\n    } else {\n      unignore(low);\n    }\n  }\n\n  function testUrl(text) {\n    var start = text[0];\n\n    if (start === '#' || start === '/') {\n      return true;\n    }\n\n    var colon = text.indexOf(':');\n\n    if (colon === -1) {\n      return true;\n    }\n\n    var questionmark = text.indexOf('?');\n\n    if (questionmark !== -1 && colon > questionmark) {\n      return true;\n    }\n\n    var hash = text.indexOf('#');\n\n    if (hash !== -1 && colon > hash) {\n      return true;\n    }\n\n    return o.allowedSchemes.some(matches);\n\n    function matches(scheme) {\n      return text.indexOf(scheme + ':') === 0;\n    }\n  }\n\n  function chars(text) {\n    if (context.ignoring === false) {\n      out(o.transformText ? o.transformText(text) : text);\n    }\n  }\n\n  function ignore(tag) {\n    if (elements.voids[tag]) {\n      return;\n    }\n\n    if (context.ignoring === false) {\n      context = {\n        ignoring: tag,\n        depth: 1\n      };\n    } else if (context.ignoring === tag) {\n      context.depth++;\n    }\n  }\n\n  function unignore(tag) {\n    if (context.ignoring === tag) {\n      if (--context.depth <= 0) {\n        reset();\n      }\n    }\n  }\n\n  function reset() {\n    context = {\n      ignoring: false,\n      depth: 0\n    };\n  }\n}\n\nmodule.exports = sanitizer;","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/sanitize-markdown/sanitizer.js"],"names":["she","require","lowercase","attributes","elements","sanitizer","buffer","options","last","context","o","reset","start","end","chars","out","value","push","tag","attrs","unary","low","ignoring","ignore","allowedTags","indexOf","filter","Object","keys","forEach","parse","key","classesOk","allowedClasses","attrsOk","allowedAttributes","concat","valid","lkey","split","isValidClass","join","trim","length","uris","testUrl","encode","className","allowed","unignore","text","colon","questionmark","hash","allowedSchemes","some","matches","scheme","transformText","voids","depth","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar she = require('./she');\r\nvar lowercase = require('./lowercase');\r\nvar attributes = require('./attributes');\r\nvar elements = require('./elements');\r\n\r\nfunction sanitizer (buffer, options) {\r\n  var last;\r\n  var context;\r\n  var o = options || {};\r\n\r\n  reset();\r\n\r\n  return {\r\n    start: start,\r\n    end: end,\r\n    chars: chars\r\n  };\r\n\r\n  function out (value) {\r\n    buffer.push(value);\r\n  }\r\n\r\n  function start (tag, attrs, unary) {\r\n    var low = lowercase(tag);\r\n\r\n    if (context.ignoring) {\r\n      ignore(low); return;\r\n    }\r\n    if ((o.allowedTags || []).indexOf(low) === -1) {\r\n      ignore(low); return;\r\n    }\r\n    if (o.filter && !o.filter({ tag: low, attrs: attrs })) {\r\n      ignore(low); return;\r\n    }\r\n\r\n    out('<');\r\n    out(low);\r\n    Object.keys(attrs).forEach(parse);\r\n    out(unary ? '/>' : '>');\r\n\r\n    function parse (key) {\r\n      var value = attrs[key];\r\n      var classesOk = (o.allowedClasses || {})[low] || [];\r\n      var attrsOk = (o.allowedAttributes || {})[low] || [];\r\n      attrsOk = attrsOk.concat((o.allowedAttributes || {})['*'] || []);\r\n      var valid;\r\n      var lkey = lowercase(key);\r\n      if (lkey === 'class' && attrsOk.indexOf(lkey) === -1) {\r\n        if (value) {\r\n          value = value.split(' ').filter(isValidClass).join(' ').trim()\r\n        }\r\n        valid = value && value.length;\r\n      } else {\r\n        valid = attrsOk.indexOf(lkey) !== -1 && (attributes.uris[lkey] !== true || testUrl(value));\r\n      }\r\n      if (valid) {\r\n        out(' ');\r\n        out(key);\r\n        if (typeof value === 'string') {\r\n          out('=\"');\r\n          out(she.encode(value));\r\n          out('\"');\r\n        }\r\n      }\r\n      function isValidClass (className) {\r\n        return classesOk && classesOk.indexOf(className) !== -1;\r\n      }\r\n    }\r\n  }\r\n\r\n  function end (tag) {\r\n    var low = lowercase(tag);\r\n    var allowed = (o.allowedTags || []).indexOf(low) !== -1;\r\n    if (allowed) {\r\n      if (context.ignoring === false) {\r\n        out('</');\r\n        out(low);\r\n        out('>');\r\n      } else {\r\n        unignore(low);\r\n      }\r\n    } else {\r\n      unignore(low);\r\n    }\r\n  }\r\n\r\n  function testUrl (text) {\r\n    var start = text[0];\r\n    if (start === '#' || start === '/') {\r\n      return true;\r\n    }\r\n    var colon = text.indexOf(':');\r\n    if (colon === -1) {\r\n      return true;\r\n    }\r\n    var questionmark = text.indexOf('?');\r\n    if (questionmark !== -1 && colon > questionmark) {\r\n      return true;\r\n    }\r\n    var hash = text.indexOf('#');\r\n    if (hash !== -1 && colon > hash) {\r\n      return true;\r\n    }\r\n    return o.allowedSchemes.some(matches);\r\n\r\n    function matches (scheme) {\r\n      return text.indexOf(scheme + ':') === 0;\r\n    }\r\n  }\r\n\r\n  function chars (text) {\r\n    if (context.ignoring === false) {\r\n      out(o.transformText ? o.transformText(text) : text);\r\n    }\r\n  }\r\n\r\n  function ignore (tag) {\r\n    if (elements.voids[tag]) {\r\n      return;\r\n    }\r\n    if (context.ignoring === false) {\r\n      context = { ignoring: tag, depth: 1 };\r\n    } else if (context.ignoring === tag) {\r\n      context.depth++;\r\n    }\r\n  }\r\n\r\n  function unignore (tag) {\r\n    if (context.ignoring === tag) {\r\n      if (--context.depth <= 0) {\r\n        reset();\r\n      }\r\n    }\r\n  }\r\n\r\n  function reset () {\r\n    context = { ignoring: false, depth: 0 };\r\n  }\r\n}\r\n\r\nmodule.exports = sanitizer;\r\n"]},"metadata":{},"sourceType":"script"}