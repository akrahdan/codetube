{"ast":null,"code":"import _slicedToArray from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{Box,GridForm,Markdown,Text}from'@codecademy/gamut';import{delay}from'lodash';import React,{useMemo,useRef,useState}from'react';import{useMountedState}from'react-use';import{v4 as uuid}from'uuid';import cookie from'react-cookies';import{passwordTips}from'libs/passwordTips';import{showModal}from'state/modals/modalSlice';import{useAppDispatch}from'store/hooks';import{useLoginMutation,useGetCurrentUserQuery}from'services/auth';import{redirectAfterLogin,serializeRegistrationValues}from'./helpers';import styles from'./styles/index.module.scss';import{UserSubmitKey}from'./types';import{VALIDATORS}from'./validators';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var SigninForm=function SigninForm(_ref){var _ref$onSuccess=_ref.onSuccess,onSuccess=_ref$onSuccess===void 0?redirectAfterLogin:_ref$onSuccess,props=_objectWithoutProperties(_ref,[\"onSuccess\"]);var dispatch=useAppDispatch();// const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\nvar isMounted=useMountedState();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setDisabled=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),submitLocked=_useState4[0],setSubmitLocked=_useState4[1];var _useState5=useState(uuid()),_useState6=_slicedToArray(_useState5,2),recaptchaInstanceId=_useState6[0],setRecaptchaInstanceId=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),serializedForm=_useState8[0],setSerializedForm=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),recaptchaError=_useState10[0],setRecaptchaError=_useState10[1];var captcha=useRef(null);var _useMemo=useMemo(function(){return{emailValidation:VALIDATORS.email(),passwordValidation:VALIDATORS.password()};},[]),emailValidation=_useMemo.emailValidation,passwordValidation=_useMemo.passwordValidation;var _useLoginMutation=useLoginMutation(),_useLoginMutation2=_slicedToArray(_useLoginMutation,2),login=_useLoginMutation2[0],_useLoginMutation2$=_useLoginMutation2[1],data=_useLoginMutation2$.data,error=_useLoginMutation2$.error;if(data){console.log(data);localStorage.setItem('token',data.key);var _useGetCurrentUserQue=useGetCurrentUserQuery({}),user=_useGetCurrentUserQue.data;console.log(\"User:\",user);}var onSubmitInitialize=function onSubmitInitialize(values){// trackUserClick({ target: 'create_account' });\nsetDisabled(true);var serializedValues=serializeRegistrationValues(values);setSerializedForm(serializedValues);if(captcha.current===null){// logger.error({ message: 'captcha on checkoutpage has a null ref' });\nreturn;}captcha.current.execute();// validate the full form to see if we can submit\nsetDisabled(false);};/**\n   * @description\n   * This unlocks submit a half second after the first input to prevent against bots - subsequent calls have no effect\n   * */var onUpdate=function onUpdate(){delay(function(){return isMounted()&&submitLocked&&setSubmitLocked(false);},500);};var submitForm=function submitForm(values){console.log(values);values.csrfmiddlewaretoken=cookie.load('csrftoken');login(values);};return/*#__PURE__*/_jsxs(\"div\",{className:styles.registrationContainer,children:[/*#__PURE__*/_jsx(GridForm,{className:styles.loginForm,fields:[{name:UserSubmitKey.EMAIL,label:'Email',type:'email',defaultValue:'',size:12,onUpdate:onUpdate},{name:UserSubmitKey.PASSWORD,label:'Password',type:'password',tooltip:{children:/*#__PURE__*/_jsx(Markdown,{text:passwordTips}),id:'password-tooltip',alignment:'bottom-left',className:styles.tooltipContainer},size:12,onUpdate:onUpdate,defaultValue:''}],submit:{contents:'Log In',position:'stretch',theme:'brand-red',size:12,disabled:isDisabled||submitLocked},validation:\"all\",onSubmit:submitForm}),/*#__PURE__*/_jsx(Box,{pt:16,children:recaptchaError&&/*#__PURE__*/_jsx(\"div\",{className:styles.recaptchaError,children:recaptchaError})}),/*#__PURE__*/_jsx(Text,{className:styles.textDisplay,children:/*#__PURE__*/_jsxs(\"p\",{className:styles.textCenter,children:[\"Need an account?\",\" \",/*#__PURE__*/_jsx(\"a\",{className:styles.textLink,onClick:function onClick(){return dispatch(showModal('signup'));},children:\"Sign up\"}),\".\"]})})]});};","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/components/Forms/RegistrationForm/SigninForm.tsx"],"names":["Box","GridForm","Markdown","Text","delay","React","useMemo","useRef","useState","useMountedState","v4","uuid","cookie","passwordTips","showModal","useAppDispatch","useLoginMutation","useGetCurrentUserQuery","redirectAfterLogin","serializeRegistrationValues","styles","UserSubmitKey","VALIDATORS","SigninForm","onSuccess","props","dispatch","isMounted","isDisabled","setDisabled","submitLocked","setSubmitLocked","recaptchaInstanceId","setRecaptchaInstanceId","serializedForm","setSerializedForm","recaptchaError","setRecaptchaError","captcha","emailValidation","email","passwordValidation","password","login","data","error","console","log","localStorage","setItem","key","user","onSubmitInitialize","values","serializedValues","current","execute","onUpdate","submitForm","csrfmiddlewaretoken","load","registrationContainer","loginForm","name","EMAIL","label","type","defaultValue","size","PASSWORD","tooltip","children","id","alignment","className","tooltipContainer","contents","position","theme","disabled","textDisplay","textCenter","textLink"],"mappings":"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","sourcesContent":["import { Box, GridForm, Markdown, Text } from '@codecademy/gamut';\nimport { delay } from 'lodash';\nimport React, { useMemo, useRef, useState } from 'react';\nimport { useMountedState } from 'react-use';\n\nimport { v4 as uuid } from 'uuid';\n\nimport cookie from 'react-cookies';\n\nimport { RecaptchaWrapper } from 'components/Forms/RecaptchaWrapper';\n\n\nimport { passwordTips } from 'libs/passwordTips';\n\n\nimport { showModal } from 'state/modals/modalSlice';\nimport { useAppDispatch, useAppSelector } from 'store/hooks';\nimport { useLoginMutation, useGetCurrentUserQuery } from 'services/auth';\nimport { redirectAfterLogin, serializeRegistrationValues } from './helpers';\n\nimport styles from './styles/index.module.scss';\nimport {\n  RegistrationFormProps,\n  SerializedValues,\n  SubmitValues,\n  UserSubmitKey,\n} from './types';\nimport { extractValidationErrors, VALIDATORS } from './validators';\n\nexport const SigninForm: React.FC<RegistrationFormProps> = ({\n  onSuccess = redirectAfterLogin,\n  ...props\n}) => {\n  const dispatch = useAppDispatch()\n  // const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\n  const isMounted = useMountedState();\n  const [isDisabled, setDisabled] = useState(false);\n  const [submitLocked, setSubmitLocked] = useState(true);\n  const [recaptchaInstanceId, setRecaptchaInstanceId] = useState(uuid());\n  const [\n    serializedForm,\n    setSerializedForm,\n  ] = useState<SerializedValues | null>();\n  const [recaptchaError, setRecaptchaError] = useState<string | undefined>();\n\n  const captcha = useRef<RecaptchaWrapper | null>(null);\n\n  const { emailValidation, passwordValidation } = useMemo(\n    () => ({\n      emailValidation: VALIDATORS.email(),\n      passwordValidation: VALIDATORS.password(),\n    }),\n    []\n  );\n\n \n  \n  const [login, { data, error}] = useLoginMutation()\n  \n  if (data) {\n    console.log(data)\n    localStorage.setItem('token', data.key)\n\n    const { data: user } = useGetCurrentUserQuery({})\n    console.log(\"User:\", user)\n  }\n\n\n  const onSubmitInitialize = (values: SubmitValues) => {\n    // trackUserClick({ target: 'create_account' });\n\n    setDisabled(true);\n    const serializedValues = serializeRegistrationValues(values);\n    setSerializedForm(serializedValues);\n\n    if (captcha.current === null) {\n      // logger.error({ message: 'captcha on checkoutpage has a null ref' });\n      return;\n    }\n    captcha.current.execute();\n    // validate the full form to see if we can submit\n    setDisabled(false);\n  };\n\n  /**\n   * @description\n   * This unlocks submit a half second after the first input to prevent against bots - subsequent calls have no effect\n   * */\n  const onUpdate = () => {\n    delay(() => isMounted() && submitLocked && setSubmitLocked(false), 500);\n  };\n\n  const submitForm = (values) => {\n    console.log(values)\n    values.csrfmiddlewaretoken = cookie.load('csrftoken');\n    login(values)\n  }\n\n  \n\n  return (\n    <div className={styles.registrationContainer}>\n      <GridForm\n        className={styles.loginForm}\n        fields={[\n          {\n            name: UserSubmitKey.EMAIL,\n            label: 'Email',\n            type: 'email',\n            defaultValue: '',\n            size: 12,\n            onUpdate,\n          \n          },\n          {\n            name: UserSubmitKey.PASSWORD,\n            label: 'Password',\n            type: 'password',\n            tooltip: {\n              children: <Markdown text={passwordTips} />,\n              id: 'password-tooltip',\n              alignment: 'bottom-left',\n              className: styles.tooltipContainer,\n            },\n            size: 12,\n            onUpdate,\n            defaultValue: '',\n            \n          },\n          \n         \n        ]}\n        submit={{\n          contents: 'Log In',\n          position: 'stretch',\n          theme: 'brand-red',\n          size: 12,\n          disabled: isDisabled || submitLocked,\n        }}\n        validation=\"all\"\n        onSubmit={submitForm}\n      />\n      <Box pt={16}>\n        {recaptchaError && (\n          <div className={styles.recaptchaError} >\n            {recaptchaError}\n          </div>\n        )}\n        {/* <RecaptchaWrapper\n          key={recaptchaInstanceId}\n          publicKey={''}\n          size=\"invisible\"\n          ref={captcha}\n          onChange={submitForm}\n          onExpired={resetRecaptcha}\n        /> */}\n      </Box>\n      <Text className={styles.textDisplay} >\n        <p className={styles.textCenter}>\n          Need an account?{\" \"}\n          <a className={styles.textLink} onClick={() => dispatch(showModal('signup'))}>\n            Sign up\n          </a>\n          .\n        </p>\n      </Text>\n\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}