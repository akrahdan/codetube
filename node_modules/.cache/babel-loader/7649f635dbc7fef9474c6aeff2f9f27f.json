{"ast":null,"code":"var _jsxFileName = \"/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/playback-speed-selector/playback-speed-selector.js\";\nimport classNames from 'classnames';\nimport React, { Component, createRef } from 'react'; // import { connect } from 'unistore/react';\n\nimport { connect } from 'react-redux';\nimport { setPlaybackSpeed, setActiveMenu } from 'state/player/playerSlice'; // import * as actions from '../../actions'\n\nimport css from './playback-speed-selector.module.scss';\nimport { InteractionModes, Menus, PlaybackSpeedStops as stops } from '../constants';\nimport { valuesIn } from 'lodash';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class PlaybackSpeedSelector extends Component {\n  constructor(props) {\n    super(props);\n\n    this.setLocalPlaybackSpeed = i => {\n      return () => this.setState({\n        localPlaybackSpeed: i\n      });\n    };\n\n    this.handleKeyDown = e => {\n      const {\n        keyCode\n      } = e;\n      const currentSpeed = this.state.localPlaybackSpeed; // Right\n\n      if (keyCode === 39) {\n        e.preventDefault && e.preventDefault();\n        const currentIndex = this.stopRefs[currentSpeed].index;\n        const nextStopIndex = currentIndex < stops.length - 1 ? currentIndex + 1 : 0;\n        const nextStop = stops[nextStopIndex];\n        const nextStopRef = this.stopRefs[nextStop];\n        nextStopRef.ref.current.focus();\n        this.setPlaybackSpeed(nextStopRef.speed);\n      } // Left\n\n\n      if (keyCode === 37) {\n        e.preventDefault && e.preventDefault();\n        const currentIndex = this.stopRefs[currentSpeed].index;\n        const prevStopIndex = currentIndex > 0 ? currentIndex - 1 : stops.length - 1;\n        const prevStop = stops[prevStopIndex];\n        const prevStopRef = this.stopRefs[prevStop];\n        prevStopRef.ref.current.focus();\n        this.setPlaybackSpeed(prevStopRef.speed);\n      }\n    };\n\n    this.setPlaybackSpeed = (i, onSpeedChanged) => {\n      return () => {\n        this.setState({\n          localPlaybackSpeed: i\n        });\n        this.props.setPlaybackSpeed(i);\n        onSpeedChanged && onSpeedChanged();\n      };\n    };\n\n    this.closeMenu = () => {\n      if (this.isKeyboardMode) {\n        this.props.setActiveMenu(Menus.NONE);\n        this.focusPreviousButton();\n      }\n    };\n\n    this.getSliderItems = playbackSpeed => {\n      return stops.reduce((items, i) => {\n        let className = css.equalTo;\n\n        if (i < playbackSpeed) {\n          className = css.lessThan;\n        } else if (i > playbackSpeed) {\n          className = css.greaterThan;\n        }\n\n        return items.concat( /*#__PURE__*/_jsxDEV(\"li\", {\n          className: className,\n          speed: i,\n          onMouseOver: this.setLocalPlaybackSpeed(i),\n          onFocus: this.setLocalPlaybackSpeed(i),\n          onClick: this.setPlaybackSpeed(i, this.closeMenu),\n          onTouchStart: this.setPlaybackSpeed(i, this.closeMenu),\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: css.button,\n            \"aria-label\": `${i}`,\n            tabIndex: \"0\",\n            id: `playback-speed-option-${i}`,\n            ref: this.stopRefs[i].ref,\n            children: [\"speed \", i, \"x\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 11\n          }, this)\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 9\n        }, this));\n      }, []);\n    };\n\n    this.state = {\n      localPlaybackSpeed: props.playbackSpeed || 1\n    };\n    this.menuRef = /*#__PURE__*/createRef();\n    this.trapTabs = this.trapTabs.bind(this);\n    this.stopRefs = {};\n    stops.forEach((stop, i) => {\n      this.stopRefs[stop] = {\n        ref: /*#__PURE__*/createRef(),\n        index: i,\n        speed: stop\n      };\n    });\n  }\n\n  get isKeyboardMode() {\n    return this.props.interactionMode === InteractionModes.KEYBOARD;\n  }\n\n  trapTabs(e) {\n    if (e.which === 27) this.closeMenu();\n\n    if (e.which === 9) {\n      const currentFocus = document.activeElement;\n      const focusableChildren = Array.from(this.menuRef.current.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), object, embed, *[tabindex], *[contenteditable]'));\n      const focusableCount = focusableChildren.length;\n      const focusedIndex = focusableChildren.indexOf(currentFocus);\n\n      if (e.shiftKey) {\n        if (focusedIndex === 0) {\n          e.preventDefault();\n          focusableChildren[focusableCount - 1].focus();\n        }\n      } else {\n        if (focusedIndex === focusableCount - 1) {\n          e.preventDefault();\n          focusableChildren[0].focus();\n        }\n      }\n    }\n  }\n\n  componentDidUpdate({\n    activeMenu: prevActiveMenu\n  }) {\n    const {\n      playbackSpeed,\n      activeMenu\n    } = this.props;\n    const menuChanged = activeMenu !== prevActiveMenu;\n    const playbackSpeedMenuOpened = menuChanged && activeMenu === Menus.PLAYBACK_SPEED;\n\n    if (playbackSpeedMenuOpened) {\n      this.focusOnButtonByPlaybackSpeed(playbackSpeed);\n    }\n  }\n\n  focusOnButtonByPlaybackSpeed(playbackSpeed) {\n    const button = this.container.querySelector(`[speed=\"${playbackSpeed}\"] button`);\n    button && button.focus();\n  }\n\n  focusPreviousButton() {\n    const prevSibling = this.container.previousElementSibling;\n    const button = prevSibling && prevSibling.querySelector('button');\n    button && button.focus();\n  }\n\n  render() {\n    const {\n      activeMenu,\n      className,\n      setActiveMenu\n    } = this.props;\n    const {\n      localPlaybackSpeed\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"eplayer-speed-selector\",\n      className: classNames(css.container, className, {\n        [css.hidden]: activeMenu !== Menus.PLAYBACK_SPEED\n      }),\n      \"aria-hidden\": activeMenu !== Menus.PLAYBACK_SPEED,\n      ref: ref => this.container = ref,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: css.title,\n        \"aria-label\": `current speed: ${localPlaybackSpeed}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: css['title__content'],\n          \"data-widest\": \"Speed: 2.0x\",\n          children: [\"Speed: \", localPlaybackSpeed.toFixed(1), \"x\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: this.menuRef,\n        tabIndex: \"-1\",\n        onKeyDown: e => {\n          this.trapTabs(e);\n          this.handleKeyDown(e);\n        },\n        children: /*#__PURE__*/_jsxDEV(\"ol\", {\n          className: css.slider,\n          onClick: this.handleChange,\n          \"aria-label\": \"set playback speed\",\n          children: this.getSliderItems(localPlaybackSpeed)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nexport default connect(state => ({\n  playbackSpeed: state.player.playbackSpeed,\n  activeMenu: state.player.activeMenu\n}), dispatch => ({\n  setPlaybackSpeed: payload => dispatch(setPlaybackSpeed(payload)),\n  setActiveMenu: payload => dispatch(setActiveMenu(payload))\n}))(PlaybackSpeedSelector); // export default connect(\n//   (state) => ({\n//     interactionMode: state.interactionMode,\n//     activeMenu: state.activeMenu,\n//     playbackSpeed: state.playbackSpeed,\n//   }),\n//   (store) => ({\n//     setActiveMenu: actions.setActiveMenu,\n//     setPlaybackSpeed: actions.setPlaybackSpeed,\n//   })\n// )(PlaybackSpeedSelector)","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/playback-speed-selector/playback-speed-selector.js"],"names":["classNames","React","Component","createRef","connect","setPlaybackSpeed","setActiveMenu","css","InteractionModes","Menus","PlaybackSpeedStops","stops","valuesIn","PlaybackSpeedSelector","constructor","props","setLocalPlaybackSpeed","i","setState","localPlaybackSpeed","handleKeyDown","e","keyCode","currentSpeed","state","preventDefault","currentIndex","stopRefs","index","nextStopIndex","length","nextStop","nextStopRef","ref","current","focus","speed","prevStopIndex","prevStop","prevStopRef","onSpeedChanged","closeMenu","isKeyboardMode","NONE","focusPreviousButton","getSliderItems","playbackSpeed","reduce","items","className","equalTo","lessThan","greaterThan","concat","button","menuRef","trapTabs","bind","forEach","stop","interactionMode","KEYBOARD","which","currentFocus","document","activeElement","focusableChildren","Array","from","querySelectorAll","focusableCount","focusedIndex","indexOf","shiftKey","componentDidUpdate","activeMenu","prevActiveMenu","menuChanged","playbackSpeedMenuOpened","PLAYBACK_SPEED","focusOnButtonByPlaybackSpeed","container","querySelector","prevSibling","previousElementSibling","render","hidden","title","toFixed","slider","handleChange","player","dispatch","payload"],"mappings":"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","sourcesContent":["import classNames from 'classnames'\r\nimport React, { Component, createRef } from 'react'\r\n// import { connect } from 'unistore/react';\r\nimport { connect} from 'react-redux';\r\nimport { setPlaybackSpeed, setActiveMenu } from 'state/player/playerSlice';\r\n\r\n// import * as actions from '../../actions'\r\nimport css from './playback-speed-selector.module.scss'\r\n\r\nimport { InteractionModes, Menus, PlaybackSpeedStops as stops } from '../constants'\r\nimport { valuesIn } from 'lodash';\r\n\r\nexport class PlaybackSpeedSelector extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = { localPlaybackSpeed: props.playbackSpeed || 1 }\r\n    this.menuRef = createRef()\r\n    this.trapTabs = this.trapTabs.bind(this)\r\n    this.stopRefs = {}\r\n    stops.forEach((stop, i) => {\r\n      this.stopRefs[stop] = {\r\n        ref: createRef(),\r\n        index: i,\r\n        speed: stop,\r\n      }\r\n    })\r\n  }\r\n\r\n  get isKeyboardMode() {\r\n    return this.props.interactionMode === InteractionModes.KEYBOARD\r\n  }\r\n\r\n  trapTabs(e) {\r\n    if (e.which === 27) this.closeMenu()\r\n    if (e.which === 9) {\r\n      const currentFocus = document.activeElement\r\n      const focusableChildren = Array.from(\r\n        this.menuRef.current.querySelectorAll(\r\n          'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), object, embed, *[tabindex], *[contenteditable]'\r\n        )\r\n      )\r\n      const focusableCount = focusableChildren.length\r\n\r\n      const focusedIndex = focusableChildren.indexOf(currentFocus)\r\n      if (e.shiftKey) {\r\n        if (focusedIndex === 0) {\r\n          e.preventDefault()\r\n          focusableChildren[focusableCount - 1].focus()\r\n        }\r\n      } else {\r\n        if (focusedIndex === focusableCount - 1) {\r\n          e.preventDefault()\r\n          focusableChildren[0].focus()\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate({ activeMenu: prevActiveMenu }) {\r\n    const { playbackSpeed, activeMenu } = this.props\r\n\r\n    const menuChanged = activeMenu !== prevActiveMenu\r\n    const playbackSpeedMenuOpened = menuChanged && activeMenu === Menus.PLAYBACK_SPEED\r\n\r\n    if (playbackSpeedMenuOpened) {\r\n      this.focusOnButtonByPlaybackSpeed(playbackSpeed)\r\n    }\r\n  }\r\n\r\n  focusOnButtonByPlaybackSpeed(playbackSpeed) {\r\n    const button = this.container.querySelector(`[speed=\"${playbackSpeed}\"] button`)\r\n    button && button.focus()\r\n  }\r\n\r\n  setLocalPlaybackSpeed = (i) => {\r\n    return () => this.setState({ localPlaybackSpeed: i })\r\n  }\r\n\r\n  handleKeyDown = (e) => {\r\n    const { keyCode } = e\r\n    const currentSpeed = this.state.localPlaybackSpeed\r\n\r\n    // Right\r\n    if (keyCode === 39) {\r\n      e.preventDefault && e.preventDefault()\r\n      const currentIndex = this.stopRefs[currentSpeed].index\r\n      const nextStopIndex = currentIndex < stops.length - 1 ? currentIndex + 1 : 0\r\n      const nextStop = stops[nextStopIndex]\r\n      const nextStopRef = this.stopRefs[nextStop]\r\n      nextStopRef.ref.current.focus()\r\n      this.setPlaybackSpeed(nextStopRef.speed)\r\n    }\r\n\r\n    // Left\r\n    if (keyCode === 37) {\r\n      e.preventDefault && e.preventDefault()\r\n      const currentIndex = this.stopRefs[currentSpeed].index\r\n      const prevStopIndex = currentIndex > 0 ? currentIndex - 1 : stops.length - 1\r\n      const prevStop = stops[prevStopIndex]\r\n      const prevStopRef = this.stopRefs[prevStop]\r\n      prevStopRef.ref.current.focus()\r\n      this.setPlaybackSpeed(prevStopRef.speed)\r\n    }\r\n  }\r\n\r\n  setPlaybackSpeed = (i, onSpeedChanged) => {\r\n    return () => {\r\n      this.setState({ localPlaybackSpeed: i })\r\n      this.props.setPlaybackSpeed(i)\r\n      onSpeedChanged && onSpeedChanged()\r\n    }\r\n  }\r\n\r\n  closeMenu = () => {\r\n    if (this.isKeyboardMode) {\r\n      this.props.setActiveMenu(Menus.NONE)\r\n      this.focusPreviousButton()\r\n    }\r\n  }\r\n\r\n  focusPreviousButton() {\r\n    const prevSibling = this.container.previousElementSibling\r\n    const button = prevSibling && prevSibling.querySelector('button')\r\n\r\n    button && button.focus()\r\n  }\r\n\r\n  render() {\r\n    const { activeMenu, className, setActiveMenu } = this.props\r\n    const { localPlaybackSpeed } = this.state\r\n\r\n    return (\r\n      <div\r\n        id=\"eplayer-speed-selector\"\r\n        className={classNames(css.container, className, {\r\n          [css.hidden]: activeMenu !== Menus.PLAYBACK_SPEED,\r\n        })}\r\n        aria-hidden={activeMenu !== Menus.PLAYBACK_SPEED}\r\n        ref={(ref) => (this.container = ref)}\r\n      >\r\n        <div className={css.title} aria-label={`current speed: ${localPlaybackSpeed}`}>\r\n          <div className={css['title__content']} data-widest=\"Speed: 2.0x\">\r\n            Speed: {localPlaybackSpeed.toFixed(1)}x\r\n          </div>\r\n        </div>\r\n        <div\r\n          ref={this.menuRef}\r\n          tabIndex=\"-1\"\r\n          onKeyDown={(e) => {\r\n            this.trapTabs(e)\r\n            this.handleKeyDown(e)\r\n          }}\r\n        >\r\n          <ol className={css.slider} onClick={this.handleChange} aria-label=\"set playback speed\">\r\n            {this.getSliderItems(localPlaybackSpeed)}\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  getSliderItems = (playbackSpeed) => {\r\n    return stops.reduce((items, i) => {\r\n      let className = css.equalTo\r\n      if (i < playbackSpeed) {\r\n        className = css.lessThan\r\n      } else if (i > playbackSpeed) {\r\n        className = css.greaterThan\r\n      }\r\n\r\n      return items.concat(\r\n        <li\r\n          className={className}\r\n          key={i}\r\n          speed={i}\r\n          onMouseOver={this.setLocalPlaybackSpeed(i)}\r\n          onFocus={this.setLocalPlaybackSpeed(i)}\r\n          onClick={this.setPlaybackSpeed(i, this.closeMenu)}\r\n          onTouchStart={this.setPlaybackSpeed(i, this.closeMenu)}\r\n        >\r\n          <button\r\n            type=\"button\"\r\n            className={css.button}\r\n            aria-label={`${i}`}\r\n            tabIndex=\"0\"\r\n            id={`playback-speed-option-${i}`}\r\n            ref={this.stopRefs[i].ref}\r\n          >\r\n            speed {i}x\r\n          </button>\r\n        </li>\r\n      )\r\n    }, [])\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  (state) => ({\r\n    playbackSpeed: state.player.playbackSpeed,\r\n    activeMenu: state.player.activeMenu,\r\n  }),\r\n  (dispatch) => ({\r\n    setPlaybackSpeed: payload => dispatch(setPlaybackSpeed(payload)),\r\n    setActiveMenu: payload => dispatch(setActiveMenu(payload)),\r\n  })\r\n)(PlaybackSpeedSelector);\r\n// export default connect(\r\n//   (state) => ({\r\n//     interactionMode: state.interactionMode,\r\n//     activeMenu: state.activeMenu,\r\n//     playbackSpeed: state.playbackSpeed,\r\n//   }),\r\n//   (store) => ({\r\n//     setActiveMenu: actions.setActiveMenu,\r\n//     setPlaybackSpeed: actions.setPlaybackSpeed,\r\n//   })\r\n// )(PlaybackSpeedSelector)\r\n"]},"metadata":{},"sourceType":"module"}