{"ast":null,"code":"import React from 'react';\nimport { connect } from 'react-redux'; // import * as actions from '../../actions'\n\nimport { syncSettings } from 'state/player/playerSlice';\nexport class SyncSettings extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    this.handleStorage = e => {\n      if (e.key == SyncSettings.storageKey) {\n        this.syncStorageToLocal();\n      }\n    };\n  }\n\n  static get storageKey() {\n    return 'ps-embeddable-player-settings';\n  }\n\n  static get version() {//return versions\n  }\n\n  static get settingsKeys() {\n    return ['userAutoplaySetting', 'closedCaptioningEnabled', 'closedCaptioningLanguage', 'muted', 'playbackSpeed', 'preferredResolutions', 'previousVolume', 'versions', 'volume'];\n  }\n\n  get localSettings() {\n    return SyncSettings.settingsKeys.reduce((settings, key) => {\n      settings[key] = this.props[key];\n      return settings;\n    }, {});\n  }\n\n  set localSettings(settings) {// this.props.syncSettings(settings)\n  }\n\n  get storageSettings() {\n    const settings = localStorage.getItem(SyncSettings.storageKey);\n\n    try {\n      return JSON.parse(settings || '');\n    } catch (e) {\n      return null;\n    }\n  }\n\n  set storageSettings(settings) {\n    return localStorage.setItem(SyncSettings.storageKey, JSON.stringify(settings));\n  }\n\n  componentDidMount() {\n    const isVersioned = this.isVersioned(this.localSettings, this.storageSettings);\n\n    if (isVersioned) {\n      this.storageSettings = null;\n    }\n\n    this.syncStorageToLocal();\n\n    if (this.props.liveSync) {\n      window.addEventListener('storage', this.handleStorage);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.props.liveSync) {\n      window.removeEventListener('storage', this.handleStorage);\n    }\n  }\n\n  componentDidUpdate() {\n    this.syncLocalToStorage();\n  }\n\n  syncLocalToStorage() {\n    const isChanged = this.isChanged(this.localSettings, this.storageSettings);\n\n    if (isChanged) {\n      this.storageSettings = this.localSettings;\n    }\n  }\n\n  syncStorageToLocal() {\n    const isChanged = this.isChanged(this.localSettings, this.storageSettings);\n\n    if (isChanged) {\n      this.localSettings = this.storageSettings;\n    }\n  }\n\n  isChanged(a, b) {\n    const aKeys = Object.keys(a || {});\n    const bKeys = Object.keys(b || {});\n    const keys = SyncSettings.settingsKeys;\n    let i = keys.length;\n    let isChanged = !a || !b;\n\n    while (!isChanged && i--) {\n      const key = keys[i];\n      let aValue = a[key];\n      let bValue = b[key];\n\n      if (typeof aValue === 'object') {\n        aValue = JSON.stringify(aValue);\n      }\n\n      if (typeof bValue === 'object') {\n        bValue = JSON.stringify(bValue);\n      }\n\n      isChanged = aValue != bValue;\n    }\n\n    return isChanged;\n  }\n\n  isVersioned(a, b) {\n    try {\n      return !a || !b || a.versions.VERSION != b.versions.VERSION;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  render() {\n    return null;\n  }\n\n}\nexport default connect(state => ({\n  userAutoplaySetting: state.player.userAutoplaySetting,\n  // closedCaptioningEnabled: state.closedCaptioningEnabled,\n  // closedCaptioningLanguage: state.closedCaptioningLanguage,\n  muted: state.player.muted,\n  playbackSpeed: state.player.playbackSpeed,\n  previousVolume: state.player.previousVolume,\n  resolution: state.player.resolution,\n  versions: state.versions,\n  volume: state.player.volume,\n  // closedCaptioningLanguage: state.closedCaptioningLanguage,\n  preferredResolutions: state.player.preferredResolutions\n}), dispatch => ({\n  syncSettings: payload => dispatch(syncSettings(payload))\n}))(SyncSettings);","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/sync-settings/sync-settings.js"],"names":["React","connect","syncSettings","SyncSettings","Component","handleStorage","e","key","storageKey","syncStorageToLocal","version","settingsKeys","localSettings","reduce","settings","props","storageSettings","localStorage","getItem","JSON","parse","setItem","stringify","componentDidMount","isVersioned","liveSync","window","addEventListener","componentWillUnmount","removeEventListener","componentDidUpdate","syncLocalToStorage","isChanged","a","b","aKeys","Object","keys","bKeys","i","length","aValue","bValue","versions","VERSION","render","state","userAutoplaySetting","player","muted","playbackSpeed","previousVolume","resolution","volume","preferredResolutions","dispatch","payload"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\n// import * as actions from '../../actions'\r\nimport { syncSettings } from 'state/player/playerSlice'\r\nexport class SyncSettings extends React.Component {\r\n  static get storageKey() {\r\n    return 'ps-embeddable-player-settings'\r\n  }\r\n\r\n  static get version() {\r\n    //return versions\r\n  }\r\n\r\n  static get settingsKeys() {\r\n    return [\r\n      'userAutoplaySetting',\r\n      'closedCaptioningEnabled',\r\n      'closedCaptioningLanguage',\r\n      'muted',\r\n      'playbackSpeed',\r\n      'preferredResolutions',\r\n      'previousVolume',\r\n      'versions',\r\n      'volume',\r\n    ]\r\n  }\r\n\r\n  get localSettings() {\r\n    return SyncSettings.settingsKeys.reduce((settings, key) => {\r\n      settings[key] = this.props[key]\r\n      return settings\r\n    }, {})\r\n  }\r\n\r\n  set localSettings(settings) {\r\n   // this.props.syncSettings(settings)\r\n  }\r\n\r\n  get storageSettings() {\r\n    const settings = localStorage.getItem(SyncSettings.storageKey)\r\n\r\n    try {\r\n      return JSON.parse(settings || '')\r\n    } catch (e) {\r\n      return null\r\n    }\r\n  }\r\n\r\n  set storageSettings(settings) {\r\n    return localStorage.setItem(SyncSettings.storageKey, JSON.stringify(settings))\r\n  }\r\n\r\n  componentDidMount() {\r\n    const isVersioned = this.isVersioned(this.localSettings, this.storageSettings)\r\n\r\n    if (isVersioned) {\r\n      this.storageSettings = null\r\n    }\r\n\r\n    this.syncStorageToLocal()\r\n    if (this.props.liveSync) {\r\n      window.addEventListener('storage', this.handleStorage)\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.props.liveSync) {\r\n      window.removeEventListener('storage', this.handleStorage)\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.syncLocalToStorage()\r\n  }\r\n\r\n  handleStorage = e => {\r\n    if (e.key == SyncSettings.storageKey) {\r\n      this.syncStorageToLocal()\r\n    }\r\n  }\r\n\r\n  syncLocalToStorage() {\r\n    const isChanged = this.isChanged(this.localSettings, this.storageSettings)\r\n\r\n    if (isChanged) {\r\n      this.storageSettings = this.localSettings\r\n    }\r\n  }\r\n\r\n  syncStorageToLocal() {\r\n    const isChanged = this.isChanged(this.localSettings, this.storageSettings)\r\n\r\n    if (isChanged) {\r\n      this.localSettings = this.storageSettings\r\n    }\r\n  }\r\n\r\n  isChanged(a, b) {\r\n    const aKeys = Object.keys(a || {})\r\n    const bKeys = Object.keys(b || {})\r\n    const keys = SyncSettings.settingsKeys\r\n    let i = keys.length\r\n    let isChanged = !a || !b\r\n\r\n    while (!isChanged && i--) {\r\n      const key = keys[i]\r\n      let aValue = a[key]\r\n      let bValue = b[key]\r\n\r\n      if (typeof aValue === 'object') {\r\n        aValue = JSON.stringify(aValue)\r\n      }\r\n\r\n      if (typeof bValue === 'object') {\r\n        bValue = JSON.stringify(bValue)\r\n      }\r\n\r\n      isChanged = aValue != bValue\r\n    }\r\n\r\n    return isChanged\r\n  }\r\n\r\n  isVersioned(a, b) {\r\n    try {\r\n      return !a || !b || a.versions.VERSION != b.versions.VERSION\r\n    } catch (e) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return null\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  state => ({\r\n    userAutoplaySetting: state.player.userAutoplaySetting,\r\n    // closedCaptioningEnabled: state.closedCaptioningEnabled,\r\n    // closedCaptioningLanguage: state.closedCaptioningLanguage,\r\n    muted: state.player.muted,\r\n    playbackSpeed: state.player.playbackSpeed,\r\n    previousVolume: state.player.previousVolume,\r\n    resolution: state.player.resolution,\r\n    versions: state.versions,\r\n    volume: state.player.volume,\r\n    // closedCaptioningLanguage: state.closedCaptioningLanguage,\r\n    preferredResolutions: state.player.preferredResolutions,\r\n  }),\r\n  dispatch => ({\r\n    syncSettings: payload => dispatch(syncSettings(payload)),\r\n  })\r\n)(SyncSettings)\r\n"]},"metadata":{},"sourceType":"module"}