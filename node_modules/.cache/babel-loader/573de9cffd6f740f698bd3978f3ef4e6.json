{"ast":null,"code":"import _regeneratorRuntime from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{Box,GridForm,Markdown,Text}from'@codecademy/gamut';import{delay}from'lodash';import React,{useMemo,useRef,useState}from'react';import{useMountedState}from'react-use';import{v4 as uuid}from'uuid';import cookie from'react-cookies';import{passwordTips}from'libs/passwordTips';import{setCredentials}from'state/auth/authSlice';import{hideCurrentModal,showModal}from'state/modals/modalSlice';import{useAppDispatch}from'store/hooks';import{useLoginMutation}from'services/auth';import{redirectAfterLogin}from'./helpers';import styles from'./styles/index.module.scss';import{UserSubmitKey}from'./types';import{VALIDATORS}from'./validators';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var SigninForm=function SigninForm(_ref){var _ref$onSuccess=_ref.onSuccess,onSuccess=_ref$onSuccess===void 0?redirectAfterLogin:_ref$onSuccess,props=_objectWithoutProperties(_ref,[\"onSuccess\"]);var dispatch=useAppDispatch();// const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\nvar isMounted=useMountedState();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setDisabled=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),submitLocked=_useState4[0],setSubmitLocked=_useState4[1];var _useState5=useState(uuid()),_useState6=_slicedToArray(_useState5,2),recaptchaInstanceId=_useState6[0],setRecaptchaInstanceId=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),serializedForm=_useState8[0],setSerializedForm=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),recaptchaError=_useState10[0],setRecaptchaError=_useState10[1];var captcha=useRef(null);var _useMemo=useMemo(function(){return{emailValidation:VALIDATORS.email(),passwordValidation:VALIDATORS.password()};},[]),emailValidation=_useMemo.emailValidation,passwordValidation=_useMemo.passwordValidation;var _useLoginMutation=useLoginMutation(),_useLoginMutation2=_slicedToArray(_useLoginMutation,2),login=_useLoginMutation2[0],_useLoginMutation2$=_useLoginMutation2[1],data=_useLoginMutation2$.data,error=_useLoginMutation2$.error;var onUpdate=function onUpdate(){delay(function(){return isMounted()&&submitLocked&&setSubmitLocked(false);},500);};var submitForm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;values.csrfmiddlewaretoken=cookie.load('csrftoken');_context.next=4;return login(values).unwrap();case 4:user=_context.sent;localStorage.setItem('token',user.token);dispatch(setCredentials(user));dispatch(hideCurrentModal());_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.log(\"Error: \",_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function submitForm(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:styles.registrationContainer,children:[/*#__PURE__*/_jsx(GridForm,{className:styles.loginForm,fields:[{name:UserSubmitKey.EMAIL,label:'Email',type:'email',defaultValue:'',size:12,onUpdate:onUpdate},{name:UserSubmitKey.PASSWORD,label:'Password',type:'password',tooltip:{children:/*#__PURE__*/_jsx(Markdown,{text:passwordTips}),id:'password-tooltip',alignment:'bottom-left',className:styles.tooltipContainer},size:12,onUpdate:onUpdate,defaultValue:''}],submit:{contents:'Log In',position:'stretch',theme:'brand-red',size:12,disabled:isDisabled||submitLocked},validation:\"all\",onSubmit:submitForm}),/*#__PURE__*/_jsx(Box,{pt:16,children:recaptchaError&&/*#__PURE__*/_jsx(\"div\",{className:styles.recaptchaError,children:recaptchaError})}),/*#__PURE__*/_jsx(Text,{className:styles.textDisplay,children:/*#__PURE__*/_jsxs(\"p\",{className:styles.textCenter,children:[\"Need an account?\",\" \",/*#__PURE__*/_jsx(\"a\",{className:styles.textLink,onClick:function onClick(){return dispatch(showModal('signup'));},children:\"Sign up\"}),\".\"]})})]});};","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/components/Forms/RegistrationForm/SigninForm.tsx"],"names":["Box","GridForm","Markdown","Text","delay","React","useMemo","useRef","useState","useMountedState","v4","uuid","cookie","passwordTips","setCredentials","hideCurrentModal","showModal","useAppDispatch","useLoginMutation","redirectAfterLogin","styles","UserSubmitKey","VALIDATORS","SigninForm","onSuccess","props","dispatch","isMounted","isDisabled","setDisabled","submitLocked","setSubmitLocked","recaptchaInstanceId","setRecaptchaInstanceId","serializedForm","setSerializedForm","recaptchaError","setRecaptchaError","captcha","emailValidation","email","passwordValidation","password","login","data","error","onUpdate","submitForm","values","csrfmiddlewaretoken","load","unwrap","user","localStorage","setItem","token","console","log","registrationContainer","loginForm","name","EMAIL","label","type","defaultValue","size","PASSWORD","tooltip","children","id","alignment","className","tooltipContainer","contents","position","theme","disabled","textDisplay","textCenter","textLink"],"mappings":"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","sourcesContent":["import { Box, GridForm, Markdown, Text } from '@codecademy/gamut';\nimport { delay } from 'lodash';\nimport React, { useMemo, useRef, useState } from 'react';\nimport { useMountedState } from 'react-use';\n\nimport { v4 as uuid } from 'uuid';\n\nimport cookie from 'react-cookies';\n\nimport { RecaptchaWrapper } from 'components/Forms/RecaptchaWrapper';\n\n\nimport { passwordTips } from 'libs/passwordTips';\nimport { setCredentials } from 'state/auth/authSlice';\n\n\nimport { hideCurrentModal, showModal } from 'state/modals/modalSlice';\nimport { useAppDispatch, useAppSelector } from 'store/hooks';\nimport { useLoginMutation, useGetCurrentUserQuery, getCurrentUser } from 'services/auth';\nimport { redirectAfterLogin, serializeRegistrationValues } from './helpers';\n\nimport styles from './styles/index.module.scss';\nimport {\n  RegistrationFormProps,\n  SerializedValues,\n  SubmitValues,\n  UserSubmitKey,\n} from './types';\nimport { extractValidationErrors, VALIDATORS } from './validators';\n\nexport const SigninForm: React.FC<RegistrationFormProps> = ({\n  onSuccess = redirectAfterLogin,\n  ...props\n}) => {\n  const dispatch = useAppDispatch()\n  // const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\n  const isMounted = useMountedState();\n  const [isDisabled, setDisabled] = useState(false);\n  const [submitLocked, setSubmitLocked] = useState(true);\n  const [recaptchaInstanceId, setRecaptchaInstanceId] = useState(uuid());\n  const [\n    serializedForm,\n    setSerializedForm,\n  ] = useState<SerializedValues | null>();\n  const [recaptchaError, setRecaptchaError] = useState<string | undefined>();\n\n  const captcha = useRef<RecaptchaWrapper | null>(null);\n\n  const { emailValidation, passwordValidation } = useMemo(\n    () => ({\n      emailValidation: VALIDATORS.email(),\n      passwordValidation: VALIDATORS.password(),\n    }),\n    []\n  );\n\n\n  \n  const [login, { data, error}] = useLoginMutation()\n  \n\n  const onUpdate = () => {\n    delay(() => isMounted() && submitLocked && setSubmitLocked(false), 500);\n  };\n\n  const submitForm = async (values) => {\n    try {\n      values.csrfmiddlewaretoken = cookie.load('csrftoken');\n      const user = await login(values).unwrap()\n      localStorage.setItem('token', user.token);\n      dispatch(setCredentials(user))\n      dispatch(hideCurrentModal())\n\n    } catch (err) {\n      console.log(\"Error: \", err)\n    }\n    \n  }\n\n  \n\n  return (\n    <div className={styles.registrationContainer}>\n      <GridForm\n        className={styles.loginForm}\n        fields={[\n          {\n            name: UserSubmitKey.EMAIL,\n            label: 'Email',\n            type: 'email',\n            defaultValue: '',\n            size: 12,\n            onUpdate,\n          \n          },\n          {\n            name: UserSubmitKey.PASSWORD,\n            label: 'Password',\n            type: 'password',\n            tooltip: {\n              children: <Markdown text={passwordTips} />,\n              id: 'password-tooltip',\n              alignment: 'bottom-left',\n              className: styles.tooltipContainer,\n            },\n            size: 12,\n            onUpdate,\n            defaultValue: '',\n            \n          },\n          \n         \n        ]}\n        submit={{\n          contents: 'Log In',\n          position: 'stretch',\n          theme: 'brand-red',\n          size: 12,\n          disabled: isDisabled || submitLocked,\n        }}\n        validation=\"all\"\n        onSubmit={submitForm}\n      />\n      <Box pt={16}>\n        {recaptchaError && (\n          <div className={styles.recaptchaError} >\n            {recaptchaError}\n          </div>\n        )}\n        {/* <RecaptchaWrapper\n          key={recaptchaInstanceId}\n          publicKey={''}\n          size=\"invisible\"\n          ref={captcha}\n          onChange={submitForm}\n          onExpired={resetRecaptcha}\n        /> */}\n      </Box>\n      <Text className={styles.textDisplay} >\n        <p className={styles.textCenter}>\n          Need an account?{\" \"}\n          <a className={styles.textLink} onClick={() => dispatch(showModal('signup'))}>\n            Sign up\n          </a>\n          .\n        </p>\n      </Text>\n\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}