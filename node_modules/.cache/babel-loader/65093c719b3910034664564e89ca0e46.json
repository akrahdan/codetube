{"ast":null,"code":"import _regeneratorRuntime from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Users/akrah/Documents/dev/readux/src/codefluent/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{Box,GridForm,Markdown,Text}from'@codecademy/gamut';import{delay}from'lodash';import React,{useMemo,useRef,useState}from'react';import{useMountedState}from'react-use';import{v4 as uuid}from'uuid';import cookie from'react-cookies';// import { pushDataLayerEvent, trackUserClick } from '~/libs/eventTracking';\n// import { logger } from '~/libs/logging/logger';\nimport{passwordTips}from'libs/passwordTips';// import { csrf } from '~/libs/superagent-auth';\n// import { safeRedirectUrl } from '~/libs/url';\n// import registrationStrings from '~/localized/registration.json';\n// import { useFeatureFlag } from 'state/features/hooks';\nimport{showModal}from'state/modals/modalSlice';import{useAppDispatch}from'store/hooks';import{redirectAfterLogin}from'./helpers';import styles from'./styles/index.module.scss';import{UserSubmitKey}from'./types';import{VALIDATORS}from'./validators';import{useSignupMutation}from'services/auth';import{hideCurrentModal}from'state/modals/modalSlice';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var RegistrationForm=function RegistrationForm(_ref){var _ref$onSuccess=_ref.onSuccess,onSuccess=_ref$onSuccess===void 0?redirectAfterLogin:_ref$onSuccess,props=_objectWithoutProperties(_ref,[\"onSuccess\"]);var dispatch=useAppDispatch();// const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\nvar isMounted=useMountedState();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setDisabled=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),submitLocked=_useState4[0],setSubmitLocked=_useState4[1];var _useState5=useState(uuid()),_useState6=_slicedToArray(_useState5,2),recaptchaInstanceId=_useState6[0],setRecaptchaInstanceId=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),serializedForm=_useState8[0],setSerializedForm=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),recaptchaError=_useState10[0],setRecaptchaError=_useState10[1];var captcha=useRef(null);var _useMemo=useMemo(function(){return{emailValidation:VALIDATORS.email(),passwordValidation:VALIDATORS.password()};},[]),emailValidation=_useMemo.emailValidation,passwordValidation=_useMemo.passwordValidation;// if (ssoFeatureFlag) {\n//   return <RegistrationSSOForm onSuccess={onSuccess} />;\n// }\nvar resetRecaptcha=function resetRecaptcha(){setDisabled(false);setRecaptchaInstanceId(uuid());};var _useSignupMutation=useSignupMutation(),_useSignupMutation2=_slicedToArray(_useSignupMutation,1),signup=_useSignupMutation2[0];var submitForm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values.password2=values.password1;values.csrfmiddlewaretoken=cookie.load('csrftoken');values.csrfmiddlewaretoken=cookie.load('csrftoken');_context.next=5;return signup(values).unwrap();case 5:user=_context.sent;localStorage.setItem('token',user.token);dispatch(hideCurrentModal());setDisabled(true);case 9:case\"end\":return _context.stop();}}},_callee);}));return function submitForm(_x){return _ref2.apply(this,arguments);};}();/**\n   * @description\n   * This unlocks submit a half second after the first input to prevent against bots - subsequent calls have no effect\n   * */var onUpdate=function onUpdate(){delay(function(){return isMounted()&&submitLocked&&setSubmitLocked(false);},500);};var currentPage=props.currentPage,locationType=props.locationType,redirectUrl=props.redirectUrl;var signingUpFromExercise=locationType==='location/EXERCISE';// const safeRedirect = redirectUrl && safeRedirectUrl(redirectUrl);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:styles.registrationContainer,children:[/*#__PURE__*/_jsx(GridForm,{className:styles.loginForm,fields:[{name:UserSubmitKey.EMAIL,label:'Email',type:'email',defaultValue:'',size:12,onUpdate:onUpdate},{name:UserSubmitKey.USERNAME,label:'Username',type:'text',defaultValue:'',size:12,onUpdate:onUpdate},{name:UserSubmitKey.PASSWORD1,label:'Password',type:'password',tooltip:{children:/*#__PURE__*/_jsx(Markdown,{text:passwordTips}),id:'password-tooltip',alignment:'bottom-left',className:styles.tooltipContainer},size:12,onUpdate:onUpdate,defaultValue:''}],submit:{contents:'Create Account',position:'stretch',theme:'brand-red',size:12,disabled:isDisabled||submitLocked},validation:\"all\",onSubmit:submitForm}),/*#__PURE__*/_jsx(Box,{pt:16,children:recaptchaError&&/*#__PURE__*/_jsx(\"div\",{className:styles.recaptchaError,children:recaptchaError})}),/*#__PURE__*/_jsx(Text,{className:styles.textDisplay,children:/*#__PURE__*/_jsxs(\"p\",{className:styles.textCenter,children:[\"Already have an account?\",\" \",/*#__PURE__*/_jsx(\"a\",{className:styles.textLink,onClick:function onClick(){return dispatch(showModal('login'));},children:\"Sign in\"}),\".\"]})})]});};","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/components/Forms/RegistrationForm/index.tsx"],"names":["Box","GridForm","Markdown","Text","delay","React","useMemo","useRef","useState","useMountedState","v4","uuid","cookie","passwordTips","showModal","useAppDispatch","redirectAfterLogin","styles","UserSubmitKey","VALIDATORS","useSignupMutation","hideCurrentModal","RegistrationForm","onSuccess","props","dispatch","isMounted","isDisabled","setDisabled","submitLocked","setSubmitLocked","recaptchaInstanceId","setRecaptchaInstanceId","serializedForm","setSerializedForm","recaptchaError","setRecaptchaError","captcha","emailValidation","email","passwordValidation","password","resetRecaptcha","signup","submitForm","values","password2","password1","csrfmiddlewaretoken","load","unwrap","user","localStorage","setItem","token","onUpdate","currentPage","locationType","redirectUrl","signingUpFromExercise","registrationContainer","loginForm","name","EMAIL","label","type","defaultValue","size","USERNAME","PASSWORD1","tooltip","children","id","alignment","className","tooltipContainer","contents","position","theme","disabled","textDisplay","textCenter","textLink"],"mappings":"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","sourcesContent":["import { Box, GridForm, Markdown, Text } from '@codecademy/gamut';\nimport { delay } from 'lodash';\nimport React, { useMemo, useRef, useState } from 'react';\nimport { useMountedState } from 'react-use';\nimport request from 'superagent';\nimport { v4 as uuid } from 'uuid';\nimport cookie from 'react-cookies';\nimport { OauthButtonGroup } from 'components/Forms/OauthButtonGroup';\nimport { RecaptchaWrapper } from 'components/Forms/RecaptchaWrapper';\nimport { cfdata } from 'libs/cfdata';\n// import { pushDataLayerEvent, trackUserClick } from '~/libs/eventTracking';\n// import { logger } from '~/libs/logging/logger';\nimport { passwordTips } from 'libs/passwordTips';\n// import { csrf } from '~/libs/superagent-auth';\n// import { safeRedirectUrl } from '~/libs/url';\nimport { registerPath } from 'libs/urlHelpers';\n// import registrationStrings from '~/localized/registration.json';\n// import { useFeatureFlag } from 'state/features/hooks';\n\nimport { showModal } from 'state/modals/modalSlice';\nimport { useAppDispatch } from 'store/hooks';\nimport { redirectAfterLogin, serializeRegistrationValues } from './helpers';\nimport { RegistrationSSOForm } from './RegistrationSSOForm';\nimport styles from './styles/index.module.scss';\nimport {\n  RegistrationFormProps,\n  SerializedValues,\n  SubmitValues,\n  UserSubmitKey,\n} from './types';\nimport { extractValidationErrors, VALIDATORS } from './validators';\nimport { useSignupMutation } from 'services/auth';\nimport { hideCurrentModal } from 'state/modals/modalSlice';\nexport const RegistrationForm: React.FC<RegistrationFormProps> = ({\n  onSuccess = redirectAfterLogin,\n  ...props\n}) => {\n  const dispatch = useAppDispatch()\n  // const ssoFeatureFlag = useFeatureFlag('enterprise_sso_form');\n  const isMounted = useMountedState();\n  const [isDisabled, setDisabled] = useState(false);\n  const [submitLocked, setSubmitLocked] = useState(true);\n  const [recaptchaInstanceId, setRecaptchaInstanceId] = useState(uuid());\n  const [\n    serializedForm,\n    setSerializedForm,\n  ] = useState<SerializedValues | null>();\n  const [recaptchaError, setRecaptchaError] = useState<string | undefined>();\n\n  const captcha = useRef<RecaptchaWrapper | null>(null);\n\n  const { emailValidation, passwordValidation } = useMemo(\n    () => ({\n      emailValidation: VALIDATORS.email(),\n      passwordValidation: VALIDATORS.password(),\n    }),\n    []\n  );\n\n  // if (ssoFeatureFlag) {\n  //   return <RegistrationSSOForm onSuccess={onSuccess} />;\n  // }\n\n \n\n  const resetRecaptcha = () => {\n    \n    setDisabled(false);\n    setRecaptchaInstanceId(uuid());\n  };\n\n  const [ signup ] = useSignupMutation()\n\n  const submitForm = async (values) => {\n    values.password2 = values.password1\n    values.csrfmiddlewaretoken = cookie.load('csrftoken')\n    \n     values.csrfmiddlewaretoken = cookie.load('csrftoken');\n      const user = await signup(values).unwrap()\n      localStorage.setItem('token', user.token);\n      \n      dispatch(hideCurrentModal())\n      setDisabled(true);\n  }\n\n  /**\n   * @description\n   * This unlocks submit a half second after the first input to prevent against bots - subsequent calls have no effect\n   * */\n  const onUpdate = () => {\n    delay(() => isMounted() && submitLocked && setSubmitLocked(false), 500);\n  };\n\n  const { currentPage, locationType, redirectUrl } = props;\n  const signingUpFromExercise = locationType === 'location/EXERCISE';\n  // const safeRedirect = redirectUrl && safeRedirectUrl(redirectUrl);\n\n  return (\n    <div className={styles.registrationContainer}>\n      <GridForm\n        className={styles.loginForm}\n        fields={[\n          {\n            name: UserSubmitKey.EMAIL,\n            label: 'Email',\n            type: 'email',\n            defaultValue: '',\n            size: 12,\n            onUpdate,\n           \n          },\n\n          {\n            name: UserSubmitKey.USERNAME,\n            label: 'Username',\n            type: 'text',\n            defaultValue: '',\n            size: 12,\n            onUpdate,\n           \n          },\n          {\n            name: UserSubmitKey.PASSWORD1,\n            label: 'Password',\n            type: 'password',\n            tooltip: {\n              children: <Markdown text={passwordTips} />,\n              id: 'password-tooltip',\n              alignment: 'bottom-left',\n              className: styles.tooltipContainer,\n            },\n            size: 12,\n            onUpdate,\n            defaultValue: '',\n            \n          },\n           \n        ]}\n        submit={{\n          contents: 'Create Account',\n          position: 'stretch',\n          theme: 'brand-red',\n          size: 12,\n          disabled: isDisabled || submitLocked,\n        }}\n        validation=\"all\"\n        onSubmit={submitForm}\n      />\n      <Box pt={16}>\n        {recaptchaError && (\n          <div className={styles.recaptchaError} >\n            {recaptchaError}\n          </div>\n        )}\n        \n      </Box>\n      <Text className={styles.textDisplay} >\n        <p className={styles.textCenter}>\n          Already have an account?{\" \"}\n          <a className={styles.textLink} onClick={() => dispatch(showModal('login')) }>\n            Sign in\n          </a>\n          .\n        </p>\n      </Text>\n\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}