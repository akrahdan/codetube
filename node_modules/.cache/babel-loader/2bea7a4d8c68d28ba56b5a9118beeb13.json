{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React from 'react';\nimport { canUseDOM, uniqueId as defaultUniqueId } from '@pluralsight/ps-design-system-util';\nimport innerText from 'react-innertext';\nexport var DropdownContext = React.createContext({\n  onDocumentEvents: function (_evt) {},\n  onMenuClick: function (_evt, _value) {}\n});\n\nvar sortDropdownProps = function (_a) {\n  var appearance = _a.appearance,\n      disabled = _a.disabled,\n      className = _a.className,\n      error = _a.error,\n      label = _a.label,\n      menu = _a.menu,\n      onChange = _a.onChange,\n      onClick = _a.onClick,\n      placeholder = _a.placeholder,\n      size = _a.size,\n      subLabel = _a.subLabel,\n      style = _a.style,\n      value = _a.value,\n      rest = __rest(_a, [\"appearance\", \"disabled\", \"className\", \"error\", \"label\", \"menu\", \"onChange\", \"onClick\", \"placeholder\", \"size\", \"subLabel\", \"style\", \"value\"]);\n\n  return {\n    button: __assign({\n      appearance: appearance,\n      disabled: disabled,\n      error: error,\n      size: size\n    }, rest),\n    hook: {\n      menu: menu,\n      value: value,\n      onChange: onChange,\n      onClick: onClick,\n      placeholder: placeholder\n    },\n    input: {\n      disabled: disabled\n    },\n    label: {\n      label: label\n    },\n    layout: {\n      className: className,\n      disabled: disabled,\n      style: style\n    },\n    menu: {\n      menu: menu\n    },\n    selected: {\n      appearance: appearance,\n      placeholder: placeholder,\n      size: size\n    },\n    subLabel: {\n      subLabel: subLabel\n    }\n  };\n}; // TODO: move to react folder? Uses React APIs.\n\n\nexport var useDropdown = function (props, forwardedRef) {\n  var uid = props.uniqueId || defaultUniqueId;\n  var buttonId = React.useMemo(function () {\n    return uid('dropdown-button-');\n  }, []);\n  var labelId = React.useMemo(function () {\n    return uid('dropdown-label-');\n  }, []);\n  var menuId = React.useMemo(function () {\n    return uid('dropdown-menu-');\n  }, []);\n\n  var _a = sortDropdownProps(props),\n      hook = _a.hook,\n      rest = __rest(_a, [\"hook\"]);\n\n  var _b = React.useState(false),\n      isOpen = _b[0],\n      setOpen = _b[1];\n\n  var items = React.useMemo(function () {\n    return parseMenuChildren(menuId, hook.menu);\n  }, [menuId, hook.menu]);\n  var itemMatchingValueIndex = findIndexMatchingValueOrLabel(items, hook.value, hook.value);\n  var itemMatchingValue = items[itemMatchingValueIndex];\n\n  var _c = React.useState(itemMatchingValue),\n      selectedItem = _c[0],\n      setSelectedItem = _c[1];\n\n  React.useEffect(function () {\n    setSelectedItem(itemMatchingValue);\n  }, [itemMatchingValue]);\n  React.useEffect(function () {\n    function handleEscape(evt) {\n      var _a;\n\n      if (evt.key === 'Escape') {\n        setOpen(false);\n        (_a = buttonRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n      }\n    }\n\n    if (canUseDOM() && isOpen) {\n      document.addEventListener('keydown', handleEscape, false);\n      return function () {\n        document.removeEventListener('keydown', handleEscape, false);\n      };\n    }\n  }, [itemMatchingValueIndex, isOpen]);\n  var openKeyEvents = new Set(['Enter', 'ArrowDown', 'ArrowUp', ' ']);\n\n  function handleButtonEvent(evt) {\n    if (evt.type === 'click' || evt.type === 'keydown' && 'key' in evt && openKeyEvents.has(evt.key)) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      var newOpen = !isOpen;\n      setOpen(newOpen);\n      if (typeof hook.onClick === 'function') hook.onClick(evt);\n    }\n  }\n\n  function handleMenuItemClick(evt, itemValue) {\n    setSelectedItem(findItemMatchingValueOrLabel(items, itemValue, itemValue));\n    setOpen(false);\n    if (typeof hook.onChange === 'function') hook.onChange(evt, itemValue);\n\n    if (buttonRef.current) {\n      buttonRef.current.focus();\n    }\n  }\n\n  var longestLabel = getLongestMenuLabel(items, hook.placeholder);\n  var buttonRef = React.useRef(null);\n  React.useImperativeHandle(forwardedRef, function () {\n    return buttonRef.current;\n  });\n  var inNode = canUseDOM() ? document.body : undefined;\n\n  var _d = React.useState({\n    left: 0,\n    top: 0,\n    width: 0\n  }),\n      menuPosition = _d[0],\n      setMenuPosition = _d[1];\n\n  return {\n    button: __assign(__assign({}, rest.button), {\n      id: buttonId,\n      // eslint-disable-next-line @typescript-eslint/prefer-as-const\n      'aria-haspopup': 'listbox',\n      'aria-labelledby': buttonId + \" \" + labelId,\n      ref: buttonRef,\n      isOpen: isOpen,\n      onClick: handleButtonEvent,\n      onKeyDown: handleButtonEvent,\n      setMenuPosition: setMenuPosition\n    }),\n    label: __assign(__assign({}, rest.label), {\n      id: labelId\n    }),\n    layout: rest.layout,\n    menu: __assign(__assign({}, rest.menu), {\n      inNode: inNode,\n      isOpen: isOpen,\n      menuPosition: menuPosition,\n      buttonRef: buttonRef,\n      id: menuId,\n      role: 'listbox',\n      'aria-labelledby': buttonId\n    }),\n    selected: __assign(__assign({}, rest.selected), {\n      label: longestLabel,\n      selectedItem: selectedItem\n    }),\n    subLabel: rest.subLabel,\n    value: {\n      value: {\n        onDocumentEvents: function (ref, evt) {\n          var _a;\n\n          if (!(evt.target instanceof HTMLElement) || !((_a = ref.current) === null || _a === void 0 ? void 0 : _a.contains(evt.target))) setOpen(false);\n        },\n        onMenuClick: handleMenuItemClick,\n        selectedItem: selectedItem\n      }\n    }\n  };\n};\n\nfunction findIndexMatchingValueOrLabel(items, label, value) {\n  return items.findIndex(function (item) {\n    return typeof item.value !== 'undefined' && item.value === value || item.label === label;\n  });\n}\n\nfunction findItemMatchingValueOrLabel(items, label, value) {\n  var index = findIndexMatchingValueOrLabel(items, label, value);\n  return items[index];\n}\n\nexport var parseMenuChildren = function (menuId, menu) {\n  if (!menu) return [];\n\n  function parseItem(item) {\n    return innerText(item) !== '' ? {\n      id: formatItemId(menuId, item.props.children, item.props.value),\n      label: item.props.children,\n      value: item.props.value\n    } : undefined;\n  }\n\n  if (Array.isArray(menu)) {\n    return menu.map(parseItem).filter(Boolean);\n  } else {\n    if (React.Children.count(menu.props.children) <= 0) return [];else return React.Children.map(menu.props.children, parseItem);\n  }\n};\nexport var formatItemId = function (menuId, label, value) {\n  return menuId + \"-\" + (value || label.toString().replace(/ /g, ''));\n};\nexport var getLongestMenuLabel = function (items, placeholder) {\n  return items.reduce(function (currentLongest, item) {\n    var _a;\n\n    return ((_a = item.label) === null || _a === void 0 ? void 0 : _a.length) > currentLongest.length ? item.label : currentLongest;\n  }, placeholder || '');\n};\nexport { useMenuRef, handleMenuKeyDownEvents } from './menuKeyEvents';","map":{"version":3,"sources":["../../../src/js/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React from 'react';\nimport { canUseDOM, uniqueId as defaultUniqueId } from '@pluralsight/ps-design-system-util';\nimport innerText from 'react-innertext';\nexport var DropdownContext = React.createContext({\n    onDocumentEvents: function (_evt) { },\n    onMenuClick: function (_evt, _value) { }\n});\nvar sortDropdownProps = function (_a) {\n    var appearance = _a.appearance, disabled = _a.disabled, className = _a.className, error = _a.error, label = _a.label, menu = _a.menu, onChange = _a.onChange, onClick = _a.onClick, placeholder = _a.placeholder, size = _a.size, subLabel = _a.subLabel, style = _a.style, value = _a.value, rest = __rest(_a, [\"appearance\", \"disabled\", \"className\", \"error\", \"label\", \"menu\", \"onChange\", \"onClick\", \"placeholder\", \"size\", \"subLabel\", \"style\", \"value\"]);\n    return ({\n        button: __assign({ appearance: appearance,\n            disabled: disabled,\n            error: error,\n            size: size }, rest),\n        hook: {\n            menu: menu,\n            value: value,\n            onChange: onChange,\n            onClick: onClick,\n            placeholder: placeholder\n        },\n        input: {\n            disabled: disabled\n        },\n        label: {\n            label: label\n        },\n        layout: {\n            className: className,\n            disabled: disabled,\n            style: style\n        },\n        menu: {\n            menu: menu\n        },\n        selected: {\n            appearance: appearance,\n            placeholder: placeholder,\n            size: size\n        },\n        subLabel: {\n            subLabel: subLabel\n        }\n    });\n};\n// TODO: move to react folder? Uses React APIs.\nexport var useDropdown = function (props, forwardedRef) {\n    var uid = props.uniqueId || defaultUniqueId;\n    var buttonId = React.useMemo(function () { return uid('dropdown-button-'); }, []);\n    var labelId = React.useMemo(function () { return uid('dropdown-label-'); }, []);\n    var menuId = React.useMemo(function () { return uid('dropdown-menu-'); }, []);\n    var _a = sortDropdownProps(props), hook = _a.hook, rest = __rest(_a, [\"hook\"]);\n    var _b = React.useState(false), isOpen = _b[0], setOpen = _b[1];\n    var items = React.useMemo(function () { return parseMenuChildren(menuId, hook.menu); }, [\n        menuId,\n        hook.menu\n    ]);\n    var itemMatchingValueIndex = findIndexMatchingValueOrLabel(items, hook.value, hook.value);\n    var itemMatchingValue = items[itemMatchingValueIndex];\n    var _c = React.useState(itemMatchingValue), selectedItem = _c[0], setSelectedItem = _c[1];\n    React.useEffect(function () {\n        setSelectedItem(itemMatchingValue);\n    }, [itemMatchingValue]);\n    React.useEffect(function () {\n        function handleEscape(evt) {\n            var _a;\n            if (evt.key === 'Escape') {\n                setOpen(false);\n                (_a = buttonRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n            }\n        }\n        if (canUseDOM() && isOpen) {\n            document.addEventListener('keydown', handleEscape, false);\n            return function () {\n                document.removeEventListener('keydown', handleEscape, false);\n            };\n        }\n    }, [itemMatchingValueIndex, isOpen]);\n    var openKeyEvents = new Set(['Enter', 'ArrowDown', 'ArrowUp', ' ']);\n    function handleButtonEvent(evt) {\n        if (evt.type === 'click' ||\n            (evt.type === 'keydown' && 'key' in evt && openKeyEvents.has(evt.key))) {\n            evt.preventDefault();\n            evt.stopPropagation();\n            var newOpen = !isOpen;\n            setOpen(newOpen);\n            if (typeof hook.onClick === 'function')\n                hook.onClick(evt);\n        }\n    }\n    function handleMenuItemClick(evt, itemValue) {\n        setSelectedItem(findItemMatchingValueOrLabel(items, itemValue, itemValue));\n        setOpen(false);\n        if (typeof hook.onChange === 'function')\n            hook.onChange(evt, itemValue);\n        if (buttonRef.current) {\n            buttonRef.current.focus();\n        }\n    }\n    var longestLabel = getLongestMenuLabel(items, hook.placeholder);\n    var buttonRef = React.useRef(null);\n    React.useImperativeHandle(forwardedRef, function () { return buttonRef.current; });\n    var inNode = canUseDOM() ? document.body : undefined;\n    var _d = React.useState({\n        left: 0,\n        top: 0,\n        width: 0\n    }), menuPosition = _d[0], setMenuPosition = _d[1];\n    return {\n        button: __assign(__assign({}, rest.button), { id: buttonId, \n            // eslint-disable-next-line @typescript-eslint/prefer-as-const\n            'aria-haspopup': 'listbox', 'aria-labelledby': buttonId + \" \" + labelId, ref: buttonRef, isOpen: isOpen, onClick: handleButtonEvent, onKeyDown: handleButtonEvent, setMenuPosition: setMenuPosition }),\n        label: __assign(__assign({}, rest.label), { id: labelId }),\n        layout: rest.layout,\n        menu: __assign(__assign({}, rest.menu), { inNode: inNode,\n            isOpen: isOpen,\n            menuPosition: menuPosition,\n            buttonRef: buttonRef, id: menuId, role: 'listbox', 'aria-labelledby': buttonId }),\n        selected: __assign(__assign({}, rest.selected), { label: longestLabel, selectedItem: selectedItem }),\n        subLabel: rest.subLabel,\n        value: {\n            value: {\n                onDocumentEvents: function (ref, evt) {\n                    var _a;\n                    if (!(evt.target instanceof HTMLElement) ||\n                        !((_a = ref.current) === null || _a === void 0 ? void 0 : _a.contains(evt.target)))\n                        setOpen(false);\n                },\n                onMenuClick: handleMenuItemClick,\n                selectedItem: selectedItem\n            }\n        }\n    };\n};\nfunction findIndexMatchingValueOrLabel(items, label, value) {\n    return items.findIndex(function (item) {\n        return (typeof item.value !== 'undefined' && item.value === value) ||\n            item.label === label;\n    });\n}\nfunction findItemMatchingValueOrLabel(items, label, value) {\n    var index = findIndexMatchingValueOrLabel(items, label, value);\n    return items[index];\n}\nexport var parseMenuChildren = function (menuId, menu) {\n    if (!menu)\n        return [];\n    function parseItem(item) {\n        return innerText(item) !== ''\n            ? {\n                id: formatItemId(menuId, item.props.children, item.props.value),\n                label: item.props.children,\n                value: item.props.value\n            }\n            : undefined;\n    }\n    if (Array.isArray(menu)) {\n        return menu.map(parseItem).filter(Boolean);\n    }\n    else {\n        if (React.Children.count(menu.props.children) <= 0)\n            return [];\n        else\n            return React.Children.map(menu.props.children, parseItem);\n    }\n};\nexport var formatItemId = function (menuId, label, value) {\n    return menuId + \"-\" + (value || label.toString().replace(/ /g, ''));\n};\nexport var getLongestMenuLabel = function (items, placeholder) {\n    return items.reduce(function (currentLongest, item) {\n        var _a;\n        return ((_a = item.label) === null || _a === void 0 ? void 0 : _a.length) > currentLongest.length\n            ? item.label\n            : currentLongest;\n    }, placeholder || '');\n};\nexport { useMenuRef, handleMenuKeyDownEvents } from './menuKeyEvents';\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}