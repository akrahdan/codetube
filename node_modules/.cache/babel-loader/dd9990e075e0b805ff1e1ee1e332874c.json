{"ast":null,"code":"var _jsxFileName = \"/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/video/video.tsx\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { updateVideoViews } from \"services/courses\";\nimport { store } from 'store';\nimport { play, pause, setVolume, setTime, ready, seekEnd, seekStart, setBufferedTime, setMediaType, setOverlay, setBuffering, setFullscreen, setLoading, setAutoplay, setPlaying, setCurrentResolution, setPreferredResolutions, setSupportedResolutions, setClipProgress, setCurrentUrl, setClipId, setSubtitle, setCurrentLecture } from \"state/player/playerSlice\";\nimport css from \"./video.module.css\";\nimport { DefaultResolutions } from \"../constants\"; // import withAdobeHeartbeat from './with-adobe-heartbeat'\n\nimport { FullscreenState, HLS_SDK_URL, HLS_SDK_URL_SAFARI, MediaTypes } from \"../constants\";\nimport { getSDK } from \"../utilities/get-sdk\";\nimport { throttle } from \"../utilities/throttle\"; // import { sendPlaySuccessEvent } from '../../analytics/player-events'\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst HLS_EXTENSIONS = /\\.(m3u8)($|\\?)/i;\nconst initialState = {\n  isPlaying: false,\n  reportedVolume: null,\n  reportedPlaybackRate: 1,\n  isBuffering: false,\n  canPlay: false,\n  ready: true\n};\n\nconst mapState = state => ({\n  playing: state.player.playing,\n  playbackRate: state.player.playbackSpeed,\n  volume: state.player.volume,\n  buffering: state.player.buffering,\n  views: state.player.views,\n  currentLecture: state.player.currentLecture,\n  loading: state.player.loading,\n  course: state.player.course,\n  clipId: state.player.clipId,\n  muted: state.player.muted,\n  time: state.player.time,\n  currentUrl: state.player.currentUrl,\n  mediaType: state.player.mediaType,\n  overlay: state.player.overlay,\n  currentResolution: state.player.currentResolution,\n  supportedResolutions: state.player.supportedResolutions,\n  preferredResolutions: state.player.preferredResolutions\n});\n\nconst mapDispatch = dispatch => ({\n  setVolume: payload => dispatch(setVolume(payload)),\n  setDuration: payload => dispatch(setVolume(payload)),\n  setTime: payload => dispatch(setTime(payload)),\n  setBufferedTime: payload => dispatch(setBufferedTime(payload)),\n  ready: payload => dispatch(ready(payload)),\n  seekEnd: payload => dispatch(seekEnd()),\n  setNextUrl: payload => dispatch(setCurrentUrl(payload)),\n  seekStart: payload => dispatch(seekStart()),\n  play: payload => dispatch(play(payload)),\n  pause: payload => dispatch(pause(payload)),\n  setCurrentLecture: payload => dispatch(setCurrentLecture(payload)),\n  setClipId: payload => dispatch(setClipId(payload)),\n  setSubtitle: payload => dispatch(setSubtitle(payload)),\n  setBuffering: payload => dispatch(setBuffering(payload)),\n  setOverlay: payload => dispatch(setOverlay(payload)),\n  setFullscreen: payload => dispatch(setFullscreen(payload)),\n  setLoading: payload => dispatch(setLoading(payload)),\n  setPlaying: payload => dispatch(setPlaying(payload)),\n  setClipProgress: payload => dispatch(setClipProgress(payload)),\n  setAutoplay: payload => dispatch(setAutoplay(payload)),\n  setMediaType: payload => dispatch(setMediaType(payload)),\n  setCurrentResolution: payload => dispatch(setCurrentResolution(payload)),\n  setPreferredResolutions: payload => dispatch(setPreferredResolutions(payload)),\n  setSupportedResolutions: payload => dispatch(setSupportedResolutions(payload))\n});\n\nconst connector = connect(mapState, mapDispatch);\nexport class Video extends Component {\n  constructor(props) {\n    super(props);\n\n    this.newReadyPromise = () => {\n      return new Promise(resolve => {\n        this.ready = () => {\n          this.setState({\n            ready: true\n          }, () => {\n            resolve();\n          });\n        };\n      });\n    };\n\n    this.isSafari = () => navigator.vendor.match(/apple/i);\n\n    this.isHlsSource = source => HLS_EXTENSIONS.test(source);\n\n    this.destroyHls = () => {\n      this.setState({\n        hlsPlaying: false\n      });\n      this.hls && this.hls.destroy();\n    };\n\n    this.startHls = async source => {\n      const {\n        setSupportedResolutions,\n        setMediaType,\n        setCurrentResolution,\n        preferredResolutions,\n        currentResolution,\n        time\n      } = this.props;\n      const sdkUrl = this.isSafari() ? HLS_SDK_URL_SAFARI : HLS_SDK_URL; //https://github.com/video-dev/hls.js/issues/1543\n\n      const Hls = await getSDK(sdkUrl, \"Hls\");\n      if (!Hls.isSupported()) return setMediaType && setMediaType(MediaTypes.MP4);\n      this.Hls = Hls;\n      this.hls = new Hls({\n        autoStartLoad: false\n      });\n      this.hls.loadSource(source);\n      const videoElement = document.getElementById(\"video-element\");\n      this.hls.attachMedia(videoElement);\n      this.hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {\n        this.hls.startLoad(time || 0);\n        const autoLevel = {\n          height: \"Auto\",\n          index: -1\n        };\n        const supportedResolutions = data.levels.map(r => ({\n          width: r.width,\n          height: r.height,\n          index: data.levels.indexOf(r)\n        }));\n        setSupportedResolutions && setSupportedResolutions(supportedResolutions.concat(autoLevel));\n        const preferredResolution = preferredResolutions.hls ? preferredResolutions.hls : null;\n        const newResolution = preferredResolution && supportedResolutions.find(r => preferredResolution.width === r.width && preferredResolution.height === r.height);\n\n        if (!newResolution) {\n          setCurrentResolution && setCurrentResolution(autoLevel);\n          return;\n        }\n\n        this.hls && (this.hls.currentLevel = newResolution.index);\n        const resolutionShouldChange = newResolution !== currentResolution;\n        resolutionShouldChange && setCurrentResolution && setCurrentResolution(newResolution);\n      });\n      this.hls.on(Hls.Events.ERROR, this.handleHlsError.bind(this));\n      this.hls.on(Hls.Events.MEDIA_ATTACHED, (event, data) => {\n        this.setState({\n          hlsPlaying: true\n        });\n      });\n    };\n\n    this.onHlsLevelChange = ({\n      height,\n      index\n    }) => {\n      const {\n        currentResolution,\n        setCurrentResolution\n      } = this.props;\n\n      if (height === currentResolution.height) {\n        return;\n      }\n\n      this.hls && (this.hls.currentLevel = index);\n      setCurrentResolution && setCurrentResolution({\n        height,\n        index\n      });\n    };\n\n    this.requestNewUrls = () => {\n      const {\n        setLoading\n      } = this.props;\n      setLoading && setLoading(true);\n    };\n\n    this.onMediaTypeChange = newMediaType => {\n      const {\n        setSupportedResolutions,\n        setCurrentResolution,\n        preferredResolutions\n      } = this.props;\n      console.log(\"Mediatype: \", newMediaType);\n\n      if (newMediaType !== MediaTypes.HLS) {\n        setSupportedResolutions && setSupportedResolutions(DefaultResolutions[newMediaType]);\n        const resolution = preferredResolutions && preferredResolutions[newMediaType];\n        setCurrentResolution && setCurrentResolution(resolution);\n      }\n\n      if (newMediaType === MediaTypes.WEBM || newMediaType === MediaTypes.MP4) {\n        this.requestNewUrls();\n      }\n    };\n\n    this.iosEndFullscreen = () => {\n      this.props.setFullscreen(FullscreenState.NORMAL);\n    };\n\n    this.setVolume = percent => {\n      const {\n        onReady\n      } = this.state;\n      onReady.then(() => {\n        const {\n          current: player\n        } = this.element;\n        player && percent === 0 ? player.muted = true : player.muted = false; // player.volume is read only on mobile iOS\n\n        player && isFinite(percent) && (player.volume = percent);\n      });\n    };\n\n    this.setPlaybackRate = rate => {\n      const {\n        onReady\n      } = this.state;\n      onReady.then(() => {\n        const {\n          current: player\n        } = this.element;\n        player && (player.playbackRate = rate);\n      });\n    };\n\n    this.onCaptionUpdate = e => {};\n\n    this.toggleCaptions = language => {\n      const {\n        onReady\n      } = this.state;\n      onReady.then(() => {\n        const {\n          current: player\n        } = this.element;\n        player && [...player.textTracks].forEach(track => {\n          if (track.mode === \"showing\" && track.language !== language.code) track.mode = \"disabled\";\n\n          if (track.language === language.code) {\n            track.oncuechange = this.onCaptionUpdate;\n            track.mode = \"hidden\";\n          } else {\n            track.oncuechange = null;\n          }\n        });\n      });\n    };\n\n    this.seekTo = amount => {\n      const {\n        onReady\n      } = this.state;\n      onReady.then(() => {\n        const {\n          current: player\n        } = this.element;\n        player && (player.currentTime = amount);\n      });\n    };\n\n    this.onRateChange = rate => {\n      const {\n        current: player\n      } = this.element;\n      player && this.setState({\n        reportedPlaybackRate: player.playbackRate\n      });\n    };\n\n    this.onVolumeChange = rate => {\n      const {\n        current: player\n      } = this.element;\n      player && this.setState({\n        reportedVolume: player.volume\n      });\n    };\n\n    this.onPlay = () => {\n      const {\n        setPlaying\n      } = this.props; // const { isStagingEnv, urls, currentUrlIndex, userId } = this.props\n\n      this.setState({\n        isPlaying: true\n      }); // const currentUrl = urls[currentUrlIndex || 0]\n      // // sendPlaySuccessEvent(currentUrl, isStagingEnv, userId)\n\n      setPlaying && setPlaying(true);\n      this.updateProgress();\n    };\n\n    this.onPause = () => {\n      const {\n        setPlaying\n      } = this.props;\n      this.setState({\n        isPlaying: false\n      });\n      setPlaying && setPlaying(false);\n    };\n\n    this.onCanPlay = () => {\n      const {\n        setBuffering,\n        buffering,\n        loading,\n        setLoading\n      } = this.props;\n      this.setState({\n        canPlay: true\n      });\n      if (loading) setLoading && setLoading(false);\n\n      if (buffering) {\n        setBuffering && setBuffering(false); //adobeHeartbeat && adobeHeartbeat.trackBufferComplete()\n      }\n    };\n\n    this.onLoadedData = () => {\n      const {\n        setBuffering,\n        buffering,\n        setOverlay\n      } = this.props;\n      const {\n        onReady\n      } = this.state;\n\n      if (!buffering) {\n        this.setState({\n          isBuffering: true\n        });\n        setBuffering && setBuffering(true);\n      }\n\n      setOverlay && setOverlay(null);\n      onReady.then(() => {\n        const {\n          current: player\n        } = this.element; //adobeHeartbeat && adobeHeartbeat.initHeartbeat(player.duration)\n      });\n    };\n\n    this.onEnded = e => {\n      const {\n        pause,\n        clipId,\n        time,\n        currentLecture,\n        views,\n        course,\n        setCurrentLecture,\n        setNextUrl,\n        setClipId,\n        setSubtitle,\n        history\n      } = this.props; // end && end()\n\n      pause && pause(false);\n      console.log('History', history); // adobeHeartbeat && adobeHeartbeat.trackComplete()\n\n      if (views && views.length) {\n        var _course$sections;\n\n        const view = views.find(view => view.lecture == currentLecture.id);\n        store.dispatch(updateVideoViews.initiate({\n          id: view.id,\n          lecture: currentLecture.id,\n          complete: true,\n          progress: time\n        }));\n        const lectures = course && ((_course$sections = course.sections) === null || _course$sections === void 0 ? void 0 : _course$sections.flatMap(sec => sec.lectures));\n\n        if (lectures && lectures.length) {\n          const currentUrlIndex = lectures.findIndex(lec => lec.id == currentLecture.id);\n\n          if (currentUrlIndex < lectures.length - 1) {\n            const nextLectureIndex = currentUrlIndex + 1;\n            const lecture = lectures[nextLectureIndex];\n            lecture && setNextUrl(lecture.video_url);\n            lecture && setCurrentLecture(lecture);\n            lecture && setSubtitle(lecture === null || lecture === void 0 ? void 0 : lecture.title);\n            lecture && setClipId(lecture === null || lecture === void 0 ? void 0 : lecture.video.key);\n          } else {\n            const lecture = lectures[0];\n            lecture && setNextUrl(lecture.video_url);\n            lecture && setCurrentLecture(lecture);\n            lecture && setSubtitle(lecture === null || lecture === void 0 ? void 0 : lecture.title);\n            lecture && setClipId(lecture === null || lecture === void 0 ? void 0 : lecture.video.key);\n          }\n        }\n      }\n    };\n\n    this.updateTracks = videoElement => {// const { closedCaptioningLanguage, closedCaptioningEnabled, setClosedCaptioningCueList } = this.props\n      // const tracks = videoElement && videoElement.textTracks\n      // tracks &&\n      //   Object.values(tracks).forEach((track) => {\n      //     const isActive = closedCaptioningEnabled && track.language === closedCaptioningLanguage.code\n      //     if (isActive) {\n      //       track.mode = 'hidden'\n      //       videoElement.textTracks[0].mode = 'hidden' // Firefox\n      //       track.oncuechange = (e) => {\n      //         e.currentTarget.activeCues && setClosedCaptioningCueList(e.currentTarget.activeCues)\n      //       }\n      //     } else {\n      //       track.mode = 'disabled'\n      //     }\n      //   })\n    };\n\n    this.onLoadedMetadata = () => {\n      const {\n        ready,\n        registerPlayer\n      } = this.props;\n      this.ready();\n      const duration = this.getDuration();\n      ready && ready(duration);\n      const videoElement = document.getElementById(\"video-element\");\n      registerPlayer && registerPlayer(videoElement); // this.updateTracks(videoElement)\n    };\n\n    this.getSrc = ({\n      currentUrl\n    }) => {\n      // return currentUrlIndex !== null && urls && urls.length > 0 ? urls[currentUrlIndex].url : null\n      let source = currentUrl;\n      return source;\n    };\n\n    this.onSeeking = () => {// const { adobeHeartbeat } = this.props\n      // adobeHeartbeat && adobeHeartbeat.trackSeekStart()\n    };\n\n    this.onSeeked = () => {// const { adobeHeartbeat } = this.props\n      // adobeHeartbeat && adobeHeartbeat.trackSeekComplete()\n    };\n\n    this.updateProgress = () => {\n      const {\n        clipId,\n        setTime,\n        playing\n      } = this.props;\n      if (!playing) return;\n      const reportedTime = this.getPlayedSeconds();\n      setTime && setTime(reportedTime);\n      reportedTime > 0 && this.throttledSetClipProgress({\n        clipId,\n        videoSecondsWatched: reportedTime\n      });\n      this.progressTimeout = setTimeout(this.updateProgress, 50);\n    };\n\n    this.onProgress = () => {\n      const {\n        setBufferedTime\n      } = this.props;\n      const bufferedTime = this.getSecondsLoaded();\n      setBufferedTime && setBufferedTime(bufferedTime);\n    };\n\n    this.onWaiting = () => {\n      const {\n        setBuffering\n      } = this.props; //adobeHeartbeat && adobeHeartbeat.trackBufferStart()\n\n      setBuffering && setBuffering(true);\n    };\n\n    this.state = { ...initialState,\n      clipId: props.clipId,\n      onReady: this.newReadyPromise(),\n      hlsPlaying: false,\n      videoSrc: null\n    };\n    this.element = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    const {\n      playing,\n      volume,\n      muted,\n      playbackRate,\n      time,\n      mediaType,\n      currentResolution,\n      setClipProgress\n    } = this.props;\n    this.throttledSetClipProgress = throttle(setClipProgress, 1000);\n    const src = this.getSrc(this.props);\n\n    if (muted || volume !== null) {\n      volume && this.setVolume(muted ? 0 : volume);\n    }\n\n    if (playbackRate) {\n      this.setPlaybackRate(playbackRate);\n    }\n\n    if (time) {\n      this.seekTo(time);\n    }\n\n    if (src) {\n      this.maybeStartHls(src, mediaType);\n    }\n\n    this.onMediaTypeChange(mediaType);\n  }\n\n  componentWillUnmount() {\n    this.destroyHls();\n    clearTimeout(this.progressTimeout);\n  }\n\n  maybeStartHls(source, mediaType) {\n    const {\n      setMediaType\n    } = this.props;\n    const {\n      hlsPlaying\n    } = this.state;\n    const isHlsSource = this.isHlsSource(source);\n    const shouldPlayHls = mediaType === MediaTypes.HLS && isHlsSource;\n    if (hlsPlaying) this.destroyHls();\n\n    if (shouldPlayHls) {\n      this.startHls(source);\n    }\n\n    if (mediaType === MediaTypes.HLS && !shouldPlayHls) {\n      setMediaType && setMediaType(MediaTypes.MP4);\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const {\n      clipId,\n      mediaType,\n      currentResolution\n    } = this.props;\n    const {\n      reportedPlaybackRate,\n      reportedVolume,\n      ready,\n      isPlaying,\n      hlsPlaying\n    } = this.state;\n    const newSource = this.getSrc(nextProps); // Handle URL change\n\n    const sourceDidChange = clipId !== nextProps.clipId || mediaType !== nextProps.mediaType || this.getSrc(this.props) !== newSource;\n    const resolutionDidChange = nextProps.currentResolution !== currentResolution;\n    const mediaTypeDidChange = mediaType && mediaType !== nextProps.mediaType;\n    if (mediaTypeDidChange) this.onMediaTypeChange(nextProps.mediaType);\n\n    if (sourceDidChange && newSource) {\n      this.maybeStartHls(newSource, mediaType);\n    }\n\n    if (sourceDidChange && ready) {\n      this.setState({\n        onReady: this.newReadyPromise(),\n        ready: false,\n        reportedVolume: null,\n        reportedPlaybackRate: null,\n        isPlaying: null\n      }, () => {});\n    }\n\n    if (!ready) {\n      return;\n    } // Handle playing change\n\n\n    if (nextProps.playing && !isPlaying) {\n      this.play(true);\n    }\n\n    if (!nextProps.playing && isPlaying) {\n      this.pause(true);\n    } // Handle volume change\n\n\n    if (nextProps.volume !== null || nextProps.muted) {\n      if (!nextProps.muted) {\n        if (nextProps.volume !== reportedVolume) {\n          this.setVolume(nextProps.volume);\n        }\n      }\n\n      if (nextProps.muted && reportedVolume !== 0) {\n        this.setVolume(0);\n      }\n    }\n\n    if (nextProps.playbackRate !== reportedPlaybackRate) {\n      this.setPlaybackRate(nextProps.playbackRate);\n    } // Handle time change\n\n\n    const timeDelta = Math.abs(nextProps.time - this.getPlayedSeconds());\n\n    if (timeDelta >= 1) {\n      this.seekTo(nextProps.time);\n    }\n\n    if (resolutionDidChange && hlsPlaying) this.onHlsLevelChange(nextProps.currentResolution);\n  }\n\n  connectIosFullscreenExit() {\n    const {\n      onReady\n    } = this.state;\n    onReady.then(() => {\n      const {\n        current: player\n      } = this.element;\n\n      if (player.webkitExitFullscreen) {\n        player.addEventListener(\"webkitendfullscreen\", this.iosEndFullscreen, false);\n      }\n    });\n  } //#region Player API\n\n\n  play() {\n    const {\n      onReady\n    } = this.state;\n    onReady.then(() => {\n      //   const { adobeHeartbeat, clipId, title } = this.props\n      const {\n        current: player\n      } = this.element;\n\n      if (player) {\n        const promise = player.play(); // adobeHeartbeat && adobeHeartbeat.trackPlay()\n\n        if (promise) {\n          promise.catch(e => {\n            const {\n              pause\n            } = this.props;\n            pause && pause(false);\n          });\n        }\n      }\n    });\n  }\n\n  pause() {\n    const {\n      onReady\n    } = this.state;\n    onReady.then(() => {\n      const {\n        current: player\n      } = this.element;\n      player && player.pause();\n    });\n  }\n\n  getDuration() {\n    const {\n      current: player\n    } = this.element;\n    return player ? player.duration : 0;\n  }\n\n  getPlayedSeconds() {\n    const {\n      current: player\n    } = this.element;\n    return player ? player.currentTime : 0;\n  }\n\n  getSecondsLoaded() {\n    const {\n      current: player\n    } = this.element;\n\n    if (!player) {\n      return 0;\n    }\n\n    const bufferedLength = player.buffered.length;\n    if (bufferedLength === 0) return 0;\n    let maxBuffered = 0,\n        currentBuffered;\n\n    for (let i = 0; i < bufferedLength; i++) {\n      currentBuffered = player.buffered.end(i);\n      maxBuffered = currentBuffered > maxBuffered ? currentBuffered : maxBuffered;\n    }\n\n    return maxBuffered;\n  } //#endregion\n\n\n  renderTrack(language) {}\n\n  handleHlsError(event, data) {// const { onVideoError } = this.props\n    // if (data.fatal) {\n    //   switch (data.type) {\n    //     case this.Hls.ErrorTypes.MEDIA_ERROR:\n    //       this.hls.recoverMediaError()\n    //       break\n    //     default:\n    //       this.destroyHls()\n    //       onVideoError && onVideoError(mapHlsError(data), 'handleHlsError')\n    //       break\n    //   }\n    // }\n  }\n\n  render() {\n    // const { onVideoError, versionId, closedCaptioningLanguage, mediaType } = this.props\n    const {\n      playbackRate,\n      mediaType,\n      supportedResolutions,\n      buffering,\n      loading\n    } = this.props;\n    let source = this.getSrc(this.props); //let source = \"https://archive.org/download/ElephantsDream/ed_1024_512kb.mp4\";\n\n    if (!source) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: css.video\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 762,\n        columnNumber: 14\n      }, this);\n    }\n\n    if (mediaType === MediaTypes.HLS) source = undefined;\n    return /*#__PURE__*/_jsxDEV(\"video\", {\n      id: \"video-element\",\n      className: css.video,\n      ref: this.element,\n      src: source,\n      preload: \"auto\",\n      playsInline: true,\n      autoPlay: true,\n      controls: false,\n      loop: false,\n      onLoadedMetadata: this.onLoadedMetadata,\n      onLoadedData: this.onLoadedData,\n      onCanPlay: this.onCanPlay,\n      onPlay: this.onPlay,\n      onSeeking: this.onSeeking,\n      onSeeked: this.onSeeked,\n      onPause: this.onPause,\n      onEnded: this.onEnded,\n      onVolumeChange: this.onVolumeChange,\n      onRateChange: this.onRateChange,\n      onWaiting: this.onWaiting,\n      onProgress: this.onProgress // onError={(e) => {\n      //   const { current: player } = this.element\n      //   onVideoError && onVideoError(mapGenericVideoError(player.error), 'videoElement.onError')\n      // }}\n\n    }, source, false, {\n      fileName: _jsxFileName,\n      lineNumber: 768,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nexport default _c = connector(Video); // export default withAdobeHeartbeat(\n//   connect(\n//     (state) => ({\n//       userAutoplaySetting: state.userAutoplaySetting,\n//       buffering: state.buffering,\n//       clipCompletedCallback: state.clipCompletedCallback,\n//       clipId: state.clipId,\n//       versionId: state.versionId,\n//       closedCaptioningEnabled: state.closedCaptioningEnabled,\n//       closedCaptioningLanguage: state.closedCaptioningLanguage,\n//       currentResolution: state.currentResolution,\n//       currentUrlIndex: state.currentUrlIndex,\n//       loading: state.loading,\n//       muted: state.muted,\n//       nextCallback: state.nextCallback,\n//       resolution: state.resolutionValue,\n//       playbackRate: state.playbackSpeed,\n//       playing: state.playing,\n//       poster: state.poster,\n//       time: state.time,\n//       title: state.title,\n//       urls: state.urls,\n//       userId: state.userId,\n//       version: state.versions ? state.versions.VERSION : '0.0.0',\n//       volume: state.volume,\n//       mediaType: state.mediaType,\n//       preferredResolutions: state.preferredResolutions,\n//       overlay: state.overlay,\n//       isStagingEnv: state.isStagingEnv,\n//       autoPlay: state.autoPlay,\n//     }),\n//     (store) => ({\n//       registerPlayer: actions.registerPlayer,\n//       seekStart: actions.seekStart,\n//       onVideoError: actions.onVideoError,\n//       setBuffering: actions.setBuffering,\n//       setLoading: actions.setLoading,\n//       setMediaType: actions.setMediaType,\n//       setLoading: actions.setLoading,\n//       setCurrentResolution: actions.setCurrentResolution,\n//       setSupportedResolutions: actions.setSupportedResolutions,\n//       requestUrls: actions.requestUrls,\n//       end: actions.end,\n//       ready: actions.ready,\n//       pause: actions.pause,\n//       play: actions.play,\n//       setClosedCaptioningCueList: actions.setClosedCaptioningCueList,\n//       setFullscreen: actions.setFullscreen,\n//       setOverlay: actions.setOverlay,\n//       setClipProgress: actions.setClipProgress,\n//       setPlaying: actions.setPlaying,\n//       setBufferedTime: actions.setBufferedTime,\n//       setDuration: actions.setDuration,\n//       setTime: actions.setTime,\n//     })\n//   )(Video)\n// )\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/akrah/Documents/dev/readux/src/codefluent/src/portal/scenes/CoursePlayer/video/video.tsx"],"names":["React","Component","connect","updateVideoViews","store","play","pause","setVolume","setTime","ready","seekEnd","seekStart","setBufferedTime","setMediaType","setOverlay","setBuffering","setFullscreen","setLoading","setAutoplay","setPlaying","setCurrentResolution","setPreferredResolutions","setSupportedResolutions","setClipProgress","setCurrentUrl","setClipId","setSubtitle","setCurrentLecture","css","DefaultResolutions","FullscreenState","HLS_SDK_URL","HLS_SDK_URL_SAFARI","MediaTypes","getSDK","throttle","HLS_EXTENSIONS","initialState","isPlaying","reportedVolume","reportedPlaybackRate","isBuffering","canPlay","mapState","state","playing","player","playbackRate","playbackSpeed","volume","buffering","views","currentLecture","loading","course","clipId","muted","time","currentUrl","mediaType","overlay","currentResolution","supportedResolutions","preferredResolutions","mapDispatch","dispatch","payload","setDuration","setNextUrl","connector","Video","constructor","props","newReadyPromise","Promise","resolve","setState","isSafari","navigator","vendor","match","isHlsSource","source","test","destroyHls","hlsPlaying","hls","destroy","startHls","sdkUrl","Hls","isSupported","MP4","autoStartLoad","loadSource","videoElement","document","getElementById","attachMedia","on","Events","MANIFEST_PARSED","event","data","startLoad","autoLevel","height","index","levels","map","r","width","indexOf","concat","preferredResolution","newResolution","find","currentLevel","resolutionShouldChange","ERROR","handleHlsError","bind","MEDIA_ATTACHED","onHlsLevelChange","requestNewUrls","onMediaTypeChange","newMediaType","console","log","HLS","resolution","WEBM","iosEndFullscreen","NORMAL","percent","onReady","then","current","element","isFinite","setPlaybackRate","rate","onCaptionUpdate","e","toggleCaptions","language","textTracks","forEach","track","mode","code","oncuechange","seekTo","amount","currentTime","onRateChange","onVolumeChange","onPlay","updateProgress","onPause","onCanPlay","onLoadedData","onEnded","history","length","view","lecture","id","initiate","complete","progress","lectures","sections","flatMap","sec","currentUrlIndex","findIndex","lec","nextLectureIndex","video_url","title","video","key","updateTracks","onLoadedMetadata","registerPlayer","duration","getDuration","getSrc","onSeeking","onSeeked","reportedTime","getPlayedSeconds","throttledSetClipProgress","videoSecondsWatched","progressTimeout","setTimeout","onProgress","bufferedTime","getSecondsLoaded","onWaiting","videoSrc","createRef","componentDidMount","src","maybeStartHls","componentWillUnmount","clearTimeout","shouldPlayHls","componentWillReceiveProps","nextProps","newSource","sourceDidChange","resolutionDidChange","mediaTypeDidChange","timeDelta","Math","abs","connectIosFullscreenExit","webkitExitFullscreen","addEventListener","promise","catch","bufferedLength","buffered","maxBuffered","currentBuffered","i","end","renderTrack","render","undefined"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect, ConnectedProps } from \"react-redux\";\nimport { RouteComponentProps } from \"react-router-dom\";\nimport { updateVideoViews } from \"services/courses\";\nimport { AppDispatch, RootState, store } from 'store';\nimport {\n  play,\n  pause,\n  setVolume,\n  setDuration,\n  setTime,\n  ready,\n  seekEnd,\n  seekStart,\n  registerPlayer,\n  setBufferedTime,\n  setMediaType,\n  setOverlay,\n  setBuffering,\n  setFullscreen,\n  setLoading,\n  setAutoplay,\n  setPlaying,\n  setCurrentResolution,\n  setPreferredResolutions,\n  setSupportedResolutions,\n  setClipProgress,\n  setCurrentUrl,\n  setClipId,\n  setSubtitle,\n  setCurrentLecture\n} from \"state/player/playerSlice\";\nimport css from \"./video.module.css\";\n\nimport { DefaultResolutions } from \"../constants\";\n\n// import withAdobeHeartbeat from './with-adobe-heartbeat'\n\nimport {\n  FullscreenState,\n  HLS_SDK_URL,\n  HLS_SDK_URL_SAFARI,\n  MediaTypes,\n} from \"../constants\";\nimport { getSDK } from \"../utilities/get-sdk\";\nimport { throttle } from \"../utilities/throttle\";\n// import { sendPlaySuccessEvent } from '../../analytics/player-events'\nimport { mapHlsError, mapGenericVideoError } from \"../utilities/video-error\";\nimport { Truncate } from \"@codecademy/gamut\";\nimport { connected } from \"process\";\n\nconst HLS_EXTENSIONS = /\\.(m3u8)($|\\?)/i;\nconst initialState = {\n  isPlaying: false,\n  reportedVolume: null,\n  reportedPlaybackRate: 1,\n  isBuffering: false,\n  canPlay: false,\n  ready: true,\n};\n\nconst mapState = (state: RootState) => ({\n  playing: state.player.playing,\n  playbackRate: state.player.playbackSpeed,\n  volume: state.player.volume,\n  buffering: state.player.buffering,\n  views: state.player.views,\n  currentLecture: state.player.currentLecture,\n  loading: state.player.loading,\n  course: state.player.course,\n  clipId: state.player.clipId,\n  muted: state.player.muted,\n  time: state.player.time,\n  currentUrl: state.player.currentUrl,\n  mediaType: state.player.mediaType,\n  overlay: state.player.overlay,\n  currentResolution: state.player.currentResolution,\n  supportedResolutions: state.player.supportedResolutions,\n  preferredResolutions: state.player.preferredResolutions,\n});\n\nconst mapDispatch = (dispatch: AppDispatch) => ({\n  setVolume: (payload) => dispatch(setVolume(payload)),\n  setDuration: (payload) => dispatch(setVolume(payload)),\n  setTime: (payload) => dispatch(setTime(payload)),\n  setBufferedTime: (payload) => dispatch(setBufferedTime(payload)),\n  ready: (payload) => dispatch(ready(payload)),\n  seekEnd: (payload) => dispatch(seekEnd()),\n  setNextUrl: (payload) => dispatch(setCurrentUrl(payload)),\n  seekStart: (payload) => dispatch(seekStart()),\n  play: (payload) => dispatch(play(payload)),\n  pause: (payload) => dispatch(pause(payload)),\n  setCurrentLecture: (payload) => dispatch(setCurrentLecture(payload)),\n  setClipId: (payload) => dispatch(setClipId(payload)),\n  setSubtitle: (payload) => dispatch(setSubtitle(payload)),\n  setBuffering: (payload) => dispatch(setBuffering(payload)),\n  setOverlay: (payload) => dispatch(setOverlay(payload)),\n  setFullscreen: (payload) => dispatch(setFullscreen(payload)),\n  setLoading: (payload) => dispatch(setLoading(payload)),\n  setPlaying: (payload) => dispatch(setPlaying(payload)),\n  setClipProgress: (payload) => dispatch(setClipProgress(payload)),\n  setAutoplay: (payload) => dispatch(setAutoplay(payload)),\n  setMediaType: (payload) => dispatch(setMediaType(payload)),\n  setCurrentResolution: (payload) => dispatch(setCurrentResolution(payload)),\n  setPreferredResolutions: (payload) =>\n    dispatch(setPreferredResolutions(payload)),\n  setSupportedResolutions: (payload) =>\n    dispatch(setSupportedResolutions(payload)),\n});\n\n\nconst connector = connect(mapState, mapDispatch);\ntype VideoProps = ConnectedProps<typeof connector> & RouteComponentProps;\n\nexport class Video extends Component<VideoProps, any> {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ...initialState,\n      clipId: props.clipId,\n      onReady: this.newReadyPromise(),\n      hlsPlaying: false,\n      videoSrc: null,\n    };\n\n    this.element = React.createRef();\n  }\n\n  newReadyPromise = () => {\n    return new Promise((resolve) => {\n      this.ready = () => {\n        this.setState({ ready: true }, () => {\n          resolve();\n        });\n      };\n    });\n  };\n\n  isSafari = () => navigator.vendor.match(/apple/i);\n\n  componentDidMount() {\n    const {\n      playing,\n      volume,\n      muted,\n      playbackRate,\n      time,\n     \n      mediaType,\n      currentResolution,\n   \n      setClipProgress,\n    } = this.props;\n    this.throttledSetClipProgress = throttle(setClipProgress, 1000);\n    const src = this.getSrc(this.props);\n\n    if (muted || volume !== null) {\n      volume && this.setVolume(muted ? 0 : volume);\n    }\n\n    if (playbackRate) {\n      this.setPlaybackRate(playbackRate);\n    }\n\n    if (time) {\n      this.seekTo(time);\n    }\n\n    \n\n    if (src) {\n      this.maybeStartHls(src, mediaType);\n    }\n    this.onMediaTypeChange(mediaType);\n  }\n\n  componentWillUnmount() {\n    this.destroyHls();\n    clearTimeout(this.progressTimeout);\n  }\n\n  maybeStartHls(source, mediaType) {\n    const { setMediaType } = this.props;\n    const { hlsPlaying } = this.state;\n    const isHlsSource = this.isHlsSource(source);\n    const shouldPlayHls = mediaType === MediaTypes.HLS && isHlsSource;\n\n    if (hlsPlaying) this.destroyHls();\n\n    if (shouldPlayHls) {\n      this.startHls(source);\n    }\n\n    if (mediaType === MediaTypes.HLS && !shouldPlayHls) {\n      setMediaType && setMediaType(MediaTypes.MP4);\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const {\n     \n      clipId,\n     \n      mediaType,\n      currentResolution,\n \n    } = this.props;\n    const {\n      reportedPlaybackRate,\n      reportedVolume,\n      ready,\n      isPlaying,\n      hlsPlaying,\n    } = this.state;\n\n    const newSource = this.getSrc(nextProps);\n\n    // Handle URL change\n    const sourceDidChange = clipId !== nextProps.clipId ||\n      mediaType !== nextProps.mediaType ||\n      this.getSrc(this.props) !== newSource;\n\n  \n\n    const resolutionDidChange =\n      nextProps.currentResolution !== currentResolution;\n\n    const mediaTypeDidChange = mediaType && mediaType !== nextProps.mediaType;\n\n    if (mediaTypeDidChange) this.onMediaTypeChange(nextProps.mediaType);\n\n    if (sourceDidChange && newSource) {\n     \n      this.maybeStartHls(newSource, mediaType);\n    }\n\n    if (sourceDidChange && ready) {\n      this.setState(\n        {\n          onReady: this.newReadyPromise(),\n          ready: false,\n          reportedVolume: null,\n          reportedPlaybackRate: null,\n          isPlaying: null,\n        },\n        () => {\n        \n        }\n      );\n    }\n\n    if (!ready) {\n      return;\n    }\n\n    // Handle playing change\n    if (nextProps.playing && !isPlaying) {\n      this.play(true);\n    }\n    if (!nextProps.playing && isPlaying) {\n      this.pause(true);\n    }\n\n    // Handle volume change\n    if (nextProps.volume !== null || nextProps.muted) {\n      if (!nextProps.muted) {\n        if (nextProps.volume !== reportedVolume) {\n          this.setVolume(nextProps.volume);\n        }\n      }\n\n      if (nextProps.muted && reportedVolume !== 0) {\n        this.setVolume(0);\n      }\n    }\n\n    if (nextProps.playbackRate !== reportedPlaybackRate) {\n      this.setPlaybackRate(nextProps.playbackRate);\n    }\n\n    // Handle time change\n    const timeDelta = Math.abs(nextProps.time - this.getPlayedSeconds());\n\n    if (timeDelta >= 1) {\n      this.seekTo(nextProps.time);\n    }\n\n    \n\n    if (resolutionDidChange && hlsPlaying)\n      this.onHlsLevelChange(nextProps.currentResolution);\n  }\n\n  isHlsSource = (source) => HLS_EXTENSIONS.test(source);\n\n  destroyHls = () => {\n    this.setState({ hlsPlaying: false });\n    this.hls && this.hls.destroy();\n  };\n\n  startHls = async (source) => {\n    const {\n      setSupportedResolutions,\n      setMediaType,\n      setCurrentResolution,\n      preferredResolutions,\n      currentResolution,\n      time,\n    } = this.props;\n    const sdkUrl = this.isSafari() ? HLS_SDK_URL_SAFARI : HLS_SDK_URL; //https://github.com/video-dev/hls.js/issues/1543\n    const Hls = await getSDK(sdkUrl, \"Hls\");\n    if (!Hls.isSupported()) return setMediaType && setMediaType(MediaTypes.MP4);\n    this.Hls = Hls;\n\n    this.hls = new Hls({ autoStartLoad: false });\n    this.hls.loadSource(source);\n\n    const videoElement = document.getElementById(\"video-element\");\n    this.hls.attachMedia(videoElement);\n\n    this.hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {\n      this.hls.startLoad(time || 0);\n      const autoLevel = { height: \"Auto\", index: -1 };\n      const supportedResolutions = data.levels.map((r) => ({\n        width: r.width,\n        height: r.height,\n        index: data.levels.indexOf(r),\n      }));\n      setSupportedResolutions &&\n        setSupportedResolutions(supportedResolutions.concat(autoLevel));\n\n      const preferredResolution = preferredResolutions.hls\n        ? preferredResolutions.hls\n        : null;\n      const newResolution =\n        preferredResolution &&\n        supportedResolutions.find(\n          (r) =>\n            preferredResolution.width === r.width &&\n            preferredResolution.height === r.height\n        );\n\n      if (!newResolution) {\n        setCurrentResolution && setCurrentResolution(autoLevel);\n        return;\n      }\n\n      this.hls && (this.hls.currentLevel = newResolution.index);\n      const resolutionShouldChange = newResolution !== currentResolution;\n      resolutionShouldChange &&\n        setCurrentResolution &&\n        setCurrentResolution(newResolution);\n    });\n    this.hls.on(Hls.Events.ERROR, this.handleHlsError.bind(this));\n    this.hls.on(Hls.Events.MEDIA_ATTACHED, (event, data) => {\n      this.setState({ hlsPlaying: true });\n    });\n  };\n\n  onHlsLevelChange = ({ height, index }) => {\n    const { currentResolution, setCurrentResolution } = this.props;\n\n    if (height === currentResolution.height) {\n      return;\n    }\n    this.hls && (this.hls.currentLevel = index);\n    setCurrentResolution && setCurrentResolution({ height, index });\n  };\n\n  requestNewUrls = () => {\n    const { setLoading } = this.props;\n    setLoading && setLoading(true);\n  };\n\n  onMediaTypeChange = (newMediaType) => {\n    const {\n      setSupportedResolutions,\n      setCurrentResolution,\n      preferredResolutions,\n    } = this.props;\n    console.log(\"Mediatype: \", newMediaType);\n    if (newMediaType !== MediaTypes.HLS) {\n      setSupportedResolutions &&\n        setSupportedResolutions(DefaultResolutions[newMediaType]);\n\n      const resolution =\n        preferredResolutions && preferredResolutions[newMediaType];\n      setCurrentResolution && setCurrentResolution(resolution);\n    }\n\n    if (newMediaType === MediaTypes.WEBM || newMediaType === MediaTypes.MP4) {\n      this.requestNewUrls();\n    }\n  };\n\n  iosEndFullscreen = () => {\n    this.props.setFullscreen(FullscreenState.NORMAL);\n  };\n\n  connectIosFullscreenExit() {\n    const { onReady } = this.state;\n    onReady.then(() => {\n      const { current: player } = this.element;\n      if (player.webkitExitFullscreen) {\n        player.addEventListener(\n          \"webkitendfullscreen\",\n          this.iosEndFullscreen,\n          false\n        );\n      }\n    });\n  }\n\n  //#region Player API\n  play() {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      //   const { adobeHeartbeat, clipId, title } = this.props\n      const { current: player } = this.element;\n\n      if (player) {\n        const promise = player.play();\n\n        // adobeHeartbeat && adobeHeartbeat.trackPlay()\n\n        if (promise) {\n          promise.catch((e) => {\n            const { pause } = this.props;\n            pause && pause(false);\n\n           \n          });\n        }\n      }\n    });\n  }\n\n  pause() {\n    const { onReady } = this.state;\n   \n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && player.pause();\n\n    });\n  }\n\n  setVolume = (percent) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n      player && percent === 0 ? (player.muted = true) : (player.muted = false); // player.volume is read only on mobile iOS\n      player && isFinite(percent) && (player.volume = percent);\n    });\n  };\n\n  setPlaybackRate = (rate) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && (player.playbackRate = rate);\n    });\n  };\n\n  onCaptionUpdate = (e) => {\n    \n  };\n\n  toggleCaptions = (language) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player &&\n        [...player.textTracks].forEach((track) => {\n          if (track.mode === \"showing\" && track.language !== language.code)\n            track.mode = \"disabled\";\n\n          if (track.language === language.code) {\n            track.oncuechange = this.onCaptionUpdate;\n            track.mode = \"hidden\";\n          } else {\n            track.oncuechange = null;\n          }\n        });\n    });\n  };\n\n  seekTo = (amount) => {\n    const { onReady } = this.state;\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n\n      player && (player.currentTime = amount);\n    });\n  };\n\n  getDuration() {\n    const { current: player } = this.element;\n\n    return player ? player.duration : 0;\n  }\n\n  getPlayedSeconds() {\n    const { current: player } = this.element;\n\n    return player ? player.currentTime : 0;\n  }\n\n  getSecondsLoaded() {\n    const { current: player } = this.element;\n\n    if (!player) {\n      return 0;\n    }\n\n    const bufferedLength = player.buffered.length;\n\n    if (bufferedLength === 0) return 0;\n\n    let maxBuffered = 0,\n      currentBuffered;\n    for (let i = 0; i < bufferedLength; i++) {\n      currentBuffered = player.buffered.end(i);\n      maxBuffered =\n        currentBuffered > maxBuffered ? currentBuffered : maxBuffered;\n    }\n\n    return maxBuffered;\n  }\n  //#endregion\n\n  onRateChange = (rate) => {\n    const { current: player } = this.element;\n\n    player && this.setState({ reportedPlaybackRate: player.playbackRate });\n  };\n\n  onVolumeChange = (rate) => {\n    const { current: player } = this.element;\n\n    player && this.setState({ reportedVolume: player.volume });\n  };\n\n  onPlay = () => {\n    const { setPlaying } = this.props;\n    // const { isStagingEnv, urls, currentUrlIndex, userId } = this.props\n    this.setState({ isPlaying: true });\n    // const currentUrl = urls[currentUrlIndex || 0]\n    // // sendPlaySuccessEvent(currentUrl, isStagingEnv, userId)\n    setPlaying && setPlaying(true);\n    this.updateProgress();\n  };\n\n  onPause = () => {\n    const { setPlaying } = this.props;\n    this.setState({ isPlaying: false });\n    setPlaying && setPlaying(false);\n  };\n\n  onCanPlay = () => {\n    const { setBuffering, buffering, loading, setLoading } =\n      this.props;\n\n    this.setState({ canPlay: true });\n    if (loading) setLoading && setLoading(false);\n\n    if (buffering) {\n      setBuffering && setBuffering(false);\n      //adobeHeartbeat && adobeHeartbeat.trackBufferComplete()\n    }\n  };\n\n  onLoadedData = () => {\n    const { setBuffering, buffering, setOverlay } = this.props;\n    const { onReady } = this.state;\n\n    if (!buffering) {\n      this.setState({ isBuffering: true });\n      setBuffering && setBuffering(true);\n    }\n\n    setOverlay && setOverlay(null);\n\n    onReady.then(() => {\n      const { current: player } = this.element;\n      //adobeHeartbeat && adobeHeartbeat.initHeartbeat(player.duration)\n    });\n  };\n\n  onEnded = (e) => {\n    const {\n     \n      pause,\n     \n      clipId,\n      time,\n      currentLecture,\n      views,\n      course,\n      setCurrentLecture,\n      setNextUrl,\n      setClipId,\n      setSubtitle,\n      history\n    } = this.props;\n\n    // end && end()\n\n    pause && pause(false);\n    console.log('History', history)\n    // adobeHeartbeat && adobeHeartbeat.trackComplete()\n    if (views && views.length) {\n      const view = views.find((view) => view.lecture == currentLecture.id);\n      store.dispatch(updateVideoViews.initiate({\n        id: view.id,\n        lecture: currentLecture.id,\n        complete: true,\n        progress: time,\n      }));\n      const lectures = course && course.sections?.flatMap(sec => sec.lectures)\n     \n      if (lectures && lectures.length) {\n        const currentUrlIndex = lectures.findIndex(lec => lec.id == currentLecture.id)\n        if(currentUrlIndex < (lectures.length - 1)) {\n          const nextLectureIndex = currentUrlIndex + 1\n          const lecture = lectures[nextLectureIndex]\n          lecture && setNextUrl(lecture.video_url)\n          lecture && setCurrentLecture(lecture)\n          lecture && setSubtitle(lecture?.title)\n          lecture && setClipId(lecture?.video.key)\n        } else {\n          const lecture = lectures[0]\n          lecture && setNextUrl(lecture.video_url)\n          lecture && setCurrentLecture(lecture)\n          lecture && setSubtitle(lecture?.title)\n          lecture && setClipId(lecture?.video.key)\n        }\n        \n      }\n    }\n\n \n  };\n\n  renderTrack(language) {\n \n  }\n\n  updateTracks = (videoElement) => {\n    // const { closedCaptioningLanguage, closedCaptioningEnabled, setClosedCaptioningCueList } = this.props\n    // const tracks = videoElement && videoElement.textTracks\n    // tracks &&\n    //   Object.values(tracks).forEach((track) => {\n    //     const isActive = closedCaptioningEnabled && track.language === closedCaptioningLanguage.code\n    //     if (isActive) {\n    //       track.mode = 'hidden'\n    //       videoElement.textTracks[0].mode = 'hidden' // Firefox\n    //       track.oncuechange = (e) => {\n    //         e.currentTarget.activeCues && setClosedCaptioningCueList(e.currentTarget.activeCues)\n    //       }\n    //     } else {\n    //       track.mode = 'disabled'\n    //     }\n    //   })\n  };\n\n  onLoadedMetadata = () => {\n    const { ready, registerPlayer } = this.props;\n    this.ready();\n\n    const duration = this.getDuration();\n    ready && ready(duration);\n\n    const videoElement = document.getElementById(\"video-element\");\n    registerPlayer && registerPlayer(videoElement);\n    // this.updateTracks(videoElement)\n  };\n\n  getSrc = ({  currentUrl } : VideoProps) => {\n    // return currentUrlIndex !== null && urls && urls.length > 0 ? urls[currentUrlIndex].url : null\n    let source = currentUrl;\n    return source;\n  };\n\n  onSeeking = () => {\n    // const { adobeHeartbeat } = this.props\n    // adobeHeartbeat && adobeHeartbeat.trackSeekStart()\n  };\n\n  onSeeked = () => {\n    // const { adobeHeartbeat } = this.props\n    // adobeHeartbeat && adobeHeartbeat.trackSeekComplete()\n  };\n\n  updateProgress = () => {\n    const { clipId, setTime, playing } = this.props;\n\n    if (!playing) return;\n\n    const reportedTime = this.getPlayedSeconds();\n    setTime && setTime(reportedTime);\n    reportedTime > 0 &&\n      this.throttledSetClipProgress({\n        clipId,\n        videoSecondsWatched: reportedTime,\n      });\n\n    this.progressTimeout = setTimeout(this.updateProgress, 50);\n  };\n\n  onProgress = () => {\n    const { setBufferedTime } = this.props;\n    const bufferedTime = this.getSecondsLoaded();\n\n    setBufferedTime && setBufferedTime(bufferedTime);\n  };\n\n  handleHlsError(event, data) {\n    // const { onVideoError } = this.props\n    // if (data.fatal) {\n    //   switch (data.type) {\n    //     case this.Hls.ErrorTypes.MEDIA_ERROR:\n    //       this.hls.recoverMediaError()\n    //       break\n    //     default:\n    //       this.destroyHls()\n    //       onVideoError && onVideoError(mapHlsError(data), 'handleHlsError')\n    //       break\n    //   }\n    // }\n  }\n\n  onWaiting = () => {\n    const {  setBuffering } = this.props;\n    //adobeHeartbeat && adobeHeartbeat.trackBufferStart()\n    setBuffering && setBuffering(true);\n  };\n\n  render() {\n    // const { onVideoError, versionId, closedCaptioningLanguage, mediaType } = this.props\n    const {\n      playbackRate,\n      mediaType,\n      supportedResolutions,\n      buffering,\n      loading,\n    } = this.props;\n\n    let source = this.getSrc(this.props);\n    //let source = \"https://archive.org/download/ElephantsDream/ed_1024_512kb.mp4\";\n\n    if (!source) {\n      return <div className={css.video} />;\n    }\n\n    if (mediaType === MediaTypes.HLS) source = undefined;\n\n    return (\n      <video\n        id=\"video-element\"\n        key={source}\n        className={css.video}\n        ref={this.element}\n        src={source}\n        preload=\"auto\"\n        playsInline\n        autoPlay\n        controls={false}\n        loop={false}\n        onLoadedMetadata={this.onLoadedMetadata}\n        onLoadedData={this.onLoadedData}\n        onCanPlay={this.onCanPlay}\n        onPlay={this.onPlay}\n        onSeeking={this.onSeeking}\n        onSeeked={this.onSeeked}\n        onPause={this.onPause}\n        onEnded={this.onEnded}\n        onVolumeChange={this.onVolumeChange}\n        onRateChange={this.onRateChange}\n        onWaiting={this.onWaiting}\n        onProgress={this.onProgress}\n        // onError={(e) => {\n        //   const { current: player } = this.element\n        //   onVideoError && onVideoError(mapGenericVideoError(player.error), 'videoElement.onError')\n        // }}\n      >\n        {/* {closedCaptioningLanguage && versionId && this.renderTrack(closedCaptioningLanguage)} */}\n      </video>\n    );\n  }\n}\n\n\nexport default connector(Video);\n\n// export default withAdobeHeartbeat(\n//   connect(\n//     (state) => ({\n//       userAutoplaySetting: state.userAutoplaySetting,\n//       buffering: state.buffering,\n//       clipCompletedCallback: state.clipCompletedCallback,\n//       clipId: state.clipId,\n//       versionId: state.versionId,\n//       closedCaptioningEnabled: state.closedCaptioningEnabled,\n//       closedCaptioningLanguage: state.closedCaptioningLanguage,\n//       currentResolution: state.currentResolution,\n//       currentUrlIndex: state.currentUrlIndex,\n//       loading: state.loading,\n//       muted: state.muted,\n//       nextCallback: state.nextCallback,\n//       resolution: state.resolutionValue,\n//       playbackRate: state.playbackSpeed,\n//       playing: state.playing,\n//       poster: state.poster,\n//       time: state.time,\n//       title: state.title,\n//       urls: state.urls,\n//       userId: state.userId,\n//       version: state.versions ? state.versions.VERSION : '0.0.0',\n//       volume: state.volume,\n//       mediaType: state.mediaType,\n//       preferredResolutions: state.preferredResolutions,\n//       overlay: state.overlay,\n//       isStagingEnv: state.isStagingEnv,\n//       autoPlay: state.autoPlay,\n//     }),\n//     (store) => ({\n//       registerPlayer: actions.registerPlayer,\n//       seekStart: actions.seekStart,\n//       onVideoError: actions.onVideoError,\n//       setBuffering: actions.setBuffering,\n//       setLoading: actions.setLoading,\n//       setMediaType: actions.setMediaType,\n//       setLoading: actions.setLoading,\n//       setCurrentResolution: actions.setCurrentResolution,\n//       setSupportedResolutions: actions.setSupportedResolutions,\n//       requestUrls: actions.requestUrls,\n//       end: actions.end,\n//       ready: actions.ready,\n//       pause: actions.pause,\n//       play: actions.play,\n//       setClosedCaptioningCueList: actions.setClosedCaptioningCueList,\n//       setFullscreen: actions.setFullscreen,\n//       setOverlay: actions.setOverlay,\n//       setClipProgress: actions.setClipProgress,\n//       setPlaying: actions.setPlaying,\n//       setBufferedTime: actions.setBufferedTime,\n//       setDuration: actions.setDuration,\n//       setTime: actions.setTime,\n//     })\n//   )(Video)\n// )\n"]},"metadata":{},"sourceType":"module"}